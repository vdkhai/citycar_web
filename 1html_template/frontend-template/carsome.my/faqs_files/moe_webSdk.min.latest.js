/*!
 * MoEngage Web SDK
 * v2.7.17
 */
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=45)}([function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this;Object.defineProperty(t,"__esModule",{value:!0});var o=n(2);t.isObjectEmpty=function(e){return 0===Object.keys(e).length&&e.constructor===Object},t.getProp=function e(t,n,r){return null==t?null:(t=t[(n=Array.isArray(n)?n:n.split("."))[0]])&&1<n.length?e(t,n.slice(1),r):void 0===t?r||null:t},t.getCurrentProtocol=function(){if(window){if("localhost"===window.location.hostname)return"https";if("http:"===window.location.protocol)return"http";if("https:"===window.location.protocol)return"https"}},t.stringToBuffer=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),a=0;a<n.length;++a)r[a]=n.charCodeAt(a);return r},t.bufferToString=function(e){for(var t,n="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=new Uint8Array(e),i=a.byteLength,o=i%3,s=i-o,u=0;u<s;u+=3)n+=r[(16515072&(t=a[u]<<16|a[u+1]<<8|a[u+2]))>>18]+r[(258048&t)>>12]+r[(4032&t)>>6]+r[63&t];return 1==o?n+=r[(252&(t=a[s]))>>2]+r[(3&t)<<4]+"==":2==o&&(n+=r[(64512&(t=a[s]<<8|a[1+s]))>>10]+r[(1008&t)>>4]+r[(15&t)<<2]+"="),n},t.isVapid=function(e,t){return t.isChrome()||t.isOpera()?"vapid"===e.chrome.subscriptionMode&&!!e.chrome.vapidPublicKey:!!t.isFirefox()&&"vapid"===e.firefox.subscriptionMode&&!!e.firefox.vapidPublicKey},t.getVapidPublicKey=function(e,t){return t.isChrome()||t.isOpera()?e.chrome.vapidPublicKey:t.isFirefox()?e.firefox.vapidPublicKey:""},t.isMobile=function(){var e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))},t.parseISOString=function(e){return new Date(Date.parse(e))},t.asyncForEach=function(e,t){return r(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:n=0,r.label=1;case 1:return n<e.length?[4,t(e[n],n,e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.getMoeWindowVar=function(){return window[window.moengage_object||"Moengage"]},t.PromiseObject=function(){var e=this;this.p=null,this.res=null,this.rej=null;try{this.p=new Promise((function(t,n){e.res=t,e.rej=n}))}catch(e){o.default.error(1,"Utils.PromiseObject","Promises not supported")}},t.validateDataType={isBoolean:function(e){return"boolean"==typeof e},isNumber:function(e){return"number"==typeof e},isString:function(e){return"string"==typeof e},isNumeric:function(e){return i.isNumber(e)||i.isString(e)&&String(+e)===e},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)}},t.deepCompareObjects=function e(t,n){if(null==t||null==n)return t===n;if(t instanceof Function)return t===n;if(t instanceof RegExp)return t===n;if(t===n||t.valueOf()===n.valueOf())return!0;if(Array.isArray(t)&&t.length!==n.length)return!1;if(t instanceof Date)return!1;if(!(t instanceof Object))return!1;if(!(n instanceof Object))return!1;var r=Object.keys(t);return Object.keys(n).every((function(e){return-1!==r.indexOf(e)}))&&r.every((function(r){return e(t[r],n[r])}))},t.convertDateToDateMonthYearFormat=function(){var e=new Date;return e.getDate()+":"+(e.getMonth()+1)+":"+e.getFullYear()+":"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},t.deserializeQueryParams=function(e){if(e){var t=e.replace("?","").split("&"),n={};return t.forEach((function(e){var t=e.split("="),r=t[0],a=decodeURIComponent(t[1]||"");n[r]?"[object Array]"===Object.prototype.toString.call(n[r])?n[r].push(a):n[r]=[n[r],a]:n[r]=a})),JSON.parse(JSON.stringify(n))}return{}},t.debounce=function(e,t,n){var r=0;return function(){for(var a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];var o=this,s=n&&!r;clearTimeout(r),r=setTimeout((function(){r=null,n||e.apply(o,a)}),t),s&&e.apply(o,a)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=(i.EPHEMERAL_STORAGE={INIT_DATA:"initData",BROWSER_DETAILS:"browserDetails",UNIFIED_LOGS:"unifiedLogs"},i.PERSISTENT_STORAGE={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION"},i.COOKIE_STORAGE={SESSION_COOKIE:{EXPIRY_YEARS:2}},i.EVENT_NAMES={USER_ATTRIBUTE:"EVENT_ACTION_USER_ATTRIBUTE",UNSUBSCRIBED:"MOE_WEB_UNSUBSCRIBED",WEB_SESSION_START:"EVENT_ACTION_WEB_SESSION_START",PAGE_VIEWED:"MOE_PAGE_VIEWED",WEB_OPTIN_BANNER_LOAD:"MOE_WEB_OPTIN_BANNER_LOAD",WEB_OPTIN_CLOSED:"MOE_WEB_OPTIN_CLOSED",WEB_OPTIN_ACCEPTED:"MOE_WEB_OPTIN_ACCEPTED",USER_SUBSCRIBED:"MOE_USER_SUBSCRIBED",OPT_IN_SHOWN:"MOE_OPT_IN_SHOWN",OPT_IN_ALLOWED:"MOE_OPT_IN_ALLOWED",OPT_IN_DISMISSED:"MOE_OPT_IN_DISMISSED",OPT_IN_BLOCKED:"MOE_OPT_IN_BLOCKED",USER_SUBSCRIPTION_CHECK:"MOE_USER_SUBSCRIPTION_CHECK",LOGOUT:"MOE_LOGOUT",UPDATE_DEVICE_ATTRIBUTE:"EVENT_ACTION_DEVICE_ATTRIBUTE"},i.EVENT_ATTRIBUTES_NAMES={URL:"URL",LOGGED_IN_STATUS:"moe_logged_in_status",FIRST_VISIT:"moe_first_visit"},i.ATTRIBUTE_NAMES={ID:"USER_ATTRIBUTE_UNIQUE_ID",EMAIL:"USER_ATTRIBUTE_USER_EMAIL",NAME:"USER_ATTRIBUTE_USER_NAME",FIRST_NAME:"USER_ATTRIBUTE_USER_FIRST_NAME",LAST_NAME:"USER_ATTRIBUTE_USER_LAST_NAME",MOBILE:"USER_ATTRIBUTE_USER_MOBILE",GENDER:"USER_ATTRIBUTE_USER_GENDER",BDAY:"USER_ATTRIBUTE_USER_BDAY",ID_MODIFIED:"USER_ID_MODIFIED_FROM"},i.SDK_FEATURES={WEB_PUSH:"WEB_PUSH"},i.BROADCAST_TOPICS={MOE_LIFECYCLE:{TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED"}},OPT_IN_LIFECYCLE:{TOPIC_NAME:"MOE_OPT_IN",EVENT_NAMES:{HARD_ASK_SHOWN:"HARD_ASK_SHOWN",HARD_ASK_DISMISSED:"HARD_ASK_DISMISSED",HARD_ASK_ALLOWED:"HARD_ASK_ALLOWED",HARD_ASK_DENIED:"HARD_ASK_DENIED",SOFT_ASK_SHOWN:"SOFT_ASK_SHOWN",SOFT_ASK_DISMISSED:"SOFT_ASK_DISMISSED",SOFT_ASK_ALLOWED:"SOFT_ASK_ALLOWED"}},INAPP_LIFECYCLE:{TOPIC_NAME:"INAPP_LIFECYCLE",EVENT_NAMES:{MODULE_LOADED:"MODULE_LOADED"}}},i.ERRORS={WEB_PUSH_NOT_SUPPORTED:{code:1e3,reason:"Web push not supported in current browser environment"},SERVICE_WORKER_REGISTRATION_FAILED:{code:1001,reason:"Registering the service worker failed"},WEB_PUSH_NOT_CONFIGURED:{code:1002,reason:"Web push settings not configured"},NOTIFICATION_MANAGER_NOT_CONFIGURED:{code:1003,reason:"Could not configure a notification manager for the current browser and settings"},PERMISSION_DISMISSED_TOO_MANY_TIMES:{code:1004,reason:"Hard ask was dismissed to many times"},SERVICE_WORKER_NOT_IN_CORRECT_SCOPE:{code:1005,reason:"Service worker can not be registered on this page due to scope issues"}},i.HTML_COMM={CHANNEL:{MAIN:"moe",SUBD:"moe-subd"},TOPICS:{PERSISTENT_STORAGE:"STORAGE",EPHEMERAL_STORAGE:"EPHEMERAL_STORAGE",PERMISSION_STATE:"PERMISSION_STATE",CONFIG:"CONFIG",HARD_ASK_RESULT:"HARD_ASK_RESULT",SHOW_NOTIF:"SHOW_NOTIF"}},i.GIFS={AMAZED:"https://media.giphy.com/media/90F8aUepslB84/giphy.gif",SAD:"https://media.giphy.com/media/KDRv3QggAjyo/giphy.gif"},i.DEPRECATED_CLUSTERS={dc_1:"us",dc_2:"eu",dc_3:"in"},i.CLUSTERS={dc_1:"DC_1",dc_2:"DC_2",dc_3:"DC_3"},i.CLUSTER_ENVIRONMENT_MAP={DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",eu:"sdk-02.moengage.com",in:"sdk-03.moengage.com"},i.LINKS={MOE_DASHBOARD:"https://app.moengage.com",MIGRATION_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",WEBSDK_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",SELF_HANDLED_DOCS:"https://docs.moengage.com/docs/self-handled-opt-ins"},i.WEB_SDK_API_MAX_RETRIES=3,i.ADD_REPORT_API_MAX_RETRIES=3,i.PUSH_SETTINGS_PAGE_LINK="Dashboard --\x3e Settings --\x3e Channel --\x3e Push",i.SESSION_SOURCE={SESSION:"SESSION",SESSION_KEY:"sessionKey",SESSION_START_TIME:"sessionStartTime",SESSION_EXPIRY_TIME:"sessionExpiryTime",SESSION_MAX_TIME:"sessionMaxTime",SESSION_ENABLED:"sessionEnabled",CUSTOM_IDENTIFIERS_TO_TRACK:"customIdentifiersToTrack",CURRENT_SOURCE:"currentSource",NUMBER_OF_SESSIONS:"numberOfSessions"},i.CONFIG={HOST:"https://apiv2.moengage.com/",API:{META:"v3/sdkconfig/"}},i.EVENTS={DATABASE_NAME:"moe_tracking",STORE_NAME:"events"},i.AMP={UUID:"moe_uuid"},i.BRANCH="master",i.SEGMENT_CLUSTER="moe_segment_cluster",i.SEGMENT_SW_PATH="moe_segment_sw_path",i.SEGMENT_SW_SCOPE="moe_segment_sw_scope",i);function i(){}t.default=a,t.WINDOW_OBJECTS={PageEventHistoryManager:"MoengagePageEventHistoryManager"},t.INAPP_CONSTANTS={HOST_1:"https://sdk-01.moengage.com/",HOST_2:"https://sdk-02.moengage.com/",HOST_3:"https://sdk-03.moengage.com/",API:{META:"v3/campaigns/inapp/live",CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/live/",DRAFT_CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/test/"},DRAFT_CAMPAIGN_TPYES:{WEB_PERSONALIZATON:"web_personalization",ONSITE_MESSAGING:"onsite_messaging"},META_REFRESH_TIME:9e5,DATABASE_NAME:"moe_onsite",STORES:{CAMPAIGNS_META:{NAME:"campaigns_meta"},CAMPAIGNS_TAGS:{NAME:"campaigns_tags"},CAMPAIGNS_STATS:{NAME:"campaigns_stats"},TEST_CAMPAIGN_STORE:{NAME:"test_campaign"},SERVICE_META:{NAME:"service_meta",KEYS:{LAST_META_CALL_TIME:"last_meta_call_time",GLOBAL_DELAY:"global_delay_between_inapps",LAST_INAPP_SHOWN_TIME:"last_inapp_shown",LAST_FETCH_SDK_VERSION:"last_fetch_sdk_version",UNIQUE_ID:"unique_id"}}},EVENT_NAMES:{OSM:{CLICK:"MOE_ONSITE_MESSAGE_CLICKED",IMPRESSION:"MOE_ONSITE_MESSAGE_SHOWN",DISMISS:"MOE_ONSITE_MESSAGE_DISMISSED",AUTO_DISMIS:"MOE_ONSITE_MESSAGE_AUTO_DISMISS",TYPE:"onsite"},WP:{CLICK:"MOE_WEBP_MESSAGE_CLICKED",IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",DISMISS:"MOE_WEBP_MESSAGE_DISMISSED",DELIVERED:"MOE_WEBP_MESSAGE_DELIVERED",TYPE:"webp"}},WEB_HELPER_IFRAME_URL:"https://cdn.moengage.com/webpush/beta/webpushhelper.html",IFRAME_CHANNEL:"inapp_helper",IFRAME_TOPICS:{COOKIE_STORAGE:"COOKIE_STORAGE"},COOKIE_STORAGE:{TEST_DRAFT_TYPE:"moe_inapp_draft_type",TEST_DRAFT_ID:"moe_inapp_draft_id",TEST_DRAFT_TAG:"moe_inapp_draft_tag",TEST_CAMPAIGN_META:"test_campaign_meta",TEST_TEMPLATE_TYPE:"test_template_type"},CSS_SELECTORS:{CLICK_INAPP:"moe-inapp-click",DISMISS_INAPP:"moe-inapp-close"},EXIT_INTENT:{CONFIG:{SCROLL_DOWN_THRESHOLD:50,SCROLL_UP_THRESHOLD:5,SCROLL_INTERVAL:1e3}},POSITIONED_TEMPLATE:'data-editor-type="MOE_EDITOR"',SIDE_BANNER:'data-template-type="SIDE_BANNER"'},t.SDK_MODULES={INAPP:{name:"INAPP",src:"https://cdn.moengage.com/webpush/modules/inapp.js",windowLocation:"moeOnsite"}},(r=t.SESSION_SOURCE_STATUS||(t.SESSION_SOURCE_STATUS={})).BLOCKED="blocked",r.ALLOWED="allowed",t.OFFLINE={DATABASE_NAME:"moe_database",OFFLINE_SYNC_EVENT:"moe_offline_data_sync",STORES:{OFFLINE_DATA:{NAME:"offline_data"}}},t.BATCH={API:{REPORT_ADD:"v2/sdk/report/"},CONFIG:{TIME_BETWEEN_BATCHES:15e3}},t.DATA_TYPES={NUMBER:"number"},t.PAGE_LIFE_CYCLE={FIRST_SEEN_SESSIONS:1}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),o=n(1),s="color: white; background: #41AE55; border-radius: 5px;",u="color: white; background: #48beab; border-radius: 5px;",l=(c.setLogLevel=function(e,t){var n=c.baseLogTag+".setLogLevel";null==i.default.get(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS)&&i.default.set(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,[]),null==e?c.logLevel=0:e in[0,1,2]?0<(c.logLevel=e)&&t&&c.releaseAllLogs():c.warn(0,n,"Value",e,"not supported for setDebugLevel(). Current log level is",c.logLevel,". Debug level can only be [0, 1, 2]")},c.log=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e<=c.logLevel?console.log.apply(console,a(["%c "+c.logBrand+" %c %c info %c %c "+t+" ",s,"","color: white; background: #18a0bf; border-radius: 5px;","",u,n],r)):c.cacheLog((function(){c.log.apply(c,a([e,t,n],r))}))},c.error=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e<=c.logLevel?console.error.apply(console,a(["%c "+c.logBrand+" %c %c error %c %c "+t+" ",s,"","color: white; background: #cc0a0a; border-radius: 5px;","",u,n],r)):c.cacheLog((function(){c.error.apply(c,a([e,t,n],r))}))},c.warn=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e<=c.logLevel?console.warn.apply(console,a(["%c "+c.logBrand+" %c %c warn %c %c "+t+" ",s,"","color: white; background: #e8ab51; border-radius: 5px;","",u,n],r)):c.cacheLog((function(){c.warn.apply(c,a([e,t,n],r))}))},c.customLabel=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e<=c.logLevel?console.log.apply(console,a(["%c "+c.logBrand+" %c %c "+t+" %c %c "+n+" %c ",s,"",u,"","color: white; background: #a400ff; border-radius: 5px;",""],r)):c.cacheLog((function(){c.customLabel.apply(c,a([e,t,n],r))}))},c.image=function(e,t){e<=c.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):c.cacheLog((function(){c.image(e,t)}))},c.releaseAllLogs=function(){var e=i.default.get(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS),t=e.length,n=e;if(i.default.set(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,[]),0<t){c.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(var r=0;r<t;r++)n[r]();c.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}},c.setLogBrand=function(e){c.logBrand=e},c.setBrandColor=function(e){s="color: white; background: "+e+"; border-radius: 5px;"},c.cacheLog=function(e){var t=i.default.get(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS);null==t&&(t=[]),t.push(e),i.default.set(o.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,t)},c.baseLogTag="Logger",c.logBrand="MoEngage",c.logLevel=0,c);function c(){}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),a=n(0),i=n(1),o=n(17),s=n(12),u="MOE_DATA",l=(c.setPrefix=function(e){c.prefix=e+"_"},c.set=function(e,t){if(e=c.prefix+e,localStorage){var n=c.getMoeData();n[e]=t,localStorage.setItem(u,JSON.stringify(n))}c.isSharedWithCookie&&0<=c.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&s.default.set(e,t)},c.get=function(e){if(e=c.prefix+e,localStorage){var t=c.getMoeData();return a.getProp(t,e,null)}return null},c.remove=function(e){var t=c.baseLogTag+".remove",n=c.prefix+e;if(localStorage&&null!=c.get(e)){var a=c.getMoeData();delete a[n],localStorage.setItem(u,JSON.stringify(a)),r.default.log(2,t,"Key",e,"removed.")}c.isSharedWithCookie&&0<=c.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&s.default.remove(e)},c.logout=function(){var e=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA"];for(var t in i.default.PERSISTENT_STORAGE)e.indexOf(t)<0&&c.remove(i.default.PERSISTENT_STORAGE[t]);for(var n in i.default.PERSISTENT_STORAGE.Q)o.default.purge(n)},c.getString=function(e){if(e=c.prefix+e,localStorage){var t=c.get(e);return"string"==typeof t||t instanceof String?t:JSON.stringify(t)}},c.removePrefix=function(){c.prefix=""},c.copyKeysFromCookie=function(){for(var e=0;e<c.KEYS_SHARED_WITH_COOKIE.length;e++){var t=c.KEYS_SHARED_WITH_COOKIE[e];null!=s.default.get(t)&&c.set(t,s.default.get(t))}},c.getMoeData=function(){var e=c.baseLogTag+".getMoeData",t=localStorage.getItem(u);if(null==t)return{};try{return JSON.parse(t)}catch(t){return r.default.error(1,e,t),{}}},c.baseLogTag="PersistentStorage",c.prefix="",c.isSharedWithCookie=!1,c.KEYS_SHARED_WITH_COOKIE=[i.default.PERSISTENT_STORAGE.USER_DATA,i.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,i.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,i.default.PERSISTENT_STORAGE.SETUP_TIME,i.default.PERSISTENT_STORAGE.PUSH_TOKEN,i.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,i.default.PERSISTENT_STORAGE.HARD_ASK_STATUS],c);function c(){}t.default=l},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},a=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),l=n(10),c=n(20),f=n(2),d=n(17),g=n(0),p=n(21),h=n(32),S=n(3),E=n(5),T=n(11),m=n(25),_=n(8),v=n(9),b=n(34),y=n(19),I=n(6),A=n(27),O=(P.deviceAdd=function(){return new Promise((function(e,t){var n=T.default.get();return P.collectGetParams().then((function(r){var a={queryParams:r};c.default.post(n.baseDomainName+"v2/device/add",a).then((function(){v.default.get().then((function(t){t.deviceAdded=!0,t.save().then((function(){h.default.startPeriodicClear(u.default.PERSISTENT_STORAGE.Q.REPORT),P.onDeviceAdd.res(),e()}))}))})).catch((function(e){d.default.enqueue(u.default.PERSISTENT_STORAGE.Q.DEVICE,!0),t(!1)}))}))}))},P.reportAdd=function(e,t){var n=P.baseLogTag+".reportAdd";return new Promise((function(r,a){return t=!!t,P.getWebSDKSettings().then((function(a){a.isPushSubBilling?v.default.get().then((function(a){a.deviceAdded?P.reportAddInternal(e,t).then((function(){r(!0)})):(d.default.enqueue(u.default.PERSISTENT_STORAGE.Q.REPORT,e),f.default.log(1,n,"Report added to queue as device not added yet:",e.event.name),f.default.log(2,n,"Event Queued:",e.event.name),e.type===m.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&(P.isPushSubAttributeAccepted(e.event.attributes[0].key)?(f.default.log(1,n,"Attribute accepted for push sub billing."),P.deviceAdd()):f.default.log(2,n,"Attribute NOT accepted for push sub billing.")),r(!0))})):P.reportAddInternal(e,t).then((function(){r(!0)}))}))}))},P.getSegmentId=function(){var e=window.analytics;if(e&&e.user)return e.user().anonymousId()},P.getBatchRequestOptions=function(e){return new Promise((function(t){P.collectGetParams().then((function(n){var r=P.getSegmentId()||"",a=v.default.getSync(),i=new p.default,o={session_id:i.getSessionKey(),start_time:i.getSessionStartTime(),background_initiated:0},u=[],l=i.getCurrentSource();l&&(i.setCurrentSource(l),u.push(l));var c={query_params:n,identifiers:{moe_user_id:a.getAttribute("id")||"",segment_id:r},meta:{bid:I.v4(),request_time:(new Date).toISOString(),session:o,source:u.length?u:void 0},viewsCount:e.length,viewsInfo:s(e)};t(c)}))}))},P.addReportsToOfflineDB=function(e,t){return a(this,void 0,void 0,(function(){var n,r;return i(this,(function(a){switch(a.label){case 0:return n=P.baseLogTag+".addReportsToOfflineDB",[4,P.getBatchRequestOptions([])];case 1:return r=a.sent(),[4,b.default.offlineDataStore.setItem(t||"report_add_"+(new Date).getTime(),e)];case 2:return a.sent(),[4,b.default.offlineDataStore.setItem("requestMetaData",r)];case 3:return a.sent(),navigator.serviceWorker&&navigator.serviceWorker.ready.then((function(e){e.sync?e.sync.register(u.OFFLINE.OFFLINE_SYNC_EVENT).then((function(){f.default.log(2,n,"offline sync event registered")})).catch((function(e){f.default.error(1,n,"Service worker sync error",e)})):f.default.log(2,n,"Service worker sync unavailable")})),[2]}}))}))},P.sendBatchOfReports=function(e){var t=P.baseLogTag+".sendBatchOfReports";return new Promise((function(n){P.getBatchRequestOptions(e).then((function(r){var a=T.default.get(),i=a.baseDomainName+u.BATCH.API.REPORT_ADD+a.appId;c.default.post(i,{postData:r}).then((function(){f.default.log(1,t,"Batch sent to MoEngage successfully"),n()})).catch((function(r){f.default.error(1,t,"Batch Report add API failed",r),P.addReportsToOfflineDB(e).then((function(){f.default.log(2,t,"Network offline: Batch added to offline db")})),n()}))}))}))},P.reportAddInternal=function(e,t){var n=P.baseLogTag+".reportAddInternal";return new Promise((function(r,a){P.getWebSDKSettings().then((function(a){E.default.getInstance().then((function(i){if("allowed"===a.s_e_b_e&&i.name!==E.default.BROWSER_NAMES.SAFARI&&i.name!==E.default.BROWSER_NAMES.FIREFOX&&navigator.sendBeacon&&!t)y.default.addReport(e,a.e_b_c),f.default.log(1,n,"Event batched successfully:",e.event),r(!0);else{var o=P.getUpdatedPushDetails();for(var s in o)o.hasOwnProperty(s)&&(e.getParams[s]=o[s]);var l={queryParams:e.getParams};if(e.postData.nie){var g=Object.assign({},e);delete g.postData.meta.source,delete g.postData.meta.session,l.postData=g.postData}else l.postData=e.postData;var p=T.default.get().baseDomainName;p+=t?"v2/device/add":"v2/report/add",c.default.post(p,l).then((function(){e.type===m.default.REPORT_ADD_TYPE.EVENT?(f.default.log(1,n,"Event tracked successfully:",e.event),P.eventStore.setItem(e.event.name,e.event)):e.type===m.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&f.default.log(1,n,"User attribute added successfully:",e.event.attributes),P.addReportApiRetries=1,r()})).catch((function(r){if("allowed"===a.s_e_b_e&&i.name!==E.default.BROWSER_NAMES.SAFARI&&i.name!==E.default.BROWSER_NAMES.FIREFOX&&navigator.sendBeacon)if(f.default.error(1,n,"Add Report API failed, adding reports to offline db",r),t)d.default.enqueue(u.default.PERSISTENT_STORAGE.Q.DEVICE,e);else{var o=new A.ReportView(e);P.offlineEvents.push(o),P.addReportsToOfflineDB(P.offlineEvents,"report_add").then((function(){f.default.log(2,n,"Network offline: Batch added to offline db")}))}else f.default.error(1,n,"Add Report API failed",r),e.type===m.default.REPORT_ADD_TYPE.EVENT?f.default.log(1,n,"Queueing unsuccessful event tracking:",e.event):e.type===m.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&f.default.log(1,n,"Queueing unsuccessful user attribute add:",e.event.attributes),P.addReportApiRetries<u.default.ADD_REPORT_API_MAX_RETRIES&&setTimeout((function(){P.addReportApiRetries++,d.default.enqueue(u.default.PERSISTENT_STORAGE.Q.REPORT,e),h.default.startPeriodicClear(u.default.PERSISTENT_STORAGE.Q.REPORT)}),3e3*P.addReportApiRetries)}))}}))}))}))},P.checkIfTokenValid=function(e){var t=T.default.get().baseDomainName+"v2/device/token-check",n=T.default.get();return new Promise((function(r){e?v.default.get().then((function(a){var i={queryParams:{app_id:n.appId,unique_id:a.deviceUuid,push_id:e}};c.default.post(t,i).then((function(e){200===e.status?r(!0):r(!1)})).catch((function(e){r(!1)}))})):r(!1)}))},P.getWebSDKSettings=function(){return new Promise((function(e,t){var n=T.default.get();if(null!=n&&null!=n.appId||(n=new T.default(S.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA))),P.sdkSettings)e(P.sdkSettings);else{var r=(new Date).getTime(),a=S.default.get(u.default.PERSISTENT_STORAGE.SETUP_TIME);null==a||0<n.debugLevel?P.getAndPersistWebSettings(n).then((function(t){e(t)})).catch((function(e){t(!1)})):864e5<r-a?P.getAndPersistWebSettings(n).then((function(t){e(t)})):S.default.get(u.default.PERSISTENT_STORAGE.WEB_SETTINGS)?(P.sdkSettings=S.default.get(u.default.PERSISTENT_STORAGE.WEB_SETTINGS),e(P.sdkSettings)):P.getAndPersistWebSettings(n).then((function(t){e(t)}))}}))},P.getAndPersistWebSettings=function(e){var t=this,n=P.baseLogTag+".getAndPersistWebSettings";return new Promise((function(o,s){return a(t,void 0,void 0,(function(){var t,a,l,d,p,h,E,m,v;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),null==e.appId&&(e=new T.default(S.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA))),t={queryParams:{app_id:e.appId}},f.default.log(1,n,"Fetching latest web sdk settings for",e.appId),[4,c.default.get(e.baseDomainName+"websdksettings",t)];case 1:a=i.sent(),f.default.log(1,n,"Fetching config settings for",e.appId),"string"==typeof(l=a.responseText)&&(l=JSON.parse(l)),d=g.isMobile()?"mweb":"web",p=e.baseDomainName+u.default.CONFIG.API.META+d+"/"+e.appId,i.label=2;case 2:return i.trys.push([2,4,,5]),[4,c.default.get(p)];case 3:return h=i.sent(),f.default.log(1,n,"Fetched latest web and config settings"),200===h.status&&(E=h.responseText,E=JSON.parse(E),l.webData=r({},l.webData,E)),[3,5];case 4:return i.sent(),f.default.error(1,n,"Config API failed"),[3,5];case 5:return m=(new Date).getTime(),l=_.default.parseOldSettings(l),S.default.set(u.default.PERSISTENT_STORAGE.WEB_SETTINGS,l),S.default.set(u.default.PERSISTENT_STORAGE.SETUP_TIME,m),o(P.sdkSettings=l),[3,7];case 6:return v=i.sent(),f.default.error(1,n,"Settings APi Failed: ",v),P.webSdkApiRetries<u.default.WEB_SDK_API_MAX_RETRIES?setTimeout((function(){P.webSdkApiRetries++,o(P.getAndPersistWebSettings(e))}),3e3*P.webSdkApiRetries):s(!1),[3,7];case 7:return[2]}}))}))}))},P.collectGetParams=function(){var e=this;return new Promise((function(t,n){v.default.get().then((function(n){var r=T.default.get();null!=r&&null!=r.appId||(r=new T.default(S.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA)));var a=new Date,i=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());E.default.getInstance().then((function(a){var o={os:a.os,os_platform:a.osPlatform,is_incognito:a.isIncognito,app_id:r.appId,os_ver:a.name,sdk_ver:"2.7.17",model:a.name,app_ver:"1.0",device_ts:Number(i),device_tz_offset:(-6e4*(new Date).getTimezoneOffset()).toString(),unique_id:n.deviceUuid,device_tz:(new Date).getTimezoneOffset().toString()},s=S.default.get(u.default.PERSISTENT_STORAGE.PUSH_TOKEN);null!=s&&"NA"!==s&&""!==s&&"null"!==s&&(o.push_id=s),a.isChromeLike()&&(g.isVapid(e.sdkSettings.platformSettings,a)?(o.subscription_type="vapid",o.vapid_public=g.getVapidPublicKey(e.sdkSettings.platformSettings,a)):o.subscription_type="normal",o.sender_id=e.sdkSettings.platformSettings.chrome.projectNumber),null!=r.environment&&(o.environment=r.environment),a.name===E.default.BROWSER_NAMES.SAFARI&&(o.websitePushId=e.sdkSettings.platformSettings.safari.websitePushId);var l=S.default.get(u.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS);if(null!=l&&null!=l.keys){for(var c in l.keys)o["keys_"+c]=encodeURI(l.keys[c]);null!=l.endpoint&&(o.endpoint=encodeURI(l.endpoint)),o.expirationTime=l.expirationTime}t(o)}))}))}))},P.getUpdatedPushDetails=function(){var e={},t=S.default.get(u.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS);if(null!=t){var n=S.default.get(u.default.PERSISTENT_STORAGE.PUSH_TOKEN);if(null!=n&&"NA"!==n&&""!==n&&"null"!==n&&(e.push_id=n),t.keys){for(var r in t.keys)e["keys_"+r]=encodeURI(t.keys[r]);null!=t.endpoint&&(e.endpoint=encodeURI(t.endpoint)),e.expirationTime=t.expirationTime}}return e},P.isPushSubAttributeAccepted=function(e){return e===u.default.ATTRIBUTE_NAMES.EMAIL},P.sendBeacon=function(e){P.getBatchRequestOptions(e).then((function(e){var t=T.default.get(),n=t.baseDomainName+u.BATCH.API.REPORT_ADD+t.appId+"?"+(new Date).getTime();navigator.sendBeacon(n,JSON.stringify(e))}))},P.baseLogTag="MoeApi",P.onDeviceAdd=new g.PromiseObject,P.webSdkApiRetries=1,P.offlineEvents=[],P.addReportApiRetries=1,P.eventStore=l.createInstance({driver:[l.INDEXEDDB,l.WEBSQL,l.LOCALSTORAGE],name:u.default.EVENTS.DATABASE_NAME,storeName:u.default.EVENTS.STORE_NAME}),P);function P(){}t.default=O},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i,o,s=n(1),u=n(7),l=n(0),c=n(3),f=(d.getInstance=function(){return r(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:return null!=u.default.get(s.default.EPHEMERAL_STORAGE.BROWSER_DETAILS)?[3,2]:[4,d.isIncognito(window)];case 1:return e=r.sent(),t=new d(navigator,document,e),u.default.set(s.default.EPHEMERAL_STORAGE.BROWSER_DETAILS,t),(n=c.default.get(s.default.PERSISTENT_STORAGE.BROWSER_DETAILS))&&d.isBrowserUpdated(n,t)||c.default.set(s.default.EPHEMERAL_STORAGE.BROWSER_DETAILS,t),[2,t];case 2:return[2,u.default.get(s.default.EPHEMERAL_STORAGE.BROWSER_DETAILS)]}}))}))},d.isIncognito=function(e){var t=e.RequestFileSystem||e.webkitRequestFileSystem;return new Promise((function(n){t?t(e.TEMPORARY,100,(function(){n(!1)}),(function(){n(!0)})):n(!1)}))},d.getBrowserName=function(e,t){return-1!==e.indexOf("MSIE")||1==t.documentMode?d.BROWSER_NAMES.INTERNET_EXPLORER:-1<e.indexOf("Edg")?d.BROWSER_NAMES.EDGE:-1<e.indexOf("OPR")||-1<e.indexOf("Opera")?d.BROWSER_NAMES.OPERA:-1<e.indexOf("Chrome")?-1<e.indexOf("MMS")?d.BROWSER_NAMES.OPERA_NEON:d.BROWSER_NAMES.CHROME:-1<e.indexOf("Safari")?d.BROWSER_NAMES.SAFARI:-1<e.indexOf("Firefox")?d.BROWSER_NAMES.FIREFOX:d.BROWSER_NAMES.OTHERS},d.isBrowserUpdated=function(e,t){return l.deepCompareObjects(e,t)},d.prototype.isChromeLike=function(){return this.isChrome()||this.isFirefox()||this.isOpera()},d.prototype.isChrome=function(){return this.name===d.BROWSER_NAMES.CHROME},d.prototype.isFirefox=function(){return this.name===d.BROWSER_NAMES.FIREFOX},d.prototype.isOpera=function(){return this.name===d.BROWSER_NAMES.OPERA||this.name===d.BROWSER_NAMES.OPERA_NEON},d.prototype.isSafari=function(){return this.name===d.BROWSER_NAMES.SAFARI},d);function d(e,t,n){this.os="web",this.osPlatform=e.userAgent,this.isMobile=l.isMobile(),this.os=l.isMobile()?"mweb":"web",this.name=d.getBrowserName(e.userAgent,t),this.isIncognito=n}(o=(i=f=f||{}).BROWSER_NAMES||(i.BROWSER_NAMES={})).CHROME="Google Chrome",o.FIREFOX="Mozilla Firefox",o.OPERA="Opera",o.OPERA_NEON="Opera Neon",o.SAFARI="Apple Safari",o.INTERNET_EXPLORER="Internet Explorer",o.EDGE="Edge",o.OTHERS="Others",t.default=f},function(e,t,n){var r=n(23),a=n(24),i=a;i.v1=r,i.v4=a,e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=(i.set=function(e,t){window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)},i.get=function(e){return r.getProp(window,"moeInternals.ephemeral."+e,null)},i.baseLogTag="EphemeralStorage",i);function i(){}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(2),i=n(1),o=(s.parseOldSettings=function(e){var t=s.baseLogTag+".parseOldSettings",n=new s;if((n.oldWebData=e).webData&&!r.isObjectEmpty(e.webData)){n.isConfigured=!0;var i=e.webData,o=r.getProp(i,"domain_type",null);o&&("http"===o.toLowerCase()?n.platformSettings.chrome.domainType=S.DOMAIN_TYPE.HTTP:"https"===o.toLowerCase()?n.platformSettings.chrome.domainType=S.DOMAIN_TYPE.HTTPS:"multi"===o.toLowerCase()?n.platformSettings.chrome.domainType=S.DOMAIN_TYPE.MUTLI:n.platformSettings.chrome.domainType=S.DOMAIN_TYPE.NA),n.platformSettings.chrome.subdomainURL=r.getProp(i,"subdomainUrl",null),"false"===r.getProp(i,"domain_level_storage",!1)?n.isDomainLevelStorage=!1:n.isDomainLevelStorage=!(!r.getProp(i,"domain_level_storage",!1)&&"true"!==r.getProp(i,"domain_level_storage",!1));var l=r.getProp(i,"PushSubBilling",!1);"false"===l?l=!1:"true"===l&&(l=!0),r.validateDataType.isBoolean(l)||(l=!1),n.isPushSubBilling=l,n.platformSettings.chrome.domainType!==S.DOMAIN_TYPE.HTTP&&n.platformSettings.chrome.domainType!==S.DOMAIN_TYPE.MUTLI||n.platformSettings.chrome.subdomainURL||a.default.warn(1,t,"No sub domain defined for HTTP site"),n.platformSettings.chrome.enabled=!0,n.platformSettings.chrome.apiKey=r.getProp(i,"webPushPlatformData.chrome.api_key",""),n.platformSettings.chrome.projectNumber=r.getProp(i,"webPushPlatformData.chrome.project_number",null),n.platformSettings.chrome.subscriptionMode=r.getProp(i,"webPushPlatformData.chrome.subscriptionMode","normal"),n.platformSettings.chrome.vapidPublicKey=r.getProp(i,"webPushPlatformData.chrome.vapidPublicKey",null),n.platformSettings.firefox.enabled=!0,n.platformSettings.firefox.apiKey=r.getProp(i,"webPushPlatformData.chrome.api_key",""),n.platformSettings.firefox.projectNumber=r.getProp(i,"webPushPlatformData.chrome.project_number",null),n.platformSettings.firefox.subscriptionMode=r.getProp(i,"webPushPlatformData.firefox.subscriptionMode","normal"),n.platformSettings.firefox.vapidPublicKey=r.getProp(i,"webPushPlatformData.firefox.vapidPublicKey",null),n.platformSettings.safari.websitePushId=r.getProp(i,"webPushPlatformData.safari.websitePushId",null),null==n.platformSettings.safari.websitePushId?n.platformSettings.safari.enabled=!1:n.platformSettings.safari.enabled=!0,n.optInConfig.reappearTime=parseInt(r.getProp(i,"promptAgain",24)),r.getProp(i,"call_push_moengage",!0)?r.getProp(i,"banner.banner_flag",null)?n.optInConfig.type=u.TYPE.TWO_STEP:n.optInConfig.type=u.TYPE.ONE_CLICK:(n.optInConfig.type=u.TYPE.SELF_HANDLED,n.optInConfig.reappearTime=0),n.optInConfig.showOverlay=r.getProp(i,"show_overlay",!1),n.optInConfig.loadTime=r.getProp(i,"load_time",0),n.optInConfig.softAskConfig.desktop.customHTML=r.getProp(i,"bannerHtml.web",null),n.optInConfig.softAskConfig.mobile.customHTML=r.getProp(i,"bannerHtml.mweb",null),n.platformSettings.chrome.isServiceWorkerRoot=!r.getProp(i,"is_service_worker_not_root",!1),n.platformSettings.chrome.serviceWorkerFilename=r.getProp(i,"serviceworker_file","serviceworker.js"),""===n.platformSettings.chrome.serviceWorkerFilename&&(n.platformSettings.chrome.serviceWorkerFilename="serviceworker.js"),n.featureAvailabilityMatrix=new h,n.featureAvailabilityMatrix=r.getProp(i,"featureAvailabilityMatrix",null),n.s_i_d=r.getProp(i,"s_i_d",1800),n.s_s_s=r.getProp(i,"s_s_s","allowed"),n.src_ext=r.getProp(i,"src_ext",[]),n.s_e_b_e=r.getProp(i,"s_e_b_e","blocked"),n.e_b_c=r.getProp(i,"e_b_c",10),n.p_f_t=r.getProp(i,"p_f_t",60)}else n.isConfigured=!1;return n},s.isFeatureEnabled=function(e,t){if(t!==i.default.SDK_FEATURES.WEB_PUSH)return!0;var n=r.getProp(e,"featureAvailabilityMatrix.webPush",null);if(n){var a=n.domains;return!(0<=a.values.indexOf(window.location.hostname)!=("whitelist"===a.type))}return!0},s.baseLogTag="SdkSettings",s);function s(){this.isDomainLevelStorage=!1,this.isConfigured=!1,this.isPushSubBilling=!1,this.platformSettings=new E,this.optInConfig=new u,this.s_i_d=1800}var u=function e(){this.type=e.TYPE.NA,this.reappearTime=24,this.softAskConfig={desktop:new f,mobile:new f}};t.OptInConfig=u;var l,c,f=function(){this.customHTML=null};(c=(l=u=u||{}).TYPE||(l.TYPE={})).NA="NA",c.ONE_CLICK="ONE_CLICK",c.TWO_STEP="TWO_STEP",c.SELF_HANDLED="SELF_HANDLED",t.OptInConfig=u;var d=function(){this.enabled=!1,this.websitePushId=null};t.SafariConfig=d;var g,p,h=function(){this.webPush=null},S=function e(){this.enabled=!1,this.domainType=e.DOMAIN_TYPE.NA,this.isServiceWorkerRoot=!0,this.serviceWorkerFilename="serviceworker.js",this.apiKey="",this.subscriptionMode="normal",this.vapidPublicKey=null};t.ChromeConfig=S,(p=(g=S=S||{}).DOMAIN_TYPE||(g.DOMAIN_TYPE={})).NA="NA",p.HTTP="http",p.HTTPS="https",p.MUTLI="multi",t.ChromeConfig=S;var E=function(){this.safari=new d,this.chrome=new S,this.firefox=new S};t.PushPlatformSettings=E,t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),a=n(2),i=n(4),o=n(1),s=n(3),u=n(12),l=n(5),c=n(33),f=n(8),d=n(0),g=n(6),p=null,h=!1,S=null,E=(T.prototype.addAttribute=function(e){var t=this,n=T.baseLogTag+".addAttribute";return new Promise((function(r){e.key=T.getMorphedKey(e.key);for(var i=-1,o=t.attributes.length-1;0<=o;o--)e.key===t.attributes[o].key&&(i=o);a.default.log(2,n,"Adding attribute:",e),0<=i?(t.attributes[i].value,e.value,t.attributes[i].value=e.value):t.attributes.push(e),t.save().then((function(){r(!0)}))}))},T.getLocalUser=function(){var e=T.baseLogTag+".getLocalUser";return new Promise((function(t){s.default.get(o.default.PERSISTENT_STORAGE.USER_DATA)?(a.default.log(2,e,"Found user in localstorage"),t(new T(s.default.get(o.default.PERSISTENT_STORAGE.USER_DATA)))):t(null)}))},T.getCookieUser=function(){return new Promise((function(e){var t=T.baseLogTag+".getLocalUser";u.default.get(o.default.PERSISTENT_STORAGE.USER_DATA)?(a.default.log(2,t,"Found user in cookie"),e(new T(u.default.get(o.default.PERSISTENT_STORAGE.USER_DATA)))):e(null)}))},T.getSubdomainUser=function(){return new Promise((function(e){i.default.getWebSDKSettings().then((function(t){(p=new c.default(t)).getInSubdomain(o.default.PERSISTENT_STORAGE.USER_DATA).then((function(t){e(t?new T(t):null)}))}))}))},T.getMigrationUser=function(){var e=T.baseLogTag+".getLocalUser";return new Promise((function(t){var n=localStorage.getItem(o.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA);if(n)try{var i=JSON.parse(n);if(i.is_new_sdk_migrated)t(null);else{var s=new T({deviceAdded:d.getProp(i,"device_add",!1),deviceUuid:d.getProp(i,"uuid",g.v4())}),u=d.getProp(i,"user_attrs",{});for(var l in u)u.hasOwnProperty(l)&&s.attributes.push(new r.default(l,u[l]));var c=localStorage.getItem(o.default.PERSISTENT_STORAGE.OLD_SDK.PUSH_TOKEN);null!=c&&"NA"!==c&&"null"!==c&&(s.subscribedToOldSdk=!0),t(s)}}catch(n){a.default.error(1,e,"Error getting the migration user. Resolving as a new user."),a.default.error(1,e,n),t(null)}else t(null)}))},T.getSync=function(){return T.instance},T.get=function(){var e=T.baseLogTag+".get";return null!=S?S:S=new Promise((function(t){l.default.getInstance().then((function(n){i.default.getWebSDKSettings().then((function(r){h=r.isDomainLevelStorage;var i="https";n.isChromeLike()&&(r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.HTTP||r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.MUTLI&&"http"===d.getCurrentProtocol())&&(i="http");var s=T.getLocalUser(),u=r.isDomainLevelStorage?T.getCookieUser():"resolved",l="http"===i?T.getSubdomainUser():"resolved",c=T.getMigrationUser();Promise.all([s,u,l,c]).then((function(i){var s=i[0],u=i[1],l=i[2],c=i[3];c?c.save().then((function(n){var r=localStorage.getItem(o.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA);if(r){var i=JSON.parse(r);i.is_new_sdk_migrated=!0,localStorage.setItem(o.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA,JSON.stringify(i))}a.default.log(1,e,"User resolved from older SDK: ",n),t(n)})):n.isChromeLike()&&(r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.HTTP||r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.MUTLI&&"http"===d.getCurrentProtocol())&&l&&"resolved"!==l?(a.default.log(1,e,"User resolved from subdomain: ",l),l.save().then((function(e){t(e)}))):u&&"resolved"!==u?(a.default.log(1,e,"User resolved from cookie: ",u),u.save().then((function(e){t(e)}))):(a.default.log(1,e,"Local user: ",s),new T(s).save().then((function(e){t(e)})))}))}))}))}))},T.logout=function(){var e=this;return new Promise((function(t){S=null,(e.instance=null)!=p?p.logout().then((function(){t()})):t()}))},T.prototype.save=function(){var e=this,t=T.baseLogTag+".save";return T.isAmpEnabled()&&(this.deviceUuid=u.default.get("moe_uuid")),T.instance=this,new Promise((function(n){s.default.set(o.default.PERSISTENT_STORAGE.USER_DATA,e),u.default.setRaw(o.default.AMP.UUID,T.instance.deviceUuid),h&&u.default.set(o.default.PERSISTENT_STORAGE.USER_DATA,e),null!=p?p.setInSubDomainStorage(o.default.PERSISTENT_STORAGE.USER_DATA,e).then((function(){n(e)})).catch((function(r){a.default.error(1,t,"Error storing value in subdomain"),n(e)})):n(e)}))},T.isAmpEnabled=function(){var e=u.default.get(o.default.AMP.UUID);return e&&e.includes("amp")},T.prototype.getAttribute=function(e){var t=null;return e=T.getMorphedKey(e),this.attributes.map((function(n){n.key===e&&(t=n.value)})),t},T.prototype.indexOfAttribute=function(e){var t=-1;return e=T.getMorphedKey(e),this.attributes.map((function(n,r){n.key===e&&(t=r)})),t},T.getMorphedKey=function(e){switch(e){case"id":e=o.default.ATTRIBUTE_NAMES.ID;break;case"email":e=o.default.ATTRIBUTE_NAMES.EMAIL;break;case"name":e=o.default.ATTRIBUTE_NAMES.NAME;break;case"first_name":e=o.default.ATTRIBUTE_NAMES.FIRST_NAME;break;case"last_name":e=o.default.ATTRIBUTE_NAMES.LAST_NAME;break;case"mobile":e=o.default.ATTRIBUTE_NAMES.MOBILE;break;case"gender":e=o.default.ATTRIBUTE_NAMES.GENDER;break;case"birthday":e=o.default.ATTRIBUTE_NAMES.BDAY}return e},T.baseLogTag="UserModel",T.isResolved=!1,T.instance=null,T);function T(e){this.attributes=[],this.subscribedToOldSdk=!1,null==e?(this.deviceUuid=g.v4(),this.attributes=[],this.deviceAdded=!1):(this.deviceUuid=d.getProp(e,"deviceUuid",g.v4()),this.attributes=d.getProp(e,"attributes",[]),this.deviceAdded=d.getProp(e,"deviceAdded",!1))}t.default=E},function(e,t,n){(function(t){e.exports=function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){return a(t[o][1][e]||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i=!1,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,n,r){(function(e){"use strict";var t,r,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var i=0,o=new a(c),s=e.document.createTextNode("");o.observe(s,{characterData:!0}),t=function(){s.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)};else{var u=new e.MessageChannel;u.port1.onmessage=c,t=function(){u.port2.postMessage(0)}}var l=[];function c(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}n.exports=function(e){1!==l.push(e)||r||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function a(){}var i={},o=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==a&&g(this,e)}function c(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function f(e,t,n){r((function(){var r;try{r=t(n)}catch(r){return i.reject(e,r)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function g(e,t){var n=!1;function r(t){n||(n=!0,i.reject(e,t))}function a(t){n||(n=!0,i.resolve(e,t))}var o=p((function(){t(a,r)}));"error"===o.status&&r(o.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=l).prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(a);this.state!==u?f(n,this.state===s?e:t,this.outcome):this.queue.push(new c(n,e,t));return n},c.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){i.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},i.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return i.reject(e,n.value);var r=n.value;if(r)g(e,r);else{e.state=s,e.outcome=t;for(var a=-1,o=e.queue.length;++a<o;)e.queue[a].callFulfilled(t)}return e},i.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:i.resolve(new this(a),e)},l.reject=function(e){var t=new this(a);return i.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,u=-1,l=new this(a);++u<n;)c(e[u],u);return l;function c(e,a){t.resolve(e).then((function(e){o[a]=e,++s!==n||r||(r=!0,i.resolve(l,o))}),(function(e){r||(r=!0,i.reject(l,e))}))}},l.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var r,o=-1,s=new this(a);++o<t;)r=e[o],this.resolve(r).then((function(e){n||(n=!0,i.resolve(s,e))}),(function(e){n||(n=!0,i.reject(s,e))}));return s}},{1:1}],3:[function(e,n,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var o=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function c(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var f="local-forage-detect-blob-support",d=void 0,g={},p=Object.prototype.toString,h="readonly",S="readwrite";function E(e){return"boolean"==typeof d?o.resolve(d):function(e){return new o((function(t){var n=e.transaction(f,S),r=i([""]);n.objectStore(f).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||43<=parseInt(e[1],10))}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function T(e){var t=g[e.name],n={};n.promise=new o((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function m(e){var t=g[e.name].deferredOperations.pop();return t&&(t.resolve(),t.promise)}function _(e,t){var n=g[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function v(e,t){return new o((function(n,r){if(g[e.name]=g[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);T(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var o=a.open.apply(a,i);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(f)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){n(o.result),m(e)}}))}function b(e){return v(e,!1)}function y(e){return v(e,!0)}function I(e,t){if(!e.db)return 1;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,a=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return 1}}function A(e){return i([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),a=0;a<t;a++)r[a]=e.charCodeAt(a);return n}(atob(e.data))],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function P(e){var t=this,n=t._initReady().then((function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(n,e,e),n}function N(e,t,n,r){void 0===r&&(r=1);try{var a=e.db.transaction(e.storeName,t);n(null,a)}catch(a){if(0<r&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return o.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),y(e)})).then((function(){return function(e){T(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var a=n[r];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,b(e).then((function(t){return e.db=t,I(e)?y(e):t})).then((function(r){e.db=t.db=r;for(var a=0;a<n.length;a++)n[a]._dbInfo.db=r})).catch((function(t){throw _(e,t),t}))}(e).then((function(){N(e,t,n,r-1)}))})).catch(n);n(a)}}var w={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var a=g[n.name];a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},g[n.name]=a),a.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=P);var i=[];function s(){return o.resolve()}for(var u=0;u<a.forages.length;u++){var l=a.forages[u];l!==t&&i.push(l._initReady().catch(s))}var c=a.forages.slice(0);return o.all(i).then((function(){return n.db=a.db,b(n)})).then((function(e){return n.db=e,I(n,t._defaultConfig.version)?y(n):e})).then((function(e){n.db=a.db=e,t._dbInfo=n;for(var r=0;r<c.length;r++){var i=c[r];i!==t&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}}))},_support:function(){try{if(!a)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){N(n._dbInfo,h,(function(a,i){if(a)return r(a);try{var o=i.objectStore(n._dbInfo.storeName).openCursor(),s=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;O(r)&&(r=A(r));var a=e(r,n.key,s++);void 0!==a?t(a):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(a){r(a)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new o((function(t,r){n.ready().then((function(){N(n._dbInfo,h,(function(a,i){if(a)return r(a);try{var o=i.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),O(e)&&(e=A(e)),t(e)},o.onerror=function(){r(o.error)}}catch(a){r(a)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var a=new o((function(n,a){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===p.call(t)?E(i.db).then((function(e){return e?t:(n=t,new o((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){N(r._dbInfo,S,(function(i,o){if(i)return a(i);try{var s=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var u=s.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=u.error?u.error:u.transaction.error;a(e)}}catch(i){a(i)}}))})).catch(a)}));return s(a,n),a},removeItem:function(e,t){var n=this;e=l(e);var r=new o((function(t,r){n.ready().then((function(){N(n._dbInfo,S,(function(a,i){if(a)return r(a);try{var o=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(o.error)},i.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(a){r(a)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){N(t._dbInfo,S,(function(r,a){if(r)return n(r);try{var i=a.objectStore(t._dbInfo.storeName).clear();a.oncomplete=function(){e()},a.onabort=a.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){N(t._dbInfo,h,(function(r,a){if(r)return n(r);try{var i=a.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){e<0?t(null):n.ready().then((function(){N(n._dbInfo,h,(function(a,i){if(a)return r(a);try{var o=i.objectStore(n._dbInfo.storeName),s=!1,u=o.openCursor();u.onsuccess=function(){var n=u.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},u.onerror=function(){r(u.error)}}catch(a){r(a)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){N(t._dbInfo,h,(function(r,a){if(r)return n(r);try{var i=a.objectStore(t._dbInfo.storeName).openCursor(),o=[];i.onsuccess=function(){var t=i.result;t?(o.push(t.key),t.continue()):e(o)},i.onerror=function(){n(i.error)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n,r=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),e.name){var i=e.name===r.name&&this._dbInfo.db?o.resolve(this._dbInfo.db):b(e).then((function(t){var n=g[e.name],r=n.forages;n.db=t;for(var a=0;a<r.length;a++)r[a]._dbInfo.db=t;return t}));n=e.storeName?i.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;T(e);var r=g[e.name],i=r.forages;t.close();for(var s=0;s<i.length;s++){var u=i[s];u._dbInfo.db=null,u._dbInfo.version=n}return new o((function(t,r){var i=a.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,m(n._dbInfo)}})).catch((function(t){throw(_(e,t)||o.resolve()).catch((function(){})),t}))}})):i.then((function(t){T(e);var n=g[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;return new o((function(t,n){var r=a.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)m(r[t]._dbInfo)})).catch((function(t){throw(_(e,t)||o.resolve()).catch((function(){})),t}))}))}else n=o.reject("Invalid arguments");return s(n,t),n}},R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C=/^~~local_forage_type~([^~]+)~/,D="__lfsc__:",M=D.length,L="arbf",k="blob",B=M+L.length,U=Object.prototype.toString;function x(e){var t,n,r,a,i,o=.75*e.length,s=e.length,u=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),c=new Uint8Array(l);for(t=0;t<s;t+=4)n=R.indexOf(e[t]),r=R.indexOf(e[t+1]),a=R.indexOf(e[t+2]),i=R.indexOf(e[t+3]),c[u++]=n<<2|r>>4,c[u++]=(15&r)<<4|a>>2,c[u++]=(3&a)<<6|63&i;return l}function W(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=R[n[t]>>2],r+=R[(3&n[t])<<4|n[t+1]>>4],r+=R[(15&n[t+1])<<2|n[t+2]>>6],r+=R[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var H={serialize:function(e,t){var n="";if(e&&(n=U.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===U.call(e.buffer))){var r,a=D;e instanceof ArrayBuffer?(r=e,a+=L):(r=e.buffer,"[object Int8Array]"===n?a+="si08":"[object Uint8Array]"===n?a+="ui08":"[object Uint8ClampedArray]"===n?a+="uic8":"[object Int16Array]"===n?a+="si16":"[object Uint16Array]"===n?a+="ur16":"[object Int32Array]"===n?a+="si32":"[object Uint32Array]"===n?a+="ui32":"[object Float32Array]"===n?a+="fl32":"[object Float64Array]"===n?a+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(a+W(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n="~~local_forage_type~"+e.type+"~"+W(this.result);t(D+k+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,M)!==D)return JSON.parse(e);var t,n=e.substring(B),r=e.substring(M,B);if(r===k&&C.test(n)){var a=n.match(C);t=a[1],n=n.substring(a[0].length)}var o=x(n);switch(r){case L:return o;case k:return i([o],{type:t});case"si08":return new Int8Array(o);case"ui08":return new Uint8Array(o);case"uic8":return new Uint8ClampedArray(o);case"si16":return new Int16Array(o);case"ur16":return new Uint16Array(o);case"si32":return new Int32Array(o);case"ui32":return new Uint32Array(o);case"fl32":return new Float32Array(o);case"fl64":return new Float64Array(o);default:throw new Error("Unkown type: "+r)}},stringToBuffer:x,bufferToString:W};function G(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function F(e,t,n,r,a,i){e.executeSql(n,r,a,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?i(e,o):G(e,t,(function(){e.executeSql(n,r,a,i)}),i)}),i):i(e,o)}),i)}function K(e,t,n,r){var a=this;e=l(e);var i=new o((function(i,o){a.ready().then((function(){void 0===t&&(t=null);var s=t,u=a._dbInfo;u.serializer.serialize(t,(function(t,l){l?o(l):u.db.transaction((function(n){F(n,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){i(s)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(0<r)return void i(K.apply(a,[e,s,n,r-1]));o(t)}}))}))})).catch(o)}));return s(i,n),i}var j={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var a=new o((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(a){G(a,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=H,a},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){F(n,a,"SELECT * FROM "+a.storeName,[],(function(n,r){for(var i=r.rows,o=i.length,s=0;s<o;s++){var u=i.item(s),l=u.value;if(l=l&&a.serializer.deserialize(l),void 0!==(l=e(l,u.key,s+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new o((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){F(n,a,"SELECT * FROM "+a.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r=r&&a.serializer.deserialize(r),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return K.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var r=new o((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){F(n,a,"DELETE FROM "+a.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){F(n,a,"SELECT key FROM "+a.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],a=0;a<n.rows.length;a++)r.push(n.rows.item(a).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,a=this;return s(r=e.name?new o((function(t){var r,i;r=e.name===n.name?a._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t((i=r,new o((function(e,t){i.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(t,n){for(var r=[],a=0;a<n.rows.length;a++)r.push(n.rows.item(a).name);e({db:i,storeNames:r})}),(function(e,n){t(n)}))}),(function(e){t(e)}))}))))})).then((function(e){return new o((function(t,n){e.db.transaction((function(r){function a(e){return new o((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var i=[],s=0,u=e.storeNames.length;s<u;s++)i.push(a(e.storeNames[s]));o.all(i).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):o.reject("Invalid arguments"),t),r}};function V(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}var Y={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=V(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),void localStorage.removeItem(e)}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=H,o.resolve()):o.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,a=r.length,i=localStorage.length,o=1,s=0;s<i;s++){var u=localStorage.key(s);if(0===u.indexOf(r)){var l=localStorage.getItem(u);if(l=l&&t.serializer.deserialize(l),void 0!==(l=e(l,u.substring(a),o++)))return l}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&t.serializer.deserialize(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var a=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new o((function(a,i){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)i(r);else try{localStorage.setItem(o.keyPrefix+e,t),a(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||i(t),i(t)}}))}))}));return s(a,n),a},removeItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;0<=n;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(r){t=null}return t&&t.substring(r.keyPrefix.length)}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],a=0;a<n;a++){var i=localStorage.key(a);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){if(t=c.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,a=this;return s(r=e.name?new o((function(t){e.storeName?t(V(e,a._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):o.reject("Invalid arguments"),t),r}},q=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},z=function(e,t){for(var n=e.length,r=0;r<n;){if(q(e[r],t))return!0;r++}return!1},X=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Q={},J={},Z={INDEXEDDB:w,WEBSQL:j,LOCALSTORAGE:Y},$=[Z.INDEXEDDB._driver,Z.WEBSQL._driver,Z.LOCALSTORAGE._driver],ee=["dropInstance"],te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),ne={description:"",driver:$.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function re(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ae(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(X(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ie=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z)if(Z.hasOwnProperty(n)){var r=Z[n],a=r._driver;this[n]=a,Q[a]||this.defineDriver(r)}this._defaultConfig=ae({},ne),this._config=ae({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"!==(void 0===e?"undefined":r(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},e.prototype.defineDriver=function(e,t,n){var r=new o((function(t,n){try{var r=e._driver,a=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(a);for(var i=te.concat("_initStorage"),u=0,l=i.length;u<l;u++){var c=i[u];if((!z(ee,c)||e[c])&&"function"!=typeof e[c])return void n(a)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=o.reject(t);return s(n,arguments[arguments.length-1]),n}},n=0,r=ee.length;n<r;n++){var a=ee[n];e[a]||(e[a]=t(a))}}();var f=function(n){Q[r]&&console.info("Redefining LocalForage driver: "+r),Q[r]=e,J[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(f,n):f(!!e._support):f(!0)}catch(a){n(a)}}));return u(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Q[e]?o.resolve(Q[e]):o.reject(new Error("Driver not found."));return u(r,t,n),r},e.prototype.getSerializer=function(e){var t=o.resolve(H);return u(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;X(e)||(e=[e]);var a=this._getSupportedDrivers(e);function i(){r._config.driver=r.driver()}function s(e){return r._extend(e),i(),r._ready=r._initStorage(r._config),r._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return o.resolve()})):o.resolve();return this._driverSet=l.then((function(){var e=a[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var a=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(a).then(s).catch(n)}i();var u=new Error("No available storage method found.");return r._driverSet=o.reject(u),r._driverSet}()}}(a)}))})).catch((function(){i();var e=new Error("No available storage method found.");return r._driverSet=o.reject(e),r._driverSet})),u(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!J[e]},e.prototype._extend=function(e){ae(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];this.supports(a)&&t.push(a)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=te.length;e<t;e++)re(this,te[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ie},{3:3}]},{},[4])(4)}).call(this,n(35))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a,i=n(1),o=n(0),s=n(7),u=n(2),l=n(3),c=(f.save=function(e){s.default.set(i.default.EPHEMERAL_STORAGE.INIT_DATA,new f(e)),l.default.set(i.default.PERSISTENT_STORAGE.INIT_DATA,new f(e))},f.get=function(){return s.default.get(i.default.EPHEMERAL_STORAGE.INIT_DATA)},f.setSoftAskConfig=function(e){var t=f.get(),n={appId:t.appId,debugLevel:t.debugLevel,cluster:t.cluster,environment:t.environment,swPath:t.swPath,customSoftAsk:{mainClass:o.getProp(e,"main_class",o.getProp(e,"mainClass",null)),allowClass:o.getProp(e,"allow_class",o.getProp(e,"allowClass",null)),dismissClass:o.getProp(e,"block_class",o.getProp(e,"dismissClass",null))}};f.save(n)},f.baseLogTag="InitData",f);function f(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://sdk-01.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=f.baseLogTag+".constructor";null!=o.getProp(e,"app_id",null)?(this.appId=o.getProp(e,"app_id",null),this.integrationType=r.OLD_SDK):null!=o.getProp(e,"appId",null)?(this.appId=o.getProp(e,"appId",null),this.integrationType=r.NEW_SDK):(u.default.error(1,t,"App Id not specified. Please check docs page to complete the integration - ",i.default.LINKS.WEBSDK_DOCS),this.integrationType=null),null!=o.getProp(e,"debug_logs",null)?this.debugLevel=o.getProp(e,"debug_logs",0):null!=o.getProp(e,"debugLevel",null)?this.debugLevel=o.getProp(e,"debugLevel",0):(u.default.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=o.getProp(e,"forceSwUpdate",!1),this.cluster=o.getProp(e,"cluster",null),this.cluster&&null!=i.default.CLUSTER_ENVIRONMENT_MAP[this.cluster]&&(this.environment=i.default.CLUSTER_ENVIRONMENT_MAP[this.cluster]),o.getProp(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=o.getProp(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:o.getProp(e,"customSoftAsk.mainClass",null),allowClass:o.getProp(e,"customSoftAsk.allowClass",null),dismissClass:o.getProp(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:o.getProp(e,"main_class",null),allowClass:o.getProp(e,"allow_class",null),dismissClass:o.getProp(e,"block_class",null)},null!=o.getProp(e,"inapp.host",null)&&(this.inapp={host:o.getProp(e,"inapp.host",null)}),null!=o.getProp(e,"swScope",null)&&(this.swScope=o.getProp(e,"swScope",null)),null!=o.getProp(e,"disable_onsite",null)&&(this.disableOnsite=o.getProp(e,"disable_onsite",!1)),null!=o.getProp(e,"enableSPA",null)&&(this.enableSPA=o.getProp(e,"enableSPA",!1)))}t.default=c,(a=r=r||{}).OLD_SDK="OLD_SDK",a.NEW_SDK="NEW_SDK"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),a=n(1),i=n(0),o=(s.set=function(e,t){var n=s.baseTag+".set";if(null==t)s.remove(e);else{t="boolean"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"boolean"}):"string"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"string"}):JSON.stringify(t),r.default.log(3,n,"Setting ",e,":",t);var i=Date.now(),o=";expires="+new Date(i+31536e6*a.default.COOKIE_STORAGE.SESSION_COOKIE.EXPIRY_YEARS).toUTCString();document.cookie=e+"="+encodeURIComponent(t)+o+";domain="+s.getOrigin()+";path=/;SameSite=None; Secure"}},s.get=function(e){for(var t=s.baseTag+".get",n=e+"=",a=decodeURIComponent(document.cookie).split(";"),o=a.length-1;0<=o;o--){for(var u=a[o];" "===u.charAt(0);)u=u.substring(1);if(0===u.indexOf(n)){var l=u.substring(n.length,u.length);try{l=JSON.parse(l),"string"===i.getProp(l,"MOE_DATA_TYPE",null)?l=(l=i.getProp(l,"actualValue",null))?String(l):null:"boolean"===i.getProp(l,"MOE_DATA_TYPE",null)&&(l=i.getProp(l,"actualValue",null))}catch(e){}return r.default.log(3,t,"Got ",e,":",l),l}}return null},s.remove=function(e){var t=s.baseTag+".remove";document.cookie=e+"=;domain="+s.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",r.default.log(3,t,"Removed ",e)},s.setRaw=function(e,t,n){var a=s.baseTag+".setRaw";if(null==t)s.remove(e);else{r.default.log(3,a,"Setting ",e,":",t);var i="";null!=n&&(i=";expires="+n.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+i+";domain="+s.getOrigin()+";path=/;"}},s.getOrigin=function(){var e=s.baseTag+".getOrigin",t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(r.default.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t},s.baseTag="CookieStorage",s);function s(){}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(a.equal=function(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)},a);function a(e,t){this.key=e,this.value=t}t.default=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.PERMISSION_STATE||(t.PERMISSION_STATE={})).PROMPT="prompt",r.GRANTED="granted",r.DENIED="denied",r.DISMISSED="dismissed"},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=n(3),i=(o.enqueue=function(e,t){var n=o.getLocalStorageQName(e),r=new o;a.default.get(n)&&(r=a.default.get(n)),r.items.push(t),r.items=r.items.slice(Math.max(r.items.length-50,0)),a.default.set(n,r)},o.dequeue=function(e){var t=o.getLocalStorageQName(e),n=a.default.get(t),r=null;return n&&0<n.items.length&&(r=n.items[0],n.items.splice(0,1),a.default.set(t,n)),r},o.isEmpty=function(e){var t=o.getLocalStorageQName(e);return!(a.default.get(t)&&0<a.default.get(t).items.length)},o.purge=function(e){var t=o.getLocalStorageQName(e);o.isEmpty(e)||a.default.remove(t)},o.getLocalStorageQName=function(e){return r.default.PERSISTENT_STORAGE.Q.PREFIX+"_"+e},o);function o(){this.items=[]}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(6),i=(o.prototype.sendMessage=function(e,t){var n=this;return new Promise((function(r,i){var o={id:a.v4(),channel:n.channel,topic:e,message:t};n.addToListener(o,r,i),n.target instanceof HTMLIFrameElement?n.target.contentWindow.postMessage(o,n.target.src):n.target.postMessage(o,"*")}))},o.listenToChannel=function(e,t,n){window.addEventListener("message",(function(r){r.data&&r.data.channel&&r.data.topic&&r.data.channel===e&&r.data.topic===t&&n(r.data,(function(n){var a={id:r.data.id,channel:e,topic:t,message:n};r.source.postMessage(a,r.origin)}))}))},o.prototype.addToListener=function(e,t,n){var a=this;o.pendingPromises[e.id]={resolve:t,reject:n},window.addEventListener("message",(function(e){e.data&&r.getProp(e.data,"channel",null)===a.channel&&null!=o.pendingPromises[e.data.id]&&(o.pendingPromises[e.data.id].resolve(e.data),delete o.pendingPromises[e.data.id])}))},o.pendingPromises={},o);function o(e,t){this.channel=e,this.target=t}t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=n(27),s=n(5),u=n(2),l=n(0),c=n(38),f=n(1),d=(g.spliceReports=function(e){return void 0===e&&(e=g.reports.length),this.reports.splice(0,e)},g.shouldCreateNewBatch=function(){return!g.lastbatchCreatedAt||(new Date).getTime()-g.lastbatchCreatedAt>=f.BATCH.CONFIG.TIME_BETWEEN_BATCHES},g.reactToTriggerEvents=function(){var e=g.baseLogTag+".reactToTriggerEvents";0<g.reports.length&&g.shouldCreateNewBatch()?(u.default.log(1,e,"Trigger Events: Created Batch of "+g.reports.length+" reports",l.convertDateToDateMonthYearFormat()),g.createBatch()):u.default.log(2,e,l.convertDateToDateMonthYearFormat()+": No report's to sync for this event.")},g.periodicSync=function(e){var t=g.baseLogTag+".periodicSync";0<g.reports.length&&g.shouldCreateNewBatch()?(u.default.log(1,t,"Periodic sync: Created Batch of "+g.reports.length+" reports",l.convertDateToDateMonthYearFormat()),g.createBatch()):u.default.log(2,t,l.convertDateToDateMonthYearFormat()+": No report's to sync at this interval. The next sync will attempt in "+e+" seconds")},g.clearInterval=function(){clearInterval(g.periodicSyncInterval),g.lastbatchCreatedAt=null},g.init=function(e){s.default.getInstance().then((function(t){navigator.sendBeacon&&"allowed"===e.s_e_b_e&&t.name!==s.default.BROWSER_NAMES.SAFARI&&t.name!==s.default.BROWSER_NAMES.FIREFOX&&(g.periodicSyncInterval&&g.clearInterval(),0<g.reports.length&&(g.reports=[]),g.periodicSyncInterval=window.setInterval(g.periodicSync.bind(e.p_f_t),1e3*e.p_f_t),c.default.addListeners())}))},g.sendBatch=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:t=g.baseLogTag+".sendBatch",r.label=1;case 1:return r.trys.push([1,3,,4]),[4,i.default.sendBatchOfReports(e).then((function(){g.lastbatchCreatedAt=(new Date).getTime()}))];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),u.default.error(1,t,"Error in sending batch",n),[3,4];case 4:return[2]}}))}))},g.createBatch=function(e){if(0<g.reports.length){var t=g.spliceReports(e);g.sendBatch(t)}},g.addReport=function(e,t){var n=g.baseLogTag+".addReport",r=new o.ReportView(e);g.reports.push(r),g.reports.length===t&&(u.default.log(1,n,"Created Batch of "+t+" reports",l.convertDateToDateMonthYearFormat()),g.createBatch(t))},g.sendBeacon=function(){var e=g.baseLogTag+".sendBeacon";0<g.reports.length&&(i.default.sendBeacon(g.reports),u.default.log(1,e,"Window Unload: Created batch of "+g.reports.length+" reports",l.convertDateToDateMonthYearFormat()))},g.flushReports=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:e=g.baseLogTag+".flushReports",n.label=1;case 1:return n.trys.push([1,4,,5]),c.default.removeEventListeners(),0<g.reports.length?(u.default.log(1,e,"Flushed "+g.reports.length+" reports",l.convertDateToDateMonthYearFormat()),[4,g.sendBatch(g.spliceReports())]):[3,3];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:return t=n.sent(),u.default.error(1,e,"Error in flushing reports",t),[3,5];case 5:return[2]}}))}))},g.baseLogTag="BatchManager",g.reports=[],g.lastbatchCreatedAt=null,g);function g(){}t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a,i=n(0),o=(s.get=function(e,t){return s.makeNetworkCall(s.METHODS.GET,e,t)},s.post=function(e,t){return s.makeNetworkCall(s.METHODS.POST,e,t)},s.makeNetworkCall=function(e,t,n){return void 0===n&&(n={}),new Promise((function(r,a){var o=JSON.stringify(i.getProp(n,"postData",null));t=s.constructFinalUrl(t,i.getProp(n,"queryParams",null));var u=new XMLHttpRequest;u.open(e,t,!0),s.addRequestHeaders(u,i.getProp(n,"headers",{})),u.onreadystatechange=function(){4===u.readyState&&200===u.status?r({status:u.status,responseText:u.responseText}):4===u.readyState&&200!==u.status&&a({code:u.status,reason:u.responseText})},u.send(o)}))},s.addRequestHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e},s.constructFinalUrl=function(e,t){for(var n in e+="?",t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return e},s);function s(){}(a=(r=o=o||{}).METHODS||(r.METHODS={})).GET="GET",a.POST="POST",t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),a=n(3),i=n(1),o=n(0),s=n(4),u=n(0),l=n(7),c=(f.prototype.initiateSessionAndSource=function(){var e=this;return new Promise((function(t,n){setTimeout((function(){e.isSessionRunning()&&e.isCurrentSourceSameAsPreviousSource()||e.startNewSession(),t()}),250)}))},f.prototype.isSessionRunning=function(){return this.getSessionKey()&&!this.isSessionExpired()},f.prototype.isSessionExpired=function(){var e=this.getSessionExpiryTime(),t=l.default.get("wasBrowserInactive");return!(!t&&null!==t)&&(this.isWindowActive()&&l.default.set("wasBrowserInactive",!1),(new Date).getTime()>e)},f.prototype.isNonEventInteractive=function(e){return f.NON_INTERACTIVE_EVENTS.includes(e.name)||0<e.attributes.filter((function(e){return"moe_non_interactive"===e.key&&1===e.value})).length},f.prototype.getCurrentSource=function(){var e=o.deserializeQueryParams(window.location.search);if(!this.isSourceOrganic()){var t="",n={};return Object.keys(e).includes("utm_source")&&(t="utm_"),this.geCustomIdentifiersToTrack().forEach((function(t){e[t]&&(n[t]=e[t])})),{source:e[t+"source"],medium:e[t+"medium"],source_url:window.location.href,term:e[t+"term"],campaign_name:e[t+"campaign"],campaign_id:e.utm_id,content:e[t+"content"],extra:Object.keys(n).length?n:void 0}}},f.prototype.isSourceOrganic=function(){var e=o.deserializeQueryParams(window.location.search),t=Object.keys(e),n=!1;return this.geCustomIdentifiersToTrack().forEach((function(t){e[t]&&(n=!0)})),!t.includes("utm_source")&&!t.includes("source")&&!n},f.prototype.setCurrentSource=function(e){var t=this.getSession();t.currentSource=e,a.default.set(i.default.SESSION_SOURCE.SESSION,t)},f.prototype.getSavedSource=function(){var e=u.getProp(this.getSession(),i.default.SESSION_SOURCE.CURRENT_SOURCE,void 0);if(e)return e},f.prototype.isCurrentSourceSameAsPreviousSource=function(){return!!this.isSourceOrganic()||o.deepCompareObjects(this.getCurrentSource(),this.getSavedSource())},f.prototype.getSessionKey=function(){return u.getProp(this.getSession(),i.default.SESSION_SOURCE.SESSION_KEY,null)},f.prototype.getSessionStartTime=function(){return u.getProp(this.getSession(),i.default.SESSION_SOURCE.SESSION_START_TIME,null)},f.prototype.getSessionExpiryTime=function(){return u.getProp(this.getSession(),i.default.SESSION_SOURCE.SESSION_EXPIRY_TIME,null)},f.prototype.getSessionMaxTime=function(){return u.getProp(this.getSession(),i.default.SESSION_SOURCE.SESSION_MAX_TIME,null)},f.prototype.getSession=function(){return a.default.get(i.default.SESSION_SOURCE.SESSION)},f.prototype.geCustomIdentifiersToTrack=function(){return u.getProp(this.getSession(),i.default.SESSION_SOURCE.CUSTOM_IDENTIFIERS_TO_TRACK,[])||[]},f.prototype.generateSessionKey=function(){return r.v4()},f.prototype.startNewSession=function(){var e=this;s.default.getWebSDKSettings().then((function(t){var n=e.getNumberOfSessions(),r={sessionKey:e.generateSessionKey(),sessionStartTime:(new Date).toISOString(),sessionMaxTime:t.s_i_d,sessionEnabled:t.s_s_s,customIdentifiersToTrack:t.src_ext,sessionExpiryTime:(new Date).getTime()+1e3*t.s_i_d,numberOfSessions:++n};a.default.set(i.default.SESSION_SOURCE.SESSION,r)}))},f.prototype.extendSession=function(){var e=this.getSession();e&&(e.sessionExpiryTime=(new Date).getTime()+1e3*e.sessionMaxTime,a.default.set(i.default.SESSION_SOURCE.SESSION,e))},f.prototype.handleBrowserInactivity=function(e){"hidden"===e&&l.default.set("wasBrowserInactive",!0)},f.prototype.isWindowActive=function(){return!!l.default.get("isWindowActive")},f.prototype.getNumberOfSessions=function(){return u.getProp(a.default.get(i.default.SESSION_SOURCE.SESSION),i.default.SESSION_SOURCE.NUMBER_OF_SESSIONS)||0},f.NON_INTERACTIVE_EVENTS=[i.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD,i.default.EVENT_NAMES.OPT_IN_SHOWN,i.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD,i.default.EVENT_NAMES.LOGOUT],f);function f(){}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(2),i=n(53),o=n(29),s=(u.isValidMetaJSON=function(e){for(var t=!0,n=["campaign_id","campaign_name","template_type","status","expiry_time","updated_time","delivery","user_in_segment"],r=0;r<n.length;r++)if(null==e[n[r]]){t=!1;break}return t},u.getFilters=function(e){return r.getProp(e,"triggerData.primary_condition.attributes.filters",[])},u.getSecondaryFilters=function(e){return r.getProp(e,"triggerData.secondary_condition.attributes.filters",[])},u.getFilterResult=function(e,t){var n=u.getFilters(t),a=u.getSecondaryFilters(t);if(null==n&&null==a)return!0;var s=!0;if(n&&0<n.length){var l=r.getProp(t,"triggerData.primary_condition.attributes.filterOperator","and"),c=n.map((function(t){return i.default.doesEventMatchFilters(e,t)}));s=c[0];for(var f=1;f<c.length;f++)if(l===T.AND){if(!1===(s=s&&c[f]))break}else if(l===T.OR&&!0===(s=s||c[f]))break}if(!1===s)return!1;var d=!0;if(a&&0<a.length){var g=new o.default(t.triggerData.secondary_condition.action_name,[]),p=t.triggerData.secondary_condition.attributes.filterOperator,h=a.map((function(e){return i.default.doesEventMatchFilters(g,e)}));for(d=h[0],f=0;f<h.length;f++)if(p===T.AND){if(!1===(d=d&&h[f]))break}else if(p===T.OR&&!0===(d=d||h[f]))break}return s&&d},u.baseLogTag="OnsiteCampaignMeta",u);function u(e){var t=u.baseLogTag+".constructor";this.campaignId=r.getProp(e,"campaign_id",null),this.campaignName=r.getProp(e,"campaign_name",null),this.templateType=r.getProp(e,"template_type",null);var n=r.getProp(e,"status",null),i=[S.ACTIVE,S.EXPIRED,S.PAUSED];i.indexOf(n)<0?this.status=S.ACTIVE:this.status=i[i.indexOf(n)],this.tag=r.getProp(e,"tag",null),this.triggerData=null,l.validate(r.getProp(e,"trigger"))?this.triggerData=new l(r.getProp(e,"trigger")):a.default.log(2,t,"Rejecting trigger data for :",e),this.expiryTime=r.parseISOString(r.getProp(e,"expiry_time")+"Z"),this.updatedTime=r.parseISOString(r.getProp(e,"updated_time")+"Z"),this.delivery=new b(r.getProp(e,"delivery")),this.userInSegment=r.getProp(e,"user_in_segment",!0),this.display=null;var o=r.getProp(e,"display",null),s=r.getProp(e,"display_filter",null);this.templateType!==A.SELF_HANDLED&&(null!=s?this.display=new P({rules:{uri_filters:s}},this.templateType):null!=o&&(this.display=new P(o,this.templateType)))}t.default=s;var l=(c.validate=function(e){var t=!1;return["primary_condition"].forEach((function(n){null!=r.getProp(e,n,null)&&(t=!0)})),t},c);function c(e){this.cs_id=e.cs_id,this._id=e._id,this.references=e.references,d.validate(e.primary_condition)?this.primary_condition=new d(e.primary_condition):this.primary_condition=null,0<r.getProp(e,"secondary_condition.filters",[]).length&&(this.secondary_condition=new p(e.secondary_condition.filters[0])),this.description=e.description,null!=e.trigger_delay?this.trigger_delay=new f(e.trigger_delay):this.trigger_delay=null}var f=function(e){if(this.delay=r.getProp(e,"delay",0),this.unit=r.getProp(e,"unit","seconds"),this.delay_type=r.getProp(e,"delay_type",""),this.attribute=r.getProp(e,"attribute",""),r.getProp(e,"delay",null)&&r.getProp(e,"unit",null)){var t=this.delay;"minutes"!==this.unit&&"hours"!==this.unit&&"days"!==this.unit||(t*=60),"hours"!==this.unit&&"days"!==this.unit||(t*=60),"days"===this.unit&&(t*=24),this.delayInSeconds=t}else this.delayInSeconds=0},d=(g.validate=function(e){var t=!1;return e&&null!=e.action_name&&(t=!0),t},g);function g(e){this.action_name=null,this.attributes=null,this.action_name=r.getProp(e,"action_name",null);var t=r.getProp(e,"attributes",null);_.validateJson(t)&&(this.attributes=new _(t))}var p=(h.validate=function(e){var t=!1;return e&&null!=e.action_name&&(t=!0),t},h);function h(e){this.action_name=null,this.attributes=null,this.action_name=r.getProp(e,"action_name",null);var t=r.getProp(e,"attributes",null);_.validateJson(t)&&(this.attributes=new _(t))}var S,E,T,m,_=(v.validateJson=function(e){if(null==e)return!1;for(var t=["filters"],n=0;n<t.length;n++)if(null==e[t[n]])return!1;return!0},v);function v(e){this.filters=[],this.filterOperator=r.getProp(e,"filter_operator",T.AND),this.filters=r.getProp(e,"filters",[])}t.TriggerAttributes=_,(E=S=t.OnsiteCampaignStatus||(t.OnsiteCampaignStatus={})).ACTIVE="ACTIVE",E.PAUSED="PAUSED",E.EXPIRED="EXPIRED",(m=T=t.FILTER_OPERATORS||(t.FILTER_OPERATORS={})).AND="and",m.OR="or";var b=function(e){this.priority=r.getProp(e,"priority",0),this.dismiss_interval=r.getProp(e,"dismiss_interval",0),this.fc_meta=new y(r.getProp(e,"fc_meta",null))},y=function(e){this.count=0,this.delay=0,this.ignore_global_delay=!1,null!=e&&(this.count=r.getProp(e,"count",0),this.delay=r.getProp(e,"delay",0),this.ignore_global_delay=r.getProp(e,"ignore_global_delay",!1))};t.CampaignFCModel=y;var I=function(e){this.aggregations=[],this.filters=[],this.aggregations=r.getProp(e,"aggregations",[]),this.filter_operator=r.getProp(e,"filter_operator",T.AND),this.filters=r.getProp(e,"filters",[])};t.DisplayFilter=I;var A,O,P=(N.getDefaultValue=function(e,t){return{blocking:{POP_UP:!0,BANNER:!1},push_page:{POP_UP:!1,BANNER:!0},sticky:{POP_UP:!1,BANNER:!0},scrollable:{POP_UP:!1,BANNER:!0},show_over_campaigns:{POP_UP:!1,BANNER:!1}}[e][t]},N);function N(e,t){this.config={blocking:r.getProp(e,"config.blocking",N.getDefaultValue("blocking",t)),pushPage:r.getProp(e,"config.push_page",N.getDefaultValue("push_page",t)),sticky:r.getProp(e,"config.sticky",N.getDefaultValue("sticky",t)),scrollable:r.getProp(e,"config.scrollable",N.getDefaultValue("scrollable",t)),showOverOtherCampaigns:r.getProp(e,"config.show_over_campaigns",N.getDefaultValue("show_over_campaigns",t))},this.rules={uriFilters:new I(r.getProp(e,"rules.uri_filters",{}))}}t.DisplaySettings=P,(O=A=t.TEMPLATE_TYPE||(t.TEMPLATE_TYPE={})).SELF_HANDLED="SELF_HANDLED",O.POP_UP="POP_UP",O.BANNER="BANNER"},function(e,t,n){var r,a,i=n(15),o=n(16),s=0,u=0;e.exports=function(e,t,n){var l=t&&n||0,c=t||[],f=(e=e||{}).node||r,d=void 0!==e.clockseq?e.clockseq:a;if(null==f||null==d){var g=i();null==f&&(f=r=[1|g[0],g[1],g[2],g[3],g[4],g[5]]),null==d&&(d=a=16383&(g[6]<<8|g[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),h=void 0!==e.nsecs?e.nsecs:u+1,S=p-s+(h-u)/1e4;if(S<0&&void 0===e.clockseq&&(d=d+1&16383),(S<0||s<p)&&void 0===e.nsecs&&(h=0),1e4<=h)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=p,a=d;var E=(1e4*(268435455&(p+=122192928e5))+(u=h))%4294967296;c[l++]=E>>>24&255,c[l++]=E>>>16&255,c[l++]=E>>>8&255,c[l++]=255&E;var T=p/4294967296*1e4&268435455;c[l++]=T>>>8&255,c[l++]=255&T,c[l++]=T>>>24&15|16,c[l++]=T>>>16&255,c[l++]=d>>>8|128,c[l++]=255&d;for(var m=0;m<6;++m)c[l+m]=f[m];return t||o(c)}},function(e,t,n){var r=n(15),a=n(16);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[i+s]=o[s];return t||a(o)}},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),i=n(6),o=n(9),s=n(0),u=(l.baseLogTag="ReportPostData",l);function l(){var e=l.baseLogTag+".constructor",t=o.default.getSync().getAttribute("id");t=t?t.toString():void 0;var n=window.analytics,r=void 0,s=void 0;if(n){s=n._VERSIONS;try{r=n.user().anonymousId()}catch(t){a.default.error(1,e,"Error getting anonymous id from segment api",t)}}this.c=void 0,this.h="",this.identifiers=void 0,(t||r)&&(this.identifiers={moe_user_id:t,segment_id:r}),this.meta={bid:i.v4(),segmentSdkData:n?s:void 0}}var c,f,d,g=(p.baseLogTag="ReportClass",p);function p(e,t,n){var a,i;this.type=e,this.getParams=t,this.event=n,this.postData=new u;var o={},l={};try{for(var c=r(n.attributes),f=c.next();!f.done;f=c.next()){var d=f.value;if(d&&null!=d.key&&(this.status=p.STATUS.VALID,null!=d.value))if("function"==typeof d.value.getMonth){var g={};g[d.key]=Math.round(d.value.getTime()-6e4*d.value.getTimezoneOffset()),null==l.timestamp&&(l.timestamp=[]),l.timestamp.push(g)}else o[d.key]=d.value}}catch(e){a={error:e}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}this.postData.e=n.name,this.postData.a=o,this.postData.c=s.isObjectEmpty(l)?void 0:l,window&&window.location&&null!=window.location.href&&(this.postData.url=window.location.href)}(f=(c=g=g||{}).STATUS||(c.STATUS={}))[f.INVALID=0]="INVALID",f[f.VALID=1]="VALID",(d=c.REPORT_ADD_TYPE||(c.REPORT_ADD_TYPE={}))[d.USER_ATTRIBUTE=0]="USER_ATTRIBUTE",d[d.EVENT=1]="EVENT",t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(20),a=(i.isTokenValid=function(e,t){return new Promise((function(n,a){if(null!=e&&null!=t){var o="https://iid.googleapis.com/iid/info/"+e+"?details=true",s={headers:{authorization:"key="+t}};r.default.get(o,s).then((function(e){200===e.status?n(!0):n(!1)})).catch((function(r){0===r.code?setTimeout((function(){n(i.isTokenValid(e,t))}),3e3):n(!1)}))}else n(!1)}))},i);function i(){}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=(i.baseLogTag="ReportAddViewEvent",i);function i(e){this.EVENT_ACTION=e.event.name,this.EVENT_ATTRS=o(e.event.attributes),this.EVENT_G_TIME=(new Date).getTime().toString(),this.EVENT_L_TIME=r.convertDateToDateMonthYearFormat(),this.EVENT_ATTRS_CUST=e.postData.c,this.N_I_E=e.postData.nie}t.ReportView=a;var o=function(e){var t={};return e.forEach((function(e){t[e.key]=e.value})),t}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(1),s=n(4),u=n(13),l=n(29),c=n(25),f=n(41),d=n(21),g=(p.track=function(e,t,n){var g=this,p="MoEngage.event.trackEvent";return new Promise((function(h,S){return r(g,void 0,void 0,(function(){var g,S,E,T,m=this;return a(this,(function(_){switch(_.label){case 0:return n=!!n,"string"==typeof e&&e?[3,1]:(i.default.log(1,p,"Event name not a string or null or empty string:",e),h({error:5001,message:"Event name can not be null"}),[3,6]);case 1:if(_.trys.push([1,5,,6]),g=[],null!=t&&(null===t||t!==Object(t)||"[object Object]"!==Object.prototype.toString.call(t)))return[3,3];for(S in null==t&&(t={}),t)t.hasOwnProperty(S)&&g.push(new u.default(S,t[S]));return[4,l.default.createEvent(e,g)];case 2:return E=_.sent(),f.default.addEvent(E),s.default.collectGetParams().then((function(e){var t=new c.default(c.default.REPORT_ADD_TYPE.EVENT,e,E),i=new d.default;s.default.getWebSDKSettings().then((function(e){return r(m,void 0,void 0,(function(){var r,u,l;return a(this,(function(a){return r={session_id:i.getSessionKey(),start_time:i.getSessionStartTime(),background_initiated:0},u=[],(l=i.getCurrentSource())&&(i.setCurrentSource(l),u.push(l)),t.postData.meta.session=r,u.length&&(t.postData.meta.source=u),i.isNonEventInteractive(E)&&(t.postData.nie=1),s.default.reportAdd(t,n).then((function(){e.s_s_s!==o.SESSION_SOURCE_STATUS.ALLOWED||i.isNonEventInteractive(E)||i.extendSession(),h(!0)})),[2]}))}))}))})),[3,4];case 3:i.default.error(1,p,"Event attributes were not passed a key-value pair object for event: ",e),h({error:5002,message:"Event value needs to be a key-value pair object"}),_.label=4;case 4:return[3,6];case 5:return T=_.sent(),i.default.error(1,p,"Error occurred in tracking events ",T),[3,6];case 6:return[2]}}))}))}))},p);function p(){}t.default=g},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(13),o=n(1),s=n(9),u=n(2),l=n(21),c=(f.createUserAttributeEvent=function(e){return new Promise((function(t,n){var r=[],a=e.key;switch(e.key){case"id":e.key=o.default.ATTRIBUTE_NAMES.ID;break;case"email":e.key=o.default.ATTRIBUTE_NAMES.EMAIL;break;case"name":e.key=o.default.ATTRIBUTE_NAMES.NAME;break;case"first_name":e.key=o.default.ATTRIBUTE_NAMES.FIRST_NAME;break;case"last_name":e.key=o.default.ATTRIBUTE_NAMES.LAST_NAME;break;case"mobile":e.key=o.default.ATTRIBUTE_NAMES.MOBILE;break;case"gender":e.key=o.default.ATTRIBUTE_NAMES.GENDER;break;case"birthday":e.key=o.default.ATTRIBUTE_NAMES.BDAY}r.push(e),s.default.get().then((function(n){var s=n.indexOfAttribute("oldUniqueIds");-1<s&&null!=n.attributes[s].value&&0<n.attributes[s].value.length&&r.push(new i.default(o.default.ATTRIBUTE_NAMES.ID_MODIFIED,n.attributes[s].value[n.attributes[s].value.length-1])),e.key!==a&&u.default.log(2,"Event.createUserAttributeEvent","Key changed to MoE reserved keyname: ",e.key),t(new f(o.default.EVENT_NAMES.USER_ATTRIBUTE,r,!1))}))}))},f.createEvent=function(e,t,n){var c=this;return new Promise((function(d,g){s.default.get().then((function(s){return r(c,void 0,void 0,(function(){var r,c,g,p;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=new i.default(o.default.EVENT_ATTRIBUTES_NAMES.LOGGED_IN_STATUS,!!s.getAttribute("id")),[4,(c=new l.default).initiateSessionAndSource()];case 1:return a.sent(),g=new i.default(o.default.EVENT_ATTRIBUTES_NAMES.FIRST_VISIT,c.getNumberOfSessions()<=o.PAGE_LIFE_CYCLE.FIRST_SEEN_SESSIONS),t.push(r,g),d(new f(e,t,n)),[3,3];case 2:return p=a.sent(),u.default.error(1,"Event.createEvent","Error occurred in create events ",p),[3,3];case 3:return[2]}}))}))}))}))},f);function f(e,t,n){void 0===n&&(n=!0),this.name=e,this.attributes=t,n&&this.attributes.push(new i.default(o.default.EVENT_ATTRIBUTES_NAMES.URL,location.href))}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a,i,o=n(31),s=(u.prototype.validate=function(){return!(this.availableOperations.indexOf(this.filter.operator)<0)},u.prototype.checkEq=function(){var e=this,t=!1;return this.event.attributes.forEach((function(n){var a=n.value,i=e.filter.value;e.dataType===r.STRING&&typeof a===r.STRING&&(a=e.removeSpecialChars(a),i=e.removeSpecialChars(i)),n.key===e.filter.name&&(e.dataType!==r.STRING||e.filter.case_sensitive?a===i&&(t=!0):a.toLowerCase()===i.toLowerCase()&&(t=!0))})),t},u.prototype.checkExists=function(){var e=this,t=!1;return this.event.attributes.forEach((function(n){n.key===e.filter.name&&(t=!0)})),t},u.prototype.removeSpecialChars=function(e){return e.replace(o.regex.REMOVE_TRAIL_CHARS,"")},u);function u(e,t,n,r){this.dataType=e,this.availableOperations=t,this.event=n,this.filter=r}t.default=s,(a=r=t.TriggerDataTypes||(t.TriggerDataTypes={})).BOOL="bool",a.STRING="string",a.DATE="datetime",a.NUMBER="double",a.LONG="long",(i=t.TriggerOperators||(t.TriggerOperators={})).EQ="is",i.LT="lessThan",i.GT="greaterThan",i.BETWEEN="between",i.IN="in",i.EXISTS="exists",i.CONTAINS="contains",i.STARTSWITH="startsWith",i.ENDSWITH="endsWith",i.INTHELAST="inTheLast",i.INTHENEXT="inTheNext",i.AFTER="after",i.BEFORE="before",i.ON="on",i.TODAY="today"},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},a=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},o=this;Object.defineProperty(t,"__esModule",{value:!0});var s=n(22),u=n(1),l=n(0),c=n(44),f=n(2);t.getClickTracker=function(e,t,n){return null==e.campaignId?function(){}:function(){return c.default.campaingsStatsStore.getItem(e.campaignId).then((function(t){t=null!=t?r({},t,{clicks:l.getProp(t,"clicks",0)+1}):{clicks:1},c.default.campaingsStatsStore.setItem(e.campaignId,t)})),null==n&&(n={}),d().track_event(u.INAPP_CONSTANTS.EVENT_NAMES[t].CLICK,r({campaign_id:e.campaignId,campaign_name:e.campaignName,type:u.INAPP_CONSTANTS.EVENT_NAMES[t].TYPE},n))}},t.getImpressionTracker=function(e,t){return null==e.campaignId?function(){}:function(){return c.default.initialize().then((function(){c.default.campaingsStatsStore.getItem(e.campaignId).then((function(t){t=null!=t?r({},t,{impressions:l.getProp(t,"impressions",0)+1,lastImpression:new Date}):{impressions:1,lastImpression:new Date},c.default.campaingsStatsStore.setItem(e.campaignId,t)}))})),d().track_event(u.INAPP_CONSTANTS.EVENT_NAMES[t].IMPRESSION,{campaign_id:e.campaignId,campaign_name:e.campaignName,type:u.INAPP_CONSTANTS.EVENT_NAMES[t].TYPE})}},t.sendDismissEvent=function(e,t,n){var r=n?u.INAPP_CONSTANTS.EVENT_NAMES[t].AUTO_DISMIS:u.INAPP_CONSTANTS.EVENT_NAMES[t].DISMISS;d().track_event(r,{campaign_id:e.campaignId,campaign_name:e.campaignName,type:u.INAPP_CONSTANTS.EVENT_NAMES[t].TYPE})},t.sendDeliveredEvent=function(e,t){d().track_event(u.INAPP_CONSTANTS.EVENT_NAMES[t].DELIVERED,{campaign_id:e.campaignId,campaign_name:e.campaignName,type:u.INAPP_CONSTANTS.EVENT_NAMES[t].TYPE})};var d=function(){return window.Moengage},g=(p.isValid=function(e,t){return!p.isCampaignExpired(e)&&p.isCampaignActive(e)&&p.isUserInCampaignSegment(e)&&p.isCampaignWithinFC(e,t)},p.isValidMessagingCampaign=function(e,t,n,r,a){return p.canCampaignBeRenderedOverExisting(e,a)&&p.hasCampaignClearedSelfDelay(e,t)&&p.hasCampaignClearedGlobalDelay(e,n,r)},p.isCampaignExpired=function(e){if((new Date).getTime>e.expiryTime.getTime){var t=p.baseLogTag+".isValid";return f.default.warn(1,t,"Campaign "+e.campaignId+" : Expired"),!0}return!1},p.isCampaignActive=function(e){var t=p.baseLogTag+".isValid";return e.status===s.OnsiteCampaignStatus.ACTIVE||(f.default.warn(1,t,"Campaign "+e.campaignId+" : Status is "+e.status),!1)},p.isUserInCampaignSegment=function(e){var t=p.baseLogTag+".isValid";return!!e.userInSegment||(f.default.warn(1,t,"Campaign "+e.campaignId+" : User is not in segment"),!1)},p.isCampaignWithinFC=function(e,t){var n=p.baseLogTag+".isValid";if([s.TEMPLATE_TYPE.SELF_HANDLED].indexOf(e.templateType)<0){var r=l.getProp(e,"delivery.fc_meta.count",0);if(0<r){var a=l.getProp(t,"impressions",0);if(null!=t)return!(r<=a&&(f.default.warn(1,n,"Campaign "+e.campaignId+" : FC reached. "+t.impressions+" times shown"),1))}}return!0},p.canCampaignBeRenderedOverExisting=function(e,t){var n=p.baseLogTag+".isValid";return!(0<(t&&t.length)&&!e.display.config.showOverOtherCampaigns&&(f.default.warn(1,n,"Can not show "+e.campaignId+" over other existing campaigns"),1))},p.hasCampaignClearedSelfDelay=function(e,t){var n=p.baseLogTag+".isValid",r=l.getProp(e,"delivery.fc_meta.delay",0);try{if(0<r&&null!=t){var a=t.lastImpression,i=((new Date).getTime()-a.getTime())/1e3;if(i<=l.getProp(e,"delivery.fc_meta.delay",0))return f.default.warn(1,n,"Can't render "+e.campaignId+" as it was rendered "+i+" seconds ago."),!1}}catch(t){return f.default.error(1,n,"Can't check self delay for "+e.campaignId,t),!1}return!0},p.hasCampaignClearedGlobalDelay=function(e,t,n){var r=p.baseLogTag+".isValid",a=l.getProp(e,"delivery.fc_meta.ignore_global_delay",!1);try{if(!a){var i=new Date;if(n){var o=(i.getTime()-n.getTime())/1e3;if(t&&o<=t)return f.default.log(1,r,"Can't render "+e.campaignId+" as last global campaign was rendered "+o+" seconds ago."),!1}}}catch(e){return f.default.error(1,r,"Error checking global delay:",e),!1}return!0},p.comparator=function(e,t){return t.delivery.priority>e.delivery.priority?1:t.delivery.priority<e.delivery.priority?-1:t.updatedTime>e.updatedTime?1:-1},p.baseLogTag="CampaignUtils",p);function p(){}t.CampaignUtils=g,t.filterAndSortCampaigns=function(e){return a(o,void 0,void 0,(function(){var t,n,r,a;return i(this,(function(i){switch(i.label){case 0:t="filterAndSortCampaigns",n=e.map((function(e){return c.default.campaingsStatsStore.getItem(e.campaignId)})),r=[],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all(n)];case 2:return r=i.sent(),[2,e.filter((function(e,t){return g.isValid(e,r[t])})).sort(g.comparator)];case 3:return a=i.sent(),f.default.error(1,t,"Error filtering and sorting campaigns: ",a),[2,[]];case 4:return[2]}}))}))},t.validateMessagingCampaigns=function(e,t){return a(o,void 0,void 0,(function(){var n,r,a,o,s,l;return i(this,(function(i){switch(i.label){case 0:return n="validateMessagingCampaigns",r=e.map((function(e){return c.default.campaingsStatsStore.getItem(e.campaignId)})),[4,c.default.serviceMetaStore.getItem(u.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.GLOBAL_DELAY)];case 1:return a=i.sent(),[4,c.default.serviceMetaStore.getItem(u.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME)];case 2:o=i.sent(),s=[],i.label=3;case 3:return i.trys.push([3,5,,6]),[4,Promise.all(r)];case 4:return s=i.sent(),[2,e.filter((function(e,n){return g.isValidMessagingCampaign(e,s[n],a,o,t)}))];case 5:return l=i.sent(),f.default.error(1,n,"Error vaildating messaging campaigns: ",l),[2,[]];case 6:return[2]}}))}))};var h=(S.REMOVE_TRAIL_CHARS=/[^\w\s]+$/gi,S);function S(){}t.regex=h,t.dismissActiveOsm=function(){var e=window.Moengage;e.onsite.displayManager&&Object.keys(e.onsite.displayManager.campaignRenderMap).forEach((function(t){e.onsite.displayManager.campaignRenderMap[t].isActive()&&e.onsite.displayManager.dismissInapp(t)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),a=n(17),i=n(1),o=n(36),s=n(4),u=n(0),l=i.default.PERSISTENT_STORAGE.Q,c=(f.clear=function(e){for(var t=f.baseLogTag+".clear",n=[],i=function(){switch(e){case l.REPORT:var i=a.default.dequeue(l.REPORT);n.push((function(e){s.default.reportAdd(i).then((function(){e()}))}));break;case l.DEVICE:a.default.dequeue(l.DEVICE)&&n.push((function(e){s.default.deviceAdd().then((function(){e()}))}));break;default:r.default.error(1,t,"Do not know how to handle queue with name:",e)}};!a.default.isEmpty(e);)i();setTimeout((function(){f.processing[e]=!0,o(n,5,(function(t,n){f.processing[e]=!1}))}),0)},f.startPeriodicClear=function(e){var t=f.baseLogTag+".startPeriodicCleanQ";function n(){a.default.isEmpty(e)?(r.default.log(1,t,"If you see multiple event tracks with same, they were captured over multiple visits or page refreshes."),u.getProp(f.processing,e,!1)||f.clearInterval(e)):(f.clear(e),r.default.log(1,t,"Starting periodic queue clear for",e))}f.clearInterval(e),n(),f.intervals[e]=setInterval(n,6e3)},f.clearInterval=function(e){null!=f.intervals[e]&&(clearInterval(f.intervals[e]),f.intervals[e]=null)},f.baseLogTag="QManager",f.intervals={},f.processing={},f);function f(){}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=n(26),i=n(18),o=n(3),s=n(14),u=n(11),l=(c.prototype.showHardAsk=function(){var e=this;return new Promise((function(t,n){e.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.EPHEMERAL_STORAGE,{requestType:"set",key:r.default.EPHEMERAL_STORAGE.INIT_DATA,value:u.default.get()}).then((function(a){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:r.default.PERSISTENT_STORAGE.INIT_DATA,value:u.default.get()}).then((function(a){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"get",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}).then((function(a){null!=a.message?e.isTokenValid().then((function(i){if(i)t({state:s.PERMISSION_STATE.GRANTED,subscriptionDetails:a.message});else{var o=n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}),u=e.removeToken();Promise.all([o,u]).then((function(){e.openNewTabForPermission(n).then((function(e){t(e)}))}))}})):e.openNewTabForPermission(n).then((function(e){t(e)}))}))}))}))}))}))},c.prototype.openNewTabForPermission=function(e){var t=this;return new Promise((function(n){e.sendMessage(r.default.HTML_COMM.TOPICS.CONFIG,t.sdkSettings).then((function(e){i.default.listenToChannel(r.default.HTML_COMM.CHANNEL.SUBD,r.default.HTML_COMM.TOPICS.HARD_ASK_RESULT,(function(e,t){t("Ok");var r=e.message;n(r)})),window.open(t.sdkSettings.platformSettings.chrome.subdomainURL+"?startSubscription=true","_blank","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=400,height=400")}))}))},c.prototype.getCurrentPermissionState=function(){var e=this;return new Promise((function(t,n){e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERMISSION_STATE,{requestType:"get"}).then((function(e){t(e.message)}))}))}))},c.prototype.getPushTokenDetails=function(){var e=this;return new Promise((function(t){e.getOrSetInSubDomainStorage(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS).then((function(e){t(e)}))}))},c.prototype.setInSubDomainStorage=function(e,t){var n=this;return new Promise((function(a){n.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:e,value:t}).then((function(e){a()}))}))}))},c.prototype.logout=function(){var e=this;return new Promise((function(t){e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"logout"}).then((function(e){t()}))}))}))},c.prototype.getInSubdomain=function(e){var t=this;return new Promise((function(n){t.getIframeCommunicator().then((function(t){t.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"get",key:e}).then((function(e){null==e.message?n(null):n(e.message)})).catch((function(e){n(null)}))})).catch((function(e){n(null)}))}))},c.prototype.setInSubdomain=function(e,t){var n=this;return new Promise((function(a,i){n.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:e,value:t}).then((function(e){a()})).catch((function(e){i(e)}))})).catch((function(e){i(e)}))}))},c.prototype.getOrSetInSubDomainStorage=function(e,t){var n=this;return new Promise((function(r){n.getInSubdomain(e).then((function(a){null==a?n.setInSubdomain(e,t).then((function(){r(t)})).catch((function(e){r(t)})):r(a)}))}))},c.prototype.isTokenValid=function(){var e=this;return new Promise((function(t){e.getPushTokenDetails().then((function(n){n&&n.token?a.default.isTokenValid(n.token,e.sdkSettings.platformSettings.chrome.apiKey).then((function(n){n?t(n):e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}).then((function(){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS}).then((function(){t(n)}))}))}))})):t(!1)}))}))},c.prototype.removeToken=function(){var e=this;return new Promise((function(t){o.default.remove(r.default.PERSISTENT_STORAGE.PUSH_TOKEN),e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.PUSH_TOKEN}).then((function(e){t()}))}))}))},c.prototype.getIframeCommunicator=function(){var e=this;return new Promise((function(t){c.iframeCommunicator?t(c.iframeCommunicator):e.getIframe().then((function(e){c.iframeCommunicator=new i.default(r.default.HTML_COMM.CHANNEL.MAIN,e),t(c.iframeCommunicator)}))}))},c.prototype.getIframe=function(){var e=this;return new Promise((function(t,n){if(null==c.iframe){var r=document.createElement("iframe");r.id="moengage-subd-iframe",r.style.display="none",r.src=e.sdkSettings.platformSettings.chrome.subdomainURL,document.body.appendChild(r),(c.iframe=r).addEventListener("load",(function(){c.iframeLoaded=!0,t(r)}))}else c.iframeLoaded?t(c.iframe):setTimeout((function(){e.getIframe().then((function(e){t(e)}))}),500)}))},c.prototype.showNotification=function(e){var t=this;this.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.SHOW_NOTIF,{notification:e,config:t.sdkSettings})}))},c.baseLogTag="ChromeHTTPNotificationManager",c.iframeLoaded=!1,c);function c(e){var t=this;this.sdkSettings=e,this.getIframe(),i.default.listenToChannel(r.default.HTML_COMM.CHANNEL.SUBD,r.default.HTML_COMM.TOPICS.CONFIG,(function(e,n){n(t.sdkSettings)}))}t.default=l},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(10),s=(u.initStore=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return null==u.ready&&(u.offlineDataStore=o.createInstance({driver:[o.INDEXEDDB],name:i.OFFLINE.DATABASE_NAME,storeName:i.OFFLINE.STORES.OFFLINE_DATA.NAME}),u.ready=Promise.resolve(u.offlineDataStore.ready())),[4,u.ready];case 1:return[2,e.sent()]}}))}))},u.initialize=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,u.initStore()];case 1:return e.sent(),[2]}}))}))},u);function u(){}t.default=s},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t){e.exports=function(e,n,r){if("number"!=typeof n)throw new Error("second argument must be a Number");var a,i,o,s,u,l=!0;function c(e){function n(){r&&r(e,a),r=null}l?t.nextTick(n):n()}function f(t,n,r){if(a[t]=r,n&&(u=!0),0==--o||n)c(n);else if(!u&&d<i){var l;s?(l=s[d],d+=1,e[l]((function(e,t){f(l,e,t)}))):(l=d,d+=1,e[l]((function(e,t){f(l,e,t)})))}}o=i=Array.isArray(e)?(a=[],e.length):(s=Object.keys(e),a={},s.length);var d=n;o?s?s.some((function(t,r){if(e[t]((function(e,n){f(t,e,n)})),r===n-1)return!0})):e.some((function(e,t){if(e((function(e,n){f(t,e,n)})),t===n-1)return!0})):c(null),l=!1}}).call(this,n(37))},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,l=[],c=!1,f=-1;function d(){c&&u&&(c=!1,u.length?l=u.concat(l):f=-1,l.length&&g())}function g(){if(!c){var e=s(d);c=!0;for(var t=l.length;t;){for(u=l,l=[];++f<t;)u&&u[f].run();f=-1,t=l.length}u=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||c||s(g)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),a=(i.visibilityChange=function(){"hidden"===document.visibilityState&&(i.windowClosed?r.default.sendBeacon():r.default.reactToTriggerEvents())},i.beforeUnload=function(){i.windowClosed=!0},i.removeEventListeners=function(){document.removeEventListener("visibilitychange",i.visibilityChange,!1),window.removeEventListener("beforeunload",i.beforeUnload,!1)},i.addListeners=function(){document.addEventListener("visibilitychange",i.visibilityChange,!1),window.addEventListener("beforeunload",i.beforeUnload,!1)},i.windowClosed=!1,i);function i(){}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=(i.getListeners=function(){return this.listeners},i.getTopicListeners=function(e){return r.getProp(i.topicListeners,e,[])},i.addListener=function(e){i.listeners.push(e)},i.addTopicListener=function(e,t){i.topicListeners[e]=i.getTopicListeners(e),i.topicListeners[e].push(t)},i.broadcast=function(e){i.listeners.map((function(t){t(e)})),r.getProp(i.topicListeners,e.topic,[]).map((function(t){t(e)}))},i.broadcastToWindow=function(e){window&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data?e.data:null}}))},i.deprecatedSdkCallback=function(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))},i.resetAllListeners=function(){i.listeners=[],i.topicListeners={}},i.listeners=[],i.topicListeners={},i);function i(){}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=n(2),i=n(3),o=n(8),s=n(5),u=n(9),l=n(4),c=n(50),f=n(14),d=n(51),g=n(28),p=n(12),h=n(0),S=n(47),E=(T.prototype.callWebPush=function(){var e=this,t=T.baseLogTag+".callWebPush";this.isWebPushEnabled()&&this.notificationManager.getCurrentPermissionState().then((function(n){function o(){u.default.get().then((function(o){var s=!1;null!=o.getAttribute("email")&&(s=!0),o.deviceAdded=s,o.save().then((function(){e.notificationManager.removeToken().then((function(){n===f.PERMISSION_STATE.DENIED?a.default.log(1,t,"Not asking for permission as current state is denied."):(i.default.remove(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME),e.startPushSubscription())}))}))}))}var l=i.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN);if(null==l&&n!==f.PERMISSION_STATE.DENIED)e.startPushSubscription();else if(null!=l&&n===f.PERMISSION_STATE.DENIED)a.default.log(1,t,"User has removed the permission"),a.default.image(1,r.default.GIFS.SAD),g.default.track(r.default.EVENT_NAMES.UNSUBSCRIBED,{Source:"Website"}).then((function(){o()}));else if(n===f.PERMISSION_STATE.DENIED)a.default.warn(1,t,"Not proceeding with push subscription as current state is denied");else if(null!=l&&n===f.PERMISSION_STATE.GRANTED)e.browser.name===s.default.BROWSER_NAMES.CHROME?h.isVapid(e.sdkSettings.platformSettings,e.browser)?e.startPushSubscription():e.notificationManager.isTokenValid().then((function(n){n?(e.startPushSubscription(),a.default.log(1,t,"Push token is valid"),e.notificationManager.getPushTokenDetails().then((function(e){a.default.customLabel(1,t,"token",e.token)}))):(a.default.warn(1,t,"Push token has expired. Trying to get a new token. This is a Chrome only feature."),o())})):(e.startPushSubscription(),e.notificationManager.getPushTokenDetails().then((function(e){a.default.customLabel(1,t,"token",e.token)})));else if(e.sdkSettings.isDomainLevelStorage)if("granted"===p.default.get(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS)){var c=p.default.get(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS).domain;c&&c===window.location.origin?(a.default.log(1,t,"It seems that the user has unsubscribed manually. Starting push subscription.."),e.startPushSubscription()):a.default.log(1,t,"Not showing opt-in as user subscribed to sub-domain")}else e.startPushSubscription();else o()})).catch((function(e){a.default.error(1,t,"Error in getting current state:",e)}))},T.prototype.startPushSubscription=function(){function e(){i.default.set(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS,f.PERMISSION_STATE.PROMPT);var e=i.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN);t.notificationManager.showHardAsk().then((function(o){i.default.set(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS,o.state),o.state===f.PERMISSION_STATE.GRANTED?null!=o.subscriptionDetails.token?(i.default.set(r.default.PERSISTENT_STORAGE.PUSH_TOKEN,o.subscriptionDetails.token),o.subscriptionDetails.domain=window.location.origin,i.default.set(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,o.subscriptionDetails),o.subscriptionDetails.token&&e!==o.subscriptionDetails.token&&l.default.deviceAdd().then((function(){a.default.image(1,r.default.GIFS.AMAZED),u.default.getSync().subscribedToOldSdk?a.default.log(1,n,"User subscribed from older sdk, hence not sending subscription event"):(null!=e?S.default.addAttribute("Web Migrated User","true"):(S.default.addAttribute("Web Push Preference","granted"),S.default.addAttribute("Web Subscription URL",location.href)),g.default.track(r.default.EVENT_NAMES.USER_SUBSCRIBED,{MOE_WEB_PUSH_TOKEN:o.subscriptionDetails.token}))})),t.sdkSettings.isDomainLevelStorage&&(p.default.set(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,o.subscriptionDetails),p.default.set(r.default.PERSISTENT_STORAGE.PUSH_TOKEN,o.subscriptionDetails.token))):(a.default.error(1,n,"Push token was received as null."),a.default.error(1,n,"Please contact MoEngage support if this troubleshooting does not solve the issue.")):o.state===f.PERMISSION_STATE.DENIED&&a.default.image(1,r.default.GIFS.SAD)})).catch((function(e){a.default.warn(1,n,e)}))}var t=this,n=T.baseLogTag+".startPushSubscription";this.notificationManager.getCurrentPermissionState().then((function(s){if(s===f.PERMISSION_STATE.GRANTED)t.sdkSettings.optInConfig.type!==o.OptInConfig.TYPE.ONE_CLICK&&a.default.log(1,n,"Skipping soft ask as browser permission is set to allow all notifications"),e();else{var u=parseInt(i.default.get(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME)),l=(i.default.get(r.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS),i.default.get(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS),(Date.now()-u)/36e5);if(!u||l>t.sdkSettings.optInConfig.reappearTime)t.softAskManager?t.softAskManager.showSoftAsk().then((function(t){t.showHardAsk&&e()})):a.default.log(1,n,"SoftAskManager not set.");else{var c,d=void 0;c=l<1?(d=Math.floor(60*l),"minute(s)"):(d=Math.floor(100*l)/100,"hour(s)"),a.default.log(1,n,"Not showing opt in as last it was shown",d,c,"back on",new Date(u),". Reappear time is set to",t.sdkSettings.optInConfig.reappearTime,"hours."),a.default.log(1,n,"You can clear localstorage to get opt-in again.")}}}))},T.prototype.isWebPushEnabled=function(){return o.default.isFeatureEnabled(this.sdkSettings,r.default.SDK_FEATURES.WEB_PUSH)&&!this.browser.isIncognito&&0<=T.SUPPORTED_BROWSERS.indexOf(this.browser.name)},T.prototype.getPermissionState=function(){return this.notificationManager.getCurrentPermissionState()},T.prototype.showNotification=function(e){this.notificationManager&&this.notificationManager.showNotification(e)},T.baseLogTag="WebPushManager",T.SUPPORTED_BROWSERS=[s.default.BROWSER_NAMES.CHROME,s.default.BROWSER_NAMES.FIREFOX,s.default.BROWSER_NAMES.OPERA],T);function T(e,t){this.notificationManager=null,this.softAskManager=null,this.sdkSettings=e,this.browser=t,this.softAskManager=new d.default(this.sdkSettings),this.notificationManager=new c.default(this.sdkSettings,t)}t.default=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(a.addEvent=function(e){a.history.push(e),a.listeners.forEach((function(t){t(e)}))},a.getHistory=function(){return a.history},a.addEventListener=function(e){a.listeners.push(e)},a.clear=function(){a.history=[]},a.history=[],a.listeners=[],a);function a(){}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(26),a=n(1),i=n(2),o=n(5),s=n(8),u=n(3),l=n(14),c=n(11),f=n(4),d=n(0),g=n(10),p=(h.prototype.showHardAsk=function(){var e=this,t=h.baseLogTag+".showHardAsk";return new Promise((function(n,r){h.isWebPushSupported().then((function(o){o?e.getCurrentPermissionState().then((function(o){e.registerServiceWorker().then((function(s){o!==l.PERMISSION_STATE.DENIED?(i.default.log(1,t,"Attempting to open hard ask"),e.showOverlay(),e.askPermission().then((function(r){e.hideOverlay(),i.default.log(2,t,"Permission state after hard ask:",r),r===l.PERMISSION_STATE.GRANTED?e.getPushTokenDetails().then((function(t){e.sendDataToServiceWorker(t.token),n({state:r,subscriptionDetails:t})})):(e.sendDataToServiceWorker(),n({state:r,subscriptionDetails:null}))})).catch((function(e){i.default.error(1,t,e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}))):(i.default.log(1,t,"Hard ask not shown as permission state is",o),n({state:o,subscriptionDetails:null}))})).catch((function(e){i.default.error(1,t,"Error registering serviceworker:",e),r(e)}))})).catch((function(e){i.default.error(1,t,"Registering service worker failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):(i.default.warn(1,t,"Web push not supported in current browser environment"),r(a.default.ERRORS.WEB_PUSH_NOT_SUPPORTED))}))}))},h.prototype.sendDataToServiceWorker=function(e){var t=this;return new Promise((function(n){f.default.collectGetParams().then((function(n){e&&(n.push_id=e||u.default.get(a.default.PERSISTENT_STORAGE.PUSH_TOKEN)||void 0),n.isBatchingEnabled=u.default.get(a.default.PERSISTENT_STORAGE.WEB_SETTINGS).s_e_b_e;var r=c.default.get().swPath;if(r&&r.includes("tools/moengage")){var i=g.createInstance({driver:[g.INDEXEDDB],name:"moe_database",storeName:"moe_data"});i.ready().then((function(){i.setItem("reportParams",{data:n})}))}else navigator.serviceWorker.ready.then((function(){t.sendDataToServiceWorkerOnControllerReady(n)}))}))}))},h.prototype.sendDataToServiceWorkerOnControllerReady=function(e){var t=this;navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({data:e}):this.swActiveRetries<3&&setTimeout((function(){t.swActiveRetries++,t.sendDataToServiceWorkerOnControllerReady(e)}),500)},h.prototype.getCurrentPermissionState=function(){return navigator.permissions?navigator.permissions.query({name:"notifications"}).then((function(e){return h.parsePermissionState(e.state)})).catch((function(e){})):new Promise((function(e){e(h.parsePermissionState(Notification.permission))}))},h.prototype.getPushTokenDetails=function(){var e=this,t=h.baseLogTag+".getPushTokenDetails";return new Promise((function(n,r){e.getCurrentPermissionState().then((function(r){r!==l.PERMISSION_STATE.GRANTED?n({token:null,raw:null}):o.default.getInstance().then((function(r){e.registerServiceWorker().then((function(a){var o=null,s={userVisibleOnly:!0};function u(){a.pushManager.subscribe(s).then((function(e){!function(e){var t=e.toJSON(),r=e.endpoint.substring(0,t.endpoint.lastIndexOf("/")+1),a=t.expirationTime,i=t.endpoint.split("/")[t.endpoint.split("/").length-1],o={};if(t.keys)for(var s in t.keys)t.keys.hasOwnProperty(s)&&(o[s]=t.keys[s]);n({token:i,endpoint:r,keys:o,expirationTime:a,raw:t})}(e)})).catch((function(e){i.default.error(1,t,"Error in subscribtion: ",e),n({token:null,raw:null})}))}d.isVapid(e.sdkSettings.platformSettings,r)&&(o=d.getVapidPublicKey(e.sdkSettings.platformSettings,r),s.applicationServerKey=d.stringToBuffer(o)),a.pushManager.getSubscription().then((function(t){if(t)if("vapid"===e.sdkSettings.platformSettings.chrome.subscriptionMode&&t.options&&t.options.applicationServerKey){var n=d.bufferToString(t.options.applicationServerKey);[o,o+"=",o+"==",d.bufferToString(d.stringToBuffer(o))].indexOf(n)<0?t.unsubscribe().then((function(){u()})):u()}else u();else u()}))})).catch((function(e){i.default.error(1,t,"Error in getting push token: ",e),n({token:null,raw:null})}))}))}))}))},h.prototype.isTokenValid=function(){var e=this;return this.getPushTokenDetails().then((function(t){return r.default.isTokenValid(t.token,e.sdkSettings.platformSettings.chrome.apiKey)}))},h.prototype.removeToken=function(){return u.default.remove(a.default.PERSISTENT_STORAGE.PUSH_TOKEN),Promise.resolve()},h.prototype.askPermission=function(){return new Promise((function(e,t){Notification.requestPermission().then((function(t){e(h.parsePermissionState(t))})).catch((function(e){t(a.default.ERRORS.PERMISSION_DISMISSED_TOO_MANY_TIMES)}))}))},h.prototype.registerServiceWorker=function(){var e=this,t=h.baseLogTag+".registerServiceWorker";return null!=this.swRegisterPromise||(this.swRegisterPromise=new Promise((function(n,r){if(h.registeredServiceWorker)n(h.registeredServiceWorker);else if("serviceWorker"in navigator){var o,u=void 0;if(o=c.default.get()&&null!=c.default.get().swPath?(u=c.default.get().swPath,!0):(u=e.sdkSettings.platformSettings.chrome.serviceWorkerFilename,!1),"/"!==u[0]&&(u="/"+u),u.includes("tools/moengage"))i.default.log(1,t,"Removing scope in case of shopify."),s.default.isFeatureEnabled(e.sdkSettings,a.default.SDK_FEATURES.WEB_PUSH)?navigator.serviceWorker.register(u).then((function(e){i.default.log(2,t,"Serviceworker registered"),navigator.serviceWorker.getRegistrations().then((function(e){e.forEach((function(e){e.active&&e.active.scriptURL.match(/moengage/)&&(i.default.log(2,t,"Serviceworker ready"),h.registeredServiceWorker=e,c.default.get()&&c.default.get().forceSwUpdate&&e.update(),n(e))}))})).catch((function(e){i.default.error(1,t,"Service worker register failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}))})).catch((function(e){i.default.error(1,t,"Service worker register failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):i.default.log(1,t,"Not registering serviceworker as web push is not enabled in current environment");else{var l="/";if(c.default.get()&&null!=c.default.get().swScope)l=c.default.get().swScope;else if(e.sdkSettings.platformSettings.chrome.isServiceWorkerRoot)o&&(i.default.log(1,t,"Using user defined path to serviceworker:",u),l=u.substr(0,u.lastIndexOf("/")+1),h.canSwBeRegisteredWithScope(l)||(i.default.error(1,t,"Service worker can only be registered from same directory or child directory."),r(a.default.ERRORS.SERVICE_WORKER_NOT_IN_CORRECT_SCOPE)));else{var f=window.location.pathname;l=f.substring(0,f.lastIndexOf("/")+1)}i.default.log(1,t,"Scope for serviceworker:",l),s.default.isFeatureEnabled(e.sdkSettings,a.default.SDK_FEATURES.WEB_PUSH)?navigator.serviceWorker.register(u,{scope:l}).then((function(e){i.default.log(2,t,"Serviceworker registered"),navigator.serviceWorker.ready.then((function(e){i.default.log(2,t,"Serviceworker ready"),h.registeredServiceWorker=e,c.default.get()&&c.default.get().forceSwUpdate&&e.update(),n(e)})).catch((function(e){i.default.error(1,t,"Service worker register failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}))})).catch((function(e){i.default.error(1,t,"Service worker register failed:",e),r(a.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):i.default.log(1,t,"Not registering serviceworker as web push is not enabled in current environment")}}else i.default.error(1,t,"Service worker not supported"),r("Service worker not supported")}))),this.swRegisterPromise},h.canSwBeRegisteredWithScope=function(e){var t,n;return t=e,!((n=window.location.pathname).indexOf(t)<0)&&0<=n.substring(n.indexOf(t)).length},h.isWebPushSupported=function(){return new Promise((function(e){o.default.getInstance().then((function(t){t.isIncognito?e(!1):"serviceWorker"in navigator&&"PushManager"in window&&t.isChromeLike()?e(!0):e(!1)}))}))},h.parsePermissionState=function(e){return"prompt"===e?l.PERMISSION_STATE.PROMPT:"granted"===e?l.PERMISSION_STATE.GRANTED:"denied"===e?l.PERMISSION_STATE.DENIED:"default"===e?l.PERMISSION_STATE.DISMISSED:null},h.prototype.showNotification=function(e){var t=h.baseLogTag+".showNotification";this.registerServiceWorker().then((function(n){e?e.title?e.body?(null==e.requireInteraction&&(e.requireInteraction=!0),n.showNotification(e.title,e)):i.default.error(1,t,"Notification body can not be blank"):i.default.error(1,t,"Notification title can not be blank"):i.default.error(1,t,"Notification object can not be blank")})).catch((function(e){i.default.error(1,t,"Error registering serviceworker:",e)}))},h.prototype.showOverlay=function(){var e=this;if(this.sdkSettings.optInConfig.showOverlay){var t=document.createElement("div");t.id="moe-push-div",t.style.display="none",t.className="moe-push-class",o.default.getInstance().then((function(n){n.isMobile?t.innerHTML=e.sdkSettings.optInConfig.softAskConfig.mobile.customHTML:t.innerHTML=e.sdkSettings.optInConfig.softAskConfig.desktop.customHTML;var r=document.body.firstChild;r.parentNode.insertBefore(t,r);var a,i=n.name;if(i===o.default.BROWSER_NAMES.CHROME||i===o.default.BROWSER_NAMES.OPERA_NEON?a=document.getElementsByClassName("moe_chrome"):i===o.default.BROWSER_NAMES.FIREFOX?a=document.getElementsByClassName("moe_firefox"):i===o.default.BROWSER_NAMES.OPERA?a=document.getElementsByClassName("moe_opera"):i===o.default.BROWSER_NAMES.SAFARI&&(a=document.getElementsByClassName("moe_opera")),0===a.length)document.getElementById("moe-push-div").style.display="none";else for(var s=a.length-1;0<=s;s--)a[s].style.display="block";e.overlayTimer=window.setTimeout((function(){""===t.style.opacity&&(t.style.display="block")}),1500),t.onclick=function(){e.hideOverlay()}}))}},h.prototype.hideOverlay=function(){clearTimeout(this.overlayTimer);var e=document.getElementById("moe-push-div");null!=e&&(e.style.visibility="none",e.style.opacity="0",e.parentNode.removeChild(e))},h.baseLogTag="HTTPS-NotificationManager",h);function h(e){var t=this;this.swRegisterPromise=null,this.swActiveRetries=1;var n=h.baseLogTag+".constructor";this.sdkSettings=e,this.registerServiceWorker().then((function(e){t.sendDataToServiceWorker()})).catch((function(e){i.default.error(1,n,"Error registering serviceworker:",e)}))}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(a.addCallback=function(e,t){null!=e&&null!=t&&(null==a.callbacks[e]&&(a.callbacks[e]=[]),a.callbacks[e].push(t))},a.getCallbacks=function(e){return a.callbacks[e]||[]},a.runCallbacks=function(e){a.getCallbacks(e).forEach((function(e){e()}))},a.callbacks={},a);function a(){}t.default=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),o=n(1),s=n(2),u=(l.initialize=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){return null==l.ready&&(l.serviceMetaStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.SERVICE_META.NAME}),l.campaingsMetaStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.CAMPAIGNS_META.NAME}),l.campaingsTagsStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.CAMPAIGNS_TAGS.NAME}),l.campaingsStatsStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.CAMPAIGNS_STATS.NAME}),l.testCampaignStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:o.INAPP_CONSTANTS.DATABASE_NAME,storeName:o.INAPP_CONSTANTS.STORES.CAMPAIGNS_STATS.NAME}),e=[l.serviceMetaStore.ready(),l.campaingsMetaStore.ready(),l.campaingsTagsStore.ready(),l.campaingsStatsStore.ready(),l.testCampaignStore.ready()],l.ready=Promise.all(e)),[2,l.ready]}))}))},l.clear=function(){return r(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:e=l.baseLogTag+".clear",r.label=1;case 1:return r.trys.push([1,4,,5]),[4,l.initialize()];case 2:return r.sent(),[4,Promise.all([l.serviceMetaStore.clear(),l.campaingsMetaStore.clear(),l.campaingsTagsStore.clear(),l.campaingsStatsStore.clear(),l.testCampaignStore.clear()])];case 3:return r.sent(),t=[l.serviceMetaStore.ready(),l.campaingsMetaStore.ready(),l.campaingsTagsStore.ready(),l.campaingsStatsStore.ready(),l.testCampaignStore.ready()],l.ready=Promise.all(t),[3,5];case 4:return n=r.sent(),s.default.error(1,e,"Error clearing onsite stores:",n),[3,5];case 5:return[2,l.ready]}}))}))},l.baseLogTag="MOE_ONSITE_STORES",l);function l(){}t.default=u},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},a=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(10),s=n(32),u=n(2),l=n(39),c=n(4),f=n(46),d=n(3),g=n(5),p=n(9),h=n(8),S=n(11),E=n(40),T=n(14),m=n(48),_=n(41),v=n(34),b=n(19),y=n(67),I=n(21),A=n(31),O=function(){o.createInstance({driver:[o.INDEXEDDB,o.WEBSQL,o.LOCALSTORAGE],name:i.default.EVENTS.DATABASE_NAME,storeName:i.default.EVENTS.STORE_NAME}).clear()},P=function(){return new Promise((function(e){"complete"!==window.document.readyState?window.addEventListener("load",(function(){e()})):e()}))};window&&(window.moe=function(e){var n="Pre-Initialization";if(u.default.log(1,n,"Init data: ",e),"undefined"==typeof Promise)return u.default.error(1,n,"Promises not supported"),f.DummyMoengageObject;if(e.app_id||e.appId){var r=N();r&&(e=Object.assign({},e,r)),S.default.save(e),P().then((function(){l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.EVENT_NAMES.MOE_INIT,data:S.default.get()}),O(),u.default.setLogLevel(S.default.get().debugLevel),u.default.log(1,n,"Script loaded!"),u.default.customLabel(1,n,"SDK Version","2.7.17"),0<S.default.get().debugLevel&&(u.default.warn(1,n,"You are currently using MoEngage in debug environment. You'll find all the data captured in this environment in the TEST mode on the dashoard."),u.default.warn(1,n,"Please initialize with debugLevel as",0,"when using on your production environment.")),t.initializeLaunchSequence()}));var a=window.moengage_object||"Moengage";return window[a]=f.default,f.default}return u.default.error(1,n,"App Id not specified. Please check docs page to complete the integration - ",i.default.LINKS.WEBSDK_DOCS),f.DummyMoengageObject},window.moeBannerText="banner",window[i.WINDOW_OBJECTS.PageEventHistoryManager]=_.default);var N=function(){try{var e=localStorage.getItem(i.default.SEGMENT_CLUSTER),t=localStorage.getItem(i.default.SEGMENT_SW_PATH),n=localStorage.getItem(i.default.SEGMENT_SW_SCOPE),r={};return e&&(r.cluster=e),t&&(r.swPath=t),n&&(r.swScope=n),!!(e||t||n)&&(u.default.log(1,".isSegmentDataFound","Data found for segment initialisation",r),r)}catch(e){return!1}};t.initializeLaunchSequence=function(){var e="Initialization";return new Promise((function(t){c.default.getWebSDKSettings().then((function(n){n.isDomainLevelStorage&&(d.default.isSharedWithCookie=!0,d.default.copyKeysFromCookie()),"allowed"===n.s_e_b_e&&(v.default.initialize(),b.default.init(n)),p.default.get().then((function(r){if(m.default.get().deviceToLogout===r.deviceUuid)return u.default.log(1,e,"User was not able to logout last time. Completing the logout now and starting new session."),f.default.user.logout();r.deviceAdded&&c.default.onDeviceAdd.res(),n.isPushSubBilling&&u.default.warn(1,e,"You are under push subscriber based billing plan. We are only tracking users with an email or have subscribed to web push. All user attributes and events will be stored in a queue till we receive either of the properties.");var a=new I.default;(new y.default).onWindowVisibilityChange(a.handleBrowserInactivity),u.default.customLabel(1,e,"Device UUID",r.deviceUuid),u.default.customLabel(1,e,"Device Added",r.deviceAdded),l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.EVENT_NAMES.SETTINGS_FETCHED,data:n}),n.isPushSubBilling||r.deviceAdded||c.default.deviceAdd(),f.default.track_page_view(),s.default.clear(i.default.PERSISTENT_STORAGE.Q.DEVICE),s.default.clear(i.default.PERSISTENT_STORAGE.Q.REPORT),S.default.get().enableSPA&&R(),g.default.getInstance().then((function(t){var r=new E.default(n,t);r.isWebPushEnabled()?0<=[h.OptInConfig.TYPE.ONE_CLICK,h.OptInConfig.TYPE.TWO_STEP].indexOf(n.optInConfig.type)||d.default.get(i.default.PERSISTENT_STORAGE.PUSH_TOKEN)?r.callWebPush():(u.default.log(1,e,"Self handled setting. Will show opt-in on manual invocation, if required."),r.getPermissionState().then((function(t){t===T.PERMISSION_STATE.GRANTED&&(u.default.log(1,e,"Notification permission already granted. Proceeding to subscribe the user"),r.callWebPush())})).catch((function(t){u.default.warn(1,e,"Cannot get permission state: ",t)}))):t.isIncognito?u.default.warn(1,e,"Web push not supported in incognito mode"):E.default.SUPPORTED_BROWSERS.indexOf(t.name)<0?u.default.warn(1,e,"Web push not supported on this browser. Supported browsers are:\n\t\t1. Google Chrome\n\t\t2. Mozilla Firefox\n\t\t3. Opera"):u.default.warn(1,e,"Web push feature not enabled for current environment"),S.default.get().disableOnsite?u.default.warn(1,e,"Onsite is disabled in this page since `disableOnsite: true` is passed during initialization."):c.default.onDeviceAdd.p.then((function(){f.enableOnsiteApi()})),w()})),t()}))}))}))};var w=function(){var e="Moengage.clearWindowQ";P().then((function(){var t,n;try{var r=window.moengage_object||"Moengage";if(window[r]&&window.moengage_q){var i=window.moengage_q;if(window.moengage_q=[],i&&0<i.length&&window[r])for(var o=0;o<i.length;o++){u.default.log(1,e,"Method called before SDK downloaded:",[i[o].f],i[o].a);var s=i[o].f;"onsite.getData"===s?(t=f.default.onsite).getData.apply(t,a(i[o].a)):"onsite.registerCallback"===s?(n=f.default.onsite).registerCallback.apply(n,a(i[o].a)):null!=f.default[i[o].f]&&f.default[i[o].f].apply(null,i[o].a)}i=[]}}catch(t){u.default.error(1,e,t)}}))},R=function(){var e="startSpaUrlHandler",t=document.location.href;!function(){u.default.log(1,e,"Start listening to URL changes");var n=document.querySelector("body");new MutationObserver((function(n){n.forEach((function(n){t!==document.location.href&&(t=document.location.href,u.default.log(1,e,"URL Change detected",t),A.dismissActiveOsm(),f.default.track_page_view())}))})).observe(n,{childList:!0,subtree:!0})}()}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(2),s=n(3),u=n(4),l=n(5),c=n(8),f=n(49),d=n(47),g=n(28),p=n(4),h=n(40),S=n(43),E=n(9),T=n(11),m=n(0),_=n(52),v="MoEngage",b=new m.PromiseObject,y={getData:function(e,t){p.default.getWebSDKSettings().then((function(n){b.p.then((function(n){n.getData(e,t)}))}))},registerCallback:function(e,t){p.default.getWebSDKSettings().then((function(n){b.p.then((function(n){n.registerCallback(e,t)}))}))}},I=(A.callWebPush=function(e){var t=v+".callWebPush";u.default.getWebSDKSettings().then((function(n){if(n.isConfigured)if(c.default.isFeatureEnabled(n,i.default.SDK_FEATURES.WEB_PUSH))if(n.optInConfig.type===c.OptInConfig.TYPE.SELF_HANDLED){if(o.default.log(1,t,"Starting web push functions"),null!=e){T.default.setSoftAskConfig(e);var r=m.getProp(e,"soft_ask_display_callback",null),a=m.getProp(e,"soft_ask_allow_callback",null),s=m.getProp(e,"soft_ask_block_callback",null),u=m.getProp(e,"hard_ask_allow_callback",null),f=m.getProp(e,"hard_ask_dismiss_callback",null),d=m.getProp(e,"hard_ask_block_callback",null),g=i.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES;S.default.addCallback(g.SOFT_ASK_SHOWN,r),S.default.addCallback(g.SOFT_ASK_ALLOWED,a),S.default.addCallback(g.SOFT_ASK_DISMISSED,s),S.default.addCallback(g.HARD_ASK_ALLOWED,u),S.default.addCallback(g.HARD_ASK_DISMISSED,f),S.default.addCallback(g.HARD_ASK_DENIED,d)}l.default.getInstance().then((function(e){new h.default(n,e).callWebPush()}))}else o.default.warn(1,t,"This feature can only be used when you have chosed self-handled approach in the dashboard. You can check dashboard here:",i.default.PUSH_SETTINGS_PAGE_LINK);else o.default.warn(1,t,"Web push feature not enabled for current environment.");else o.default.log(1,t,"Web push settings not configured on dashboard yet. To start web push subscriptions, please configure the settings on dashboard.")}))},A.showNotification=function(e){p.default.getWebSDKSettings().then((function(t){l.default.getInstance().then((function(n){new h.default(t,n).showNotification(e)}))}))},A.getSdkVersion=function(){return"2.7.17"},A.setDebugLevel=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){try{"number"==typeof e&&(!T.default.get().disableOnsite&&A.onsite.setLogLevel&&A.onsite.setLogLevel(e),o.default.setLogLevel(e,!0))}catch(t){o.default.error(0,"MoEngage.setDebugLevel","Error changing log level:",t)}return[2]}))}))},A.vitals=function(){var e=E.default.getSync();return{deviceUuid:e.deviceUuid,userDetails:e,pushToken:s.default.get(i.default.PERSISTENT_STORAGE.PUSH_TOKEN),softAskStatus:s.default.get(i.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS),hardAskStatus:s.default.get(i.default.PERSISTENT_STORAGE.HARD_ASK_STATUS)}},A.help=function(){var e=v+".help";for(var t in o.default.log(0,e,"Moengage Dashboard - ",i.default.LINKS.MOE_DASHBOARD),i.default.LINKS)i.default.LINKS.hasOwnProperty(t)&&o.default.log(0,e,t,"-",i.default.LINKS[t])},A.track_event=function(e,t){return g.default.track(e,t)},A.add_unique_user_id=function(e){return d.default.login(e)},A.update_unique_user_id=function(e){return d.default.updateUniqueId(e)},A.add_user_attribute=function(e,t){return d.default.addAttribute(e,t)},A.add_first_name=function(e){return d.default.addAttribute("first_name",e)},A.add_last_name=function(e){return d.default.addAttribute("last_name",e)},A.add_email=function(e){return d.default.addAttribute("email",e)},A.add_mobile=function(e){return d.default.addAttribute("mobile",e)},A.add_user_name=function(e){return d.default.addAttribute("name",e)},A.add_gender=function(e){return d.default.addAttribute("gender",e)},A.add_birthday=function(e){return d.default.addAttribute("birthday",e)},A.destroy_session=function(){return A.user.logout()},A.call_web_push=function(e){A.callWebPush(e)},A.getBranch=function(){return i.default.BRANCH},A.track_page_view=function(){return g.default.track(i.default.EVENT_NAMES.WEB_SESSION_START,{timestamp:Number(Date.now())}),g.default.track(i.default.EVENT_NAMES.PAGE_VIEWED,{timestamp:Number(Date.now())})},A.user=d.default,A.event=g.default,A.device=f.default,A.onsite=y,A);function A(){}function O(){}t.default=I,t.DummyMoengageObject={track_event:O,add_user_attribute:O,add_first_name:O,add_last_name:O,add_email:O,add_mobile:O,add_user_name:O,add_gender:O,add_birthday:O,destroy_session:O,add_unique_user_id:O,moe_events:O,location_type_attribute:O,call_web_push:O},t.enableOnsiteApi=function(){var e=T.default.get();I.onsite=new _.MoeOnsite(e),b.res(I.onsite),I.onsite.initialize()},t.disableOnsiteApi=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return I.onsite.appId?(o.default.log(1,"Moengage.disableOnsiteApi","logging out from inapp module"),[4,I.onsite.logout()]):[3,2];case 1:e.sent(),b=new m.PromiseObject,I.onsite=y,e.label=2;case 2:return[2]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(2),s=n(3),u=n(45),l=n(4),c=n(13),f=n(29),d=n(25),g=n(9),p=n(12),h=n(28),S=n(48),E=n(41),T=n(46),m=n(19),_=n(0),v="MoEngage.user",b=(y.addAttribute=function(e,t){var n=v+".addUserAttribute";return new Promise((function(r,a){if("string"!=typeof e||null==e)o.default.error(1,n,"Attribute name needs to be a string"),r({error:5e3,message:"Attribute name needs to be a string. Type provided was "+typeof e});else if(""===e)o.default.error(1,n,"Attribute name can not be an empty string"),r({error:5001,message:"Attribute name can not be an empty string"});else if(null==t)o.default.error(1,n,"Attribute value null"),r({error:5003,message:"Attribute value was empty"});else if("string"==typeof t&&""===t)r({error:5004,message:"Attribute value needs to be non-empty string or a date object"});else if("object"==typeof t&&"function"!=typeof t.getMonth)r({error:5005,message:"Attribute value needs to be non-empty string or a date object"});else{var i=new c.default(e,t),s=function(){g.default.get().then((function(e){e.addAttribute(i).then((function(e){e?("id"===i.key&&o.default.log(1,n,"Logging in the user with id: ",i.value),f.default.createUserAttributeEvent(i).then((function(e){o.default.log(2,n,"Event to be converted to report:",e),E.default.addEvent(e),l.default.collectGetParams().then((function(t){var n=new d.default(d.default.REPORT_ADD_TYPE.USER_ATTRIBUTE,t,e);l.default.reportAdd(n).then((function(){r()}))}))}))):(o.default.log(1,n,"Attribute already present/queued. Not adding again."),r({error:5005,message:"Attribute already present/queued. Not adding again."}))}))}))};"id"===e?g.default.get().then((function(e){var a=e.indexOfAttribute("id");-1<a?t===e.attributes[a].value?(o.default.log(1,n,"User already logged in with id:",t),r()):(o.default.log(1,n,"Logging out previous user with id:",e.attributes[a].value),y.logout(!0,t).then((function(){s()}))):s()})):s()}}))},y.login=function(e){return y.addAttribute("id",e)},y.logout=function(e,t){var n,c=this,f=e?{type:"forced",new_uid:t}:null;return n=S.default.get(),null!=g.default.getSync()&&(n.deviceToLogout=g.default.getSync().deviceUuid,n.save()),new Promise((function(e){h.default.track(i.default.EVENT_NAMES.LOGOUT,f).then((function(){o.default.log(1,"MoEngage.user.logout","Logging out now!"),l.default.getWebSDKSettings().then((function(t){return r(c,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return t.isDomainLevelStorage&&p.default.remove(i.default.PERSISTENT_STORAGE.USER_DATA),E.default.clear(),[4,T.disableOnsiteApi(t)];case 1:return n.sent(),s.default.logout(),[4,g.default.logout()];case 2:return n.sent(),[4,m.default.flushReports()];case 3:return n.sent(),s.default.remove(i.default.PERSISTENT_STORAGE.GRACEFUL_DATA),l.default.onDeviceAdd=new _.PromiseObject,[4,u.initializeLaunchSequence()];case 4:return n.sent(),e(),[2]}}))}))}))}))}))},y.updateUniqueId=function(e){var t=v+".updateUniqueId";return new Promise((function(n){g.default.get().then((function(r){var a=r.indexOfAttribute(i.default.ATTRIBUTE_NAMES.ID),s=r.indexOfAttribute("oldUniqueIds");if(!(-1<a))return o.default.log(2,t,"Logging in as no id found"),y.login(e);var u=r.attributes[a].value;e!==u?(o.default.log(2,t,"Different ids found"),-1<s?(r.attributes[s].value.push(u),r.attributes.splice(a,1)):(r.attributes.splice(a,1),r.addAttribute(new c.default("oldUniqueIds",[u]))),r.save().then((function(){y.login(e).then((function(){n()}))}))):(o.default.warn(1,t,"New id and old id are the same. Not updating the id."),n())}))}))},y.getAttributes=function(){var e=g.default.getSync().attributes,t={};return e.map((function(e){t[e.key]=e.value})),t},y);function y(){}t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),a=n(1),i=n(0),o=(s.get=function(){return new s(r.default.get(a.default.PERSISTENT_STORAGE.GRACEFUL_DATA))},s.prototype.save=function(){r.default.set(a.default.PERSISTENT_STORAGE.GRACEFUL_DATA,this)},s);function s(e){this.deviceToLogout=i.getProp(e,"deviceToLogout",null)}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=n(5),i=n(3),o=n(4),s=n(40),u=(l.getUuid=function(){return i.default.get(r.default.PERSISTENT_STORAGE.USER_DATA).deviceUuid},l.getPushToken=function(){return i.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN)},l.getPermissionState=function(e){return new Promise((function(t,n){o.default.getWebSDKSettings().then((function(r){a.default.getInstance().then((function(a){new s.default(r,a).getPermissionState().then((function(n){t(n),e&&e(null,n)})).catch((function(t){n(t),e&&e(t,null)}))}))}))}))},l);function l(){}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=n(2),i=n(0),o=n(39),s=n(5),u=n(8),l=n(3),c=n(28),f=n(33),d=n(42),g=n(14),p=n(43),h="Web push settings not configured on MoEngage dashboard: "+r.default.PUSH_SETTINGS_PAGE_LINK,S=(E.prototype.showHardAsk=function(){var e=this,t=E.baseLogTag+".showHardAsk";return new Promise((function(n,i){e.getCurrentPermissionState().then((function(s){null!=e.currentManager?s===g.PERMISSION_STATE.PROMPT?(l.default.set(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,Date.now()),c.default.track(r.default.EVENT_NAMES.OPT_IN_SHOWN),o.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_SHOWN}),o.default.deprecatedSdkCallback("opt_in_shown"),p.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_SHOWN),e.currentManager.showHardAsk().then((function(e){e.state===g.PERMISSION_STATE.DISMISSED?(c.default.track(r.default.EVENT_NAMES.OPT_IN_DISMISSED),o.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DISMISSED}),o.default.deprecatedSdkCallback("opt_in_dismissed"),p.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DISMISSED),a.default.log(1,t,"Hard ask was dismissed")):e.state===g.PERMISSION_STATE.GRANTED?(c.default.track(r.default.EVENT_NAMES.OPT_IN_ALLOWED),o.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_ALLOWED,data:e.subscriptionDetails}),o.default.deprecatedSdkCallback("opt_in_allowed"),p.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_ALLOWED),a.default.log(1,t,"Push permission was granted"),a.default.customLabel(1,t,"token",e.subscriptionDetails.token)):e.state===g.PERMISSION_STATE.DENIED&&(c.default.track(r.default.EVENT_NAMES.OPT_IN_BLOCKED),c.default.track("Web Push Opt-in Denied"),o.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DENIED}),o.default.deprecatedSdkCallback("opt_in_blocked"),p.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DENIED),a.default.log(1,t,"Notification permission was denied")),n(e)})).catch((function(e){a.default.error(1,t,"Error showing hard ask:",e),n({state:s,subscriptionDetails:null})}))):(a.default.log(1,t,"Not showing Hard Ask as current permission state is",s),e.getPushTokenDetails().then((function(e){a.default.customLabel(1,t,"token",e.token),n({state:s,subscriptionDetails:e})})).catch((function(e){a.default.warn(1,t,"Could not get push token details"),n({state:s,subscriptionDetails:null})}))):(a.default.log(1,t,"MoEngage web push settings not configured. Please configure at",r.default.PUSH_SETTINGS_PAGE_LINK),i(r.default.ERRORS.WEB_PUSH_NOT_CONFIGURED))})).catch((function(e){i(e)}))}))},E.prototype.getCurrentPermissionState=function(){return null!=this.currentManager?this.currentManager.getCurrentPermissionState():Promise.reject(h)},E.prototype.getPushTokenDetails=function(){return null!=this.currentManager?this.currentManager.getPushTokenDetails():Promise.reject(h)},E.prototype.isTokenValid=function(){return null!=this.currentManager?this.currentManager.isTokenValid():Promise.reject(h)},E.prototype.removeToken=function(){return null!=this.currentManager?this.currentManager.removeToken():Promise.reject(h)},E.prototype.showNotification=function(e){var t=E.baseLogTag+".showNotification";if(null!=this.currentManager)return this.currentManager.showNotification(e);a.default.warn(1,t,h)},E.baseLogTag="NotificationManager",E);function E(e,t){this.currentManager=null;var n=E.baseLogTag+".constructor";this.config=e,(this.browser=t).isIncognito?(this.currentManager=null,a.default.warn(1,n,"Web push not supported in incognito mode")):this.browser.isChromeLike()&&e.platformSettings.chrome?(e.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.HTTPS?"http"===i.getCurrentProtocol()?a.default.error(1,n,"Domain configured as a HTTPS site and this is a HTTP site. Please update correct settings at",r.default.PUSH_SETTINGS_PAGE_LINK):this.currentManager=new d.default(e):e.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.HTTP?this.currentManager=new f.default(e):e.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.MUTLI&&("https"===i.getCurrentProtocol()?this.currentManager=new d.default(e):this.currentManager=new f.default(e)),!1===e.platformSettings.chrome.enabled&&a.default.warn(1,n,"Web push settings not configured. Please configure at ",r.default.PUSH_SETTINGS_PAGE_LINK)):this.browser.name===s.default.BROWSER_NAMES.SAFARI&&e.platformSettings.safari&&"safari"in window&&"pushNotification"in window.safari&&(this.currentManager=null,a.default.warn(1,n,"Web push support for Safari will be coming soon. Please try on Chrome, Opera or Firefox."))}t.default=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a,i=n(1),o=n(2),s=n(5),u=n(8),l=n(39),c=n(3),f=n(28),d=n(11),g=n(0),p=n(43),h=(S.prototype.showSoftAsk=function(){var e=this,t=S.baseLogTag+".showSoftAsk";return new Promise((function(n,a){var d=e.config.optInConfig.loadTime;e.config.optInConfig.type===u.OptInConfig.TYPE.SELF_HANDLED&&(d=0),d&&o.default.log(1,t,"Delay of",d," second(s) requested before opt-in flow"),setTimeout((function(){s.default.getInstance().then((function(a){function s(){c.default.set(i.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.NOT_SHOWN),n({showHardAsk:!0,softAskState:r.NOT_SHOWN})}a.isChromeLike()&&"https"===g.getCurrentProtocol()&&e.config.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.MUTLI?s():e.config.optInConfig.type===u.OptInConfig.TYPE.TWO_STEP||e.config.optInConfig.type===u.OptInConfig.TYPE.SELF_HANDLED?e.showOptIn((function(){o.default.log(1,t,"Soft ask was shown"),c.default.set(i.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,Date.now()),c.default.set(i.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.SHOWN),l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_SHOWN}),l.default.deprecatedSdkCallback("soft_ask_shown"),p.default.runCallbacks(i.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_SHOWN)}),(function(){f.default.track(i.default.EVENT_NAMES.WEB_OPTIN_ACCEPTED),e.hideOptIn(),o.default.log(1,t,"Soft ask was allowed"),c.default.set(i.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.ALLOWED),n({showHardAsk:!0,softAskState:r.ALLOWED}),l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_ALLOWED}),l.default.deprecatedSdkCallback("soft_ask_allowed"),p.default.runCallbacks(i.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_ALLOWED)}),(function(){e.hideOptIn(),f.default.track(i.default.EVENT_NAMES.WEB_OPTIN_CLOSED),o.default.log(1,t,"Soft ask was dismissed"),c.default.set(i.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.DISMISSED),n({showHardAsk:!1,softAskState:r.DISMISSED}),l.default.broadcastToWindow({topic:i.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:i.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_DISMISSED}),l.default.deprecatedSdkCallback("soft_ask_closed"),p.default.runCallbacks(i.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_DISMISSED)}),(function(t){t=!!t,e.hideOptIn(),n({showHardAsk:t,softAskState:r.NOT_SHOWN})})):s()}))}),1e3*d)}))},S.prototype.showOptIn=function(e,t,n,r){var a=this,l=S.baseLogTag+".showOptIn";if(this.config.optInConfig.type===u.OptInConfig.TYPE.TWO_STEP){var c=document.getElementById("moe-push-div");null==c&&((c=document.createElement("div")).id="moe-push-div",c.className="moe-push-class"),s.default.getInstance().then((function(s){var u;if(null!=(u=s.isMobile?a.config.optInConfig.softAskConfig.mobile.customHTML:a.config.optInConfig.softAskConfig.desktop.customHTML)){c.innerHTML=u;var d=document.body.firstChild;d.parentNode.insertBefore(c,d),a.moeDiv=c;var g=document.getElementById("optInText")||document.getElementById("optInTextConventional");null==g?(o.default.error(1,l,"Error showing soft ask. Allow button id is missing"),r()):(e(),f.default.track(i.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD),g.onclick=function(){t()},window.moeRemoveBanner=function(){n()})}else o.default.error(1,l,"Error displaying soft ask"),r()}))}else if(this.config.optInConfig.type===u.OptInConfig.TYPE.SELF_HANDLED){var p=d.default.get();if(p.customSoftAsk){var h=document.getElementsByClassName(p.customSoftAsk.mainClass),E=document.getElementsByClassName(p.customSoftAsk.allowClass),T=document.getElementsByClassName(p.customSoftAsk.dismissClass);if(h.length<1)o.default.error(1,l,"Could not find main class for the soft ask. Class name given:",p.customSoftAsk.mainClass),s.default.getInstance().then((function(e){(e.isChromeLike()&&a.config.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.HTTPS||a.config.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.MUTLI&&"https"===g.getCurrentProtocol()||e.name===s.default.BROWSER_NAMES.SAFARI)&&(o.default.warn(1,l,"Proceeding to hard ask directly"),r(!0))}));else{e(),E.length<1&&(o.default.warn(1,l,"Could not find any element for allow button. Class name given:",p.customSoftAsk.allowClass),o.default.warn(1,l,"Docs for self-handled opt in available here - ",i.default.LINKS.SELF_HANDLED_DOCS)),T.length<1&&o.default.warn(1,l,"Could not find any element for dismiss button. Class name given:",p.customSoftAsk.dismissClass);for(var m=h.length-1;0<=m;m--){var _=h[m];this.mainDivs.push(_),_.style.display="block"}for(m=E.length-1;0<=m;m--)(_=E[m]).onclick=function(){t()};for(m=T.length-1;0<=m;m--)(_=T[m]).onclick=function(){n()}}}else s.default.getInstance().then((function(e){e.isChromeLike()&&a.config.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.HTTPS||a.config.platformSettings.chrome.domainType===u.ChromeConfig.DOMAIN_TYPE.MUTLI&&"https"===g.getCurrentProtocol()||e.name===s.default.BROWSER_NAMES.SAFARI?(o.default.warn(1,l,"No soft ask configured. Proceeding to hard ask directly. \n\nYou can ignore this message if you do not want any soft ask."),r(!0)):(o.default.error(1,l,"Soft ask needs to be present in case of http implementation. Can not show hard ask otherwise."),r())}))}},S.prototype.hideOptIn=function(){null!=this.moeDiv&&(this.moeDiv.style.display="none"),0<this.mainDivs.length&&this.mainDivs.map((function(e){e.style.display="none"}))},S.baseLogTag="SoftAskManager",S);function S(e){this.mainDivs=[],this.config=e}t.default=h,(a=r=t.SoftAskState||(t.SoftAskState={})).SHOWN="shown",a.NOT_SHOWN="not shown",a.ALLOWED="allowed",a.DISMISSED="dismissed"},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(1),u=n(22),l=n(3),c=n(58),f=n(0),d=n(60),g=n(62),p=n(64),h=n(31),S=n(44),E=(T.prototype.setLogLevel=function(e){o.default.setLogLevel(e,!1)},T.prototype.initialize=function(){var e=this,t=T.baseLogTag+".initialize";return null==this.initializationPomise&&(this.initializationPomise=new Promise((function(n){return r(e,void 0,void 0,(function(){var e,i,l,c,f,d=this;return a(this,(function(E){switch(E.label){case 0:return E.trys.push([0,11,,12]),[4,S.default.initialize()];case 1:return E.sent(),[4,this.checkForTestCampaign()];case 2:return E.sent(),[4,this.syncCampaigns()];case 3:return E.sent(),[4,this.getCampaignsFromDB()];case 4:if(e=E.sent(),i=e.filter((function(e){return null!=e.triggerData})),this.displayManager=new p.default,this.displayManager.onRender((function(e){o.default.log(1,t,"Campaign rendered: "+e.campaignId),S.default.serviceMetaStore.setItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME,new Date)})),null==this.testDraftInfo||this.testDraftInfo.draftType!==s.INAPP_CONSTANTS.DRAFT_CAMPAIGN_TPYES.ONSITE_MESSAGING)return[3,9];o.default.log(1,t,"Test campaigns present, will be showing only the test campaign."),o.default.log(1,t,"No live campaign will be shown till draft campaign expires from cookies (15 mins)"),E.label=5;case 5:return E.trys.push([5,7,,8]),o.default.log(1,t,"Trying to render draft campaign with id "+this.testDraftInfo.draftId),[4,this.OnsiteApiClient.getDraftCampaign(this.testDraftInfo.draftId)];case 6:return l=E.sent(),o.default.log(1,t,"Test campaign payload: ",l),this.displayManager.queueDraftCampaign(this.testDraftInfo,l),[3,8];case 7:return c=E.sent(),o.default.error(1,t,"Error fetching data for test campaign "+this.testDraftInfo.draftId+": ",c),[3,8];case 8:return[3,10];case 9:this.triggerManager=new g.default(i),this.triggerManager.onTrigger((function(e,n){return r(d,void 0,void 0,(function(){var r,i;return a(this,(function(a){switch(a.label){case 0:return[4,h.filterAndSortCampaigns(n)];case 1:return n=a.sent(),o.default.log(1,t,"Triggered for: ",e.name,n),r=n.filter((function(e){return e.templateType===u.TEMPLATE_TYPE.SELF_HANDLED})),[4,h.validateMessagingCampaigns(n,this.displayManager.getActiveCampaigns())];case 2:return i=(i=a.sent()).filter((function(e){return e.templateType!==u.TEMPLATE_TYPE.SELF_HANDLED})),this.handlePersonalizationCampagins(r,e),this.handleMessagingCampaigns(i,e),[2]}}))}))})),this.triggerManager.startWatching(),E.label=10;case 10:return n(),[3,12];case 11:return f=E.sent(),o.default.error(1,t,f),[3,12];case 12:return[2]}}))}))}))),this.initializationPomise},T.prototype.handleMessagingCampaigns=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(a){switch(a.label){case 0:n=T.baseLogTag+".handleMessagingCampaigns",a.label=1;case 1:a.trys.push([1,6,,7]),r=0,a.label=2;case 2:return r<e.length?[4,this.OnsiteApiClient.getCampaignPayload(e[r].campaignId,t)]:[3,5];case 3:return i=a.sent(),o.default.log(1,n,"Campaign triggered: "+e[r].campaignId),o.default.log(1,n,"Payload for campaign:",i),this.displayManager.queueLiveCampaign(e[r],i),[3,5];case 4:return r++,[3,2];case 5:return[3,7];case 6:return a.sent(),o.default.error(1,n,"Error getting campaign data for messaging campaign"),[3,7];case 7:return[2]}}))}))},T.prototype.handlePersonalizationCampagins=function(e,t){return r(this,void 0,void 0,(function(){var n,i,s,u=this;return a(this,(function(l){n=T.baseLogTag+".handlePersonalizationCampagins";try{o.default.log(1,n,"Going to Trigger: ",e),i={},s=[],e.forEach((function(e){null!=e.tag&&null!=u.onsiteSelfHandledTriggerListeners[e.tag]&&(s.indexOf(e.tag)<0&&s.push(e.tag),null==i[e.tag]&&(i[e.tag]=[]),i[e.tag].push(e))})),s.forEach((function(e){return r(u,void 0,void 0,(function(){var r,s,u,l,c=this;return a(this,(function(f){switch(f.label){case 0:if(f.trys.push([0,5,,6]),null==i[e])return[3,4];r=function(n){var r;return a(this,(function(a){switch(a.label){case 0:return[4,s.OnsiteApiClient.getCampaignPayload(i[e][n].campaignId,t)];case 1:return r=a.sent(),s.onsiteSelfHandledTriggerListeners[e].forEach((function(t){c.handleSelfHandledCallback(i[e][n],r,t)})),[2,"break"]}}))},s=this,u=0,f.label=1;case 1:return u<i[e].length?[5,r(u)]:[3,4];case 2:if("break"===f.sent())return[3,4];f.label=3;case 3:return u++,[3,1];case 4:return[3,6];case 5:return l=f.sent(),o.default.error(1,n,"Error in triggered web personalization campaign: ",l),[3,6];case 6:return[2]}}))}))}))}catch(l){o.default.error(1,n,"Error handling trigger for self handled web personalization campaign: ",l)}return[2]}))}))},T.prototype.logout=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return e=T.baseLogTag+".logout",o.default.log(1,e,"Starting module logout"),this.initializationPomise=null,this.displayManager&&(Object.keys(this.displayManager.campaignRenderMap).forEach((function(e){document.getElementById("moe-onsite-campaign-"+e).remove()})),this.displayManager.destroy()),this.triggerManager&&this.triggerManager.destory(),this.displayManager=null,[4,S.default.clear()];case 1:return t.sent(),o.default.log(1,e,"Starting module logout complete"),[2]}}))}))},T.prototype.getCampaignsFromDB=function(){var e=this;return new Promise((function(t){setTimeout((function(){return r(e,void 0,void 0,(function(){var e,n,r,o,s,u,l,c,f,d;return a(this,(function(a){switch(a.label){case 0:return[4,S.default.campaingsMetaStore.keys()];case 1:r=a.sent(),o=[],a.label=2;case 2:a.trys.push([2,7,8,9]),s=i(r),u=s.next(),a.label=3;case 3:return u.done?[3,6]:(l=u.value,f=(c=o).push,[4,this.getCampaignById(l)]);case 4:f.apply(c,[a.sent()]),a.label=5;case 5:return u=s.next(),[3,3];case 6:return[3,9];case 7:return d=a.sent(),e={error:d},[3,9];case 8:try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}return[7];case 9:return t(o),[2]}}))}))}),0)}))},T.prototype.checkForTestCampaign=function(){return r(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:e=T.baseLogTag+".checkForTestCampaign",r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.iframeHelper.getDraftCampaignInfo()];case 2:return null==(t=r.sent())?(o.default.log(1,e,"No draft campaign found"),this.testDraftInfo=null):(o.default.log(1,e,"Found draft campaign: ",t),this.testDraftInfo=t,null==this.testDraftInfo.draftId&&(this.testDraftInfo.draftType=s.INAPP_CONSTANTS.DRAFT_CAMPAIGN_TPYES.WEB_PERSONALIZATON)),[3,4];case 3:return n=r.sent(),o.default.error(1,e,"Error getting test campaign",n),[3,4];case 4:return[2]}}))}))},T.prototype.getCampaignById=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:t=T.baseLogTag+".getCampaignById",r.label=1;case 1:return r.trys.push([1,3,,4]),[4,S.default.campaingsMetaStore.getItem(e)];case 2:return[2,r.sent()];case 3:return n=r.sent(),o.default.error(1,t,"Error getting campaign from stroe: ",n),[2,null];case 4:return[2]}}))}))},T.prototype.getData=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,u,l,c,f,d,g,p=this;return a(this,(function(a){switch(a.label){case 0:n=T.baseLogTag+".getData",null==t&&(o.default.warn(1,n,"Moengage.onsite.getData called without a providing a callback."),t=function(){}),a.label=1;case 1:return a.trys.push([1,15,,16]),[4,this.initializationPomise];case 2:return a.sent(),null==this.testDraftInfo?[3,5]:(o.default.log(1,n,"Fetching test campaign: ",this.testDraftInfo),this.testDraftInfo.draftType!==s.INAPP_CONSTANTS.DRAFT_CAMPAIGN_TPYES.WEB_PERSONALIZATON?[3,4]:[4,this.OnsiteApiClient.getDraftCampaign(this.testDraftInfo.draftId)]);case 3:d=a.sent(),t(null,{payload:d.payload,click:function(){o.default.log(1,n,"This is a test campaign")},imp:function(){o.default.log(1,n,"This is a test campaign")}}),a.label=4;case 4:return[3,14];case 5:return[4,S.default.campaingsTagsStore.getItem(e)];case 6:return(r=a.sent())?[4,Promise.all(r.map((function(e){return p.getCampaignById(e)})))]:[3,13];case 7:return i=a.sent(),u=i.filter((function(e){return null==e.triggerData})),[4,h.filterAndSortCampaigns(u)];case 8:l=a.sent(),o.default.log(1,n,"Eligible campaigns with tag ",e,"are",l),c=0,a.label=9;case 9:return c<l.length?(f=l[0],d=null,o.default.log(1,n,"Campaign with highest priority for tag",e,"is",f.campaignId),[4,this.OnsiteApiClient.getCampaignPayload(f.campaignId)]):[3,12];case 10:return d=a.sent(),this.handleSelfHandledCallback(f,d,t),[3,12];case 11:return c++,[3,9];case 12:return[3,14];case 13:o.default.warn(1,n,"Could not find any eligible campaign for tag",e),t({message:"Could not find any eligible campaign for tag "+e},null),a.label=14;case 14:return[3,16];case 15:return g=a.sent(),o.default.error(1,n,"Error getting campaign",g),t({message:"There was an error fetching data for this tag"},null),[3,16];case 16:return[2]}}))}))},T.prototype.registerCallback=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return a(this,(function(a){switch(a.label){case 0:n=T.baseLogTag+".registerCallback",a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.initializationPomise];case 2:return a.sent(),null==this.onsiteSelfHandledTriggerListeners[e]?this.onsiteSelfHandledTriggerListeners[e]=[t]:this.onsiteSelfHandledTriggerListeners[e].push(t),[3,4];case 3:return r=a.sent(),o.default.error(1,n,"Error setting callback for tag",e),o.default.error(1,n,"Error stack:",r),[3,4];case 4:return[2]}}))}))},T.prototype.handleSelfHandledCallback=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i,s;return a(this,(function(a){if(r=T.baseLogTag+".handleSelfHandledCallback","JSON"===t.payloadType)try{t.payload=JSON.parse(t.payload),i=f.getProp(e,"triggerData.trigger_delay.delayInSeconds",0)||0,setTimeout((function(){h.sendDeliveredEvent(e,"WP"),n(null,{payload:t.payload,click:function(t){h.getClickTracker(e,"WP",t)()},imp:h.getImpressionTracker(e,"WP")})}),1e3*i)}catch(a){s="Payload for campaign_id "+e.campaignId+" is not a valid JSON",o.default.error(1,r,s),o.default.error(1,r,"Payload provided:",t.payload),n({message:s},null)}else h.sendDeliveredEvent(e,"WP"),n(null,{payload:t.payload,click:function(t){h.getClickTracker(e,"WP",t)()},imp:h.getImpressionTracker(e,"WP")});return[2]}))}))},T.prototype.syncCampaigns=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:e=T.baseLogTag+".syncCampaigns",n.label=1;case 1:return n.trys.push([1,9,,10]),[4,this.shouldClearMetaStorage()];case 2:return n.sent()?[4,S.default.campaingsMetaStore.clear()]:[3,5];case 3:return n.sent(),[4,this.rebuildTagStore()];case 4:n.sent(),n.label=5;case 5:return[4,this.shouldSaveRemoteCampaigns()];case 6:return n.sent()?[4,this.saveRemoteCampaigns()]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:return t=n.sent(),o.default.error(1,e,"Error getting remote campaigns: ",t),[3,10];case 10:return[2]}}))}))},T.prototype.shouldClearMetaStorage=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,S.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION)];case 1:return[2,e.sent()!==f.getMoeWindowVar().getSdkVersion()]}}))}))},T.prototype.shouldSaveRemoteCampaigns=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,u;return a(this,(function(a){switch(a.label){case 0:return e=T.baseLogTag+".shouldSaveRemoteCampaigns",[4,S.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION)];case 1:return t=a.sent(),[4,S.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME)];case 2:return n=a.sent(),r=(new Date).getTime(),null==n||r-n>s.INAPP_CONSTANTS.META_REFRESH_TIME?[2,!0]:(o.default.log(1,e,"Last fetch was less than 15 mins ago at ",n),t!==f.getMoeWindowVar().getSdkVersion()?(o.default.log(1,e,"Version change detected. Will proceed to fetch latest campaigns"),[2,!0]):[4,S.default.serviceMetaStore.getItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.UNIQUE_ID)]);case 3:return(i=a.sent())&&(u=l.default.get(s.default.PERSISTENT_STORAGE.USER_DATA).deviceUuid,i!==u)?(o.default.log(1,e,"Unique device id change detected. Will proceed to fetch latest campaigns"),[2,!0]):[2,!1]}}))}))},T.prototype.saveRemoteCampaigns=function(){return r(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:return e=T.baseLogTag+".saveRemoteCampaigns",[4,S.default.campaingsMetaStore.keys()];case 1:return t=r.sent()||[],[4,this.OnsiteApiClient.getCampaignsMeta(t)];case 2:return null==(n=r.sent())?[3,4]:[4,this.addCampaignsToDB(n.campaignsMeta)];case 3:r.sent(),o.default.log(1,e,"Inapp campaigns meta saved!"),r.label=4;case 4:return[4,S.default.serviceMetaStore.setItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.GLOBAL_DELAY,n.globalDelayBetweenInapps)];case 5:return r.sent(),[4,S.default.serviceMetaStore.setItem(s.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION,f.getMoeWindowVar().getSdkVersion())];case 6:return r.sent(),[2]}}))}))},T.prototype.addCampaignsToDB=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:t=T.baseLogTag+".addCampaignsToDB",o.default.log(1,t,"Adding/Updating "+e.length+" campaigns in DB",e.map((function(e){return e.campaignId}))),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,Promise.all(e.map((function(e){return S.default.campaingsMetaStore.setItem(e.campaignId,e)})))];case 2:return r.sent(),[4,this.rebuildTagStore()];case 3:return r.sent(),[3,5];case 4:return n=r.sent(),o.default.error(1,t,"Error saving remote campaigns:",n),[3,5];case 5:return[2]}}))}))},T.prototype.rebuildTagStore=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,s,u,l,c,f,d,g;return a(this,(function(a){switch(a.label){case 0:n=T.baseLogTag+".rebuildTagStore",a.label=1;case 1:return a.trys.push([1,6,,7]),[4,S.default.campaingsTagsStore.clear()];case 2:return a.sent(),[4,this.getCampaignsFromDB()];case 3:r=a.sent(),s={};try{for(u=i(r),l=u.next();!l.done;l=u.next())null!=(c=l.value).tag&&(null==s[c.tag]&&(s[c.tag]=[]),s[c.tag].push(c.campaignId))}catch(a){e={error:a}}finally{try{l&&!l.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}return f=[],[4,S.default.campaingsTagsStore.clear()];case 4:for(d in a.sent(),s)s.hasOwnProperty(d)&&f.push(S.default.campaingsTagsStore.setItem(d,s[d]));return[4,Promise.all(f)];case 5:return a.sent(),[3,7];case 6:return g=a.sent(),o.default.error(1,n,"Error updating tags store:",g),[3,7];case 7:return[2]}}))}))},T.baseLogTag="MoeOnsite",T);function T(e){this.initializationPomise=null,this.testDraftInfo=null,this.triggerManager=null,this.displayManager=null,this.globalDelay=0,this.onsiteSelfHandledTriggerListeners={},this.appId=e.appId,o.default.setLogLevel(e.debugLevel),this.config={host:s.INAPP_CONSTANTS.HOST_1},e.cluster===s.default.CLUSTERS.dc_2||e.cluster===s.default.DEPRECATED_CLUSTERS.dc_2?this.config.host=s.INAPP_CONSTANTS.HOST_2:e.cluster!==s.default.CLUSTERS.dc_3&&e.cluster!==s.default.DEPRECATED_CLUSTERS.dc_3||(this.config.host=s.INAPP_CONSTANTS.HOST_3),e.inapp&&e.inapp.host&&(this.config.host=e.inapp.host),this.OnsiteApiClient=new d.default(this.appId,this.config),this.iframeHelper=new c.default}t.MoeOnsite=E,window[s.SDK_MODULES.INAPP.windowLocation]=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(54),a=n(55),i=n(56),o=n(57),s=n(30),u=n(29),l=n(13),c=(f.doesEventMatchFilters=function(e,t){var n=!1,u=null;switch(t.data_type){case s.TriggerDataTypes.BOOL:(u=new a.default(e,t)).validate()&&(n=u.evaluate());break;case s.TriggerDataTypes.STRING:(u=new r.default(e,t)).validate()&&(n=u.evaluate());break;case s.TriggerDataTypes.NUMBER:case s.TriggerDataTypes.LONG:(u=new i.default(e,t)).validate()&&(n=u.evaluate());break;case s.TriggerDataTypes.DATE:(u=new o.default(e,t)).validate()&&(n=u.evaluate())}return n},f.doesValueMatchFilter=function(e,t){var n=new l.default(t.name,e),r=new u.default("sample event",[n]);return f.doesEventMatchFilters(r,t)},f.baseLogTag="TriggerEvaluator",f);function f(){}t.default=c},function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(30),s=n(0),u=[o.TriggerOperators.EQ,o.TriggerOperators.EXISTS,o.TriggerOperators.CONTAINS,o.TriggerOperators.STARTSWITH,o.TriggerOperators.ENDSWITH,o.TriggerOperators.IN],l=(a(c,i=o.default),c.prototype.evaluate=function(){var e=this,t=!1,n=this.event.attributes.filter((function(t){return t.key===e.filter.name})),r=0<n.length?n[0]:null;if(null!=r&&s.validateDataType.isString(r.value))switch(this.filter.operator){case o.TriggerOperators.EQ:t=this.checkEq();break;case o.TriggerOperators.EXISTS:t=this.checkExists();break;case o.TriggerOperators.CONTAINS:t=this.checkContains(r);break;case o.TriggerOperators.STARTSWITH:t=this.checkStartsWith(r);break;case o.TriggerOperators.ENDSWITH:t=this.checkEndsWith(r);break;case o.TriggerOperators.IN:t=this.checkIn(r)}return this.filter.negate?!t:t},c.prototype.checkContains=function(e){return this.filter.case_sensitive?0<=e.value.indexOf(this.filter.value):0<=e.value.toLowerCase().indexOf(this.filter.value.toLowerCase())},c.prototype.checkStartsWith=function(e){function t(e,t){return e.substr(0,t.length)===t}return this.filter.case_sensitive?t(e.value,this.filter.value):t(e.value.toLowerCase(),this.filter.value.toLowerCase())},c.prototype.checkEndsWith=function(e){function t(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}if(this.filter.case_sensitive)return t(e.value,this.filter.value);var n=this.removeSpecialChars(e.value),r=this.removeSpecialChars(this.filter.value);return t(n.toLowerCase(),r.toLowerCase())},c.prototype.checkIn=function(e){var t=!1;if(Array.isArray(this.filter.value))for(var n=this.filter.value.length-1;0<=n;n--)if(this.filter.case_sensitive){if(this.filter.value[n]===e.value){t=!0;break}}else if(this.filter.value[n].toLowerCase()===e.value.toLowerCase()){t=!0;break}return t},c.baseLogTag="StringDataType",c);function c(e,t){return i.call(this,o.TriggerDataTypes.STRING,u,e,t)||this}t.default=l},function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(30),s=[o.TriggerOperators.EQ,o.TriggerOperators.EXISTS],u=(a(l,i=o.default),l.prototype.evaluate=function(){var e=!1;switch(this.filter.operator){case o.TriggerOperators.EQ:e=this.checkEq();break;case o.TriggerOperators.EXISTS:e=this.checkExists()}return this.filter.negate?!e:e},l.baseLogTag="BooleanDataType",l);function l(e,t){return i.call(this,o.TriggerDataTypes.BOOL,s,e,t)||this}t.default=u},function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(30),s=[o.TriggerOperators.EQ,o.TriggerOperators.EXISTS,o.TriggerOperators.GT,o.TriggerOperators.LT,o.TriggerOperators.BETWEEN,o.TriggerOperators.IN],u=(a(l,i=o.default),l.prototype.evaluate=function(){var e=this,t=!1,n=this.event.attributes.filter((function(t){return t.key===e.filter.name})),r=0<n.length?n[0]:null;if(null!=r&&"number"==typeof r.value)switch(this.filter.operator){case o.TriggerOperators.EQ:t=this.checkEq();break;case o.TriggerOperators.EXISTS:t=this.checkExists();break;case o.TriggerOperators.GT:t=this.checkGreaterThan(r);break;case o.TriggerOperators.LT:t=this.checkLessThan(r);break;case o.TriggerOperators.BETWEEN:t=this.checkBetween(r);break;case o.TriggerOperators.IN:t=this.checkIn(r)}return this.filter.negate?!t:t},l.prototype.checkGreaterThan=function(e){return e.value>this.filter.value},l.prototype.checkLessThan=function(e){return e.value<this.filter.value},l.prototype.checkBetween=function(e){return this.filter.value2?this.filter.value&&this.filter.value2&&this.filter.value<=e.value&&e.value<this.filter.value2:this.filter.value&&this.filter.value1&&this.filter.value<=e.value&&e.value<this.filter.value1},l.prototype.checkIn=function(e){return Array.isArray(this.filter.value)&&0<=this.filter.value.indexOf(e.value)},l.baseLogTag="NumberDataType",l);function l(e,t){return i.call(this,o.TriggerDataTypes.NUMBER,s,e,t)||this}t.default=u},function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(30),s=n(0),u=n(1),l=[o.TriggerOperators.EXISTS,o.TriggerOperators.ON,o.TriggerOperators.BETWEEN,o.TriggerOperators.BEFORE,o.TriggerOperators.AFTER,o.TriggerOperators.INTHELAST,o.TriggerOperators.INTHENEXT,o.TriggerOperators.TODAY],c=(a(f,i=o.default),f.prototype.evaluate=function(){var e=this,t=!1,n=this.event.attributes.filter((function(t){return t.key===e.filter.name})),r=0<n.length?n[0]:null;if(null!=r)switch(r.value.setHours(0,0,0,0),this.filter.operator){case o.TriggerOperators.EQ:t=this.checkEq();break;case o.TriggerOperators.EXISTS:t=this.checkExists();break;case o.TriggerOperators.ON:t=this.checkOn(r);break;case o.TriggerOperators.BETWEEN:t=this.checkBetween(r);break;case o.TriggerOperators.BEFORE:t=this.checkBefore(r);break;case o.TriggerOperators.AFTER:t=this.checkAfter(r);break;case o.TriggerOperators.INTHELAST:t=this.checkLastX(r);break;case o.TriggerOperators.INTHENEXT:t=this.checkNextX(r);break;case o.TriggerOperators.TODAY:t=this.checkToday(r)}return this.filter.negate?!t:t},f.prototype.checkOn=function(e){return e.value.setHours(0,0,0,0)===this.filter.value.setHours(0,0,0,0)},f.prototype.checkBetween=function(e){return this.filter.value2?this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value2.getTime():this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value1.getTime()},f.prototype.checkBefore=function(e){var t=this.filter.value;return typeof t===u.DATA_TYPES.NUMBER?((new Date).setHours(0,0,0,0)-e.value.setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)<t.setHours(0,0,0,0)},f.prototype.checkAfter=function(e){var t=this.filter.value;return typeof t===u.DATA_TYPES.NUMBER?(e.value.setHours(0,0,0,0)-(new Date).setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)>t.setHours(0,0,0,0)},f.prototype.checkLastX=function(e){var t=(new Date).setHours(0,0,0,0),n=e.value.setHours(0,0,0,0);return 0<t-n&&(t-n)/864e5<=this.filter.value},f.prototype.checkNextX=function(e){var t=(new Date).setHours(0,0,0,0),n=e.value.setHours(0,0,0,0);return 0<n-t&&(n-t)/864e5<=this.filter.value},f.prototype.checkToday=function(e){return e.value.setHours(0,0,0,0)===(new Date).setHours(0,0,0,0)},f.baseLogTag="DateTimeDataType",f);function f(e,t){return!s.validateDataType.isDate(t.value)&&s.validateDataType.isString(t.value)&&(t.value=new Date(t.value.split("Z").join(""))),!s.validateDataType.isDate(t.value2)&&s.validateDataType.isString(t.value2)&&null!=t.value2&&(t.value2=new Date(t.value2.split("Z").join(""))),!s.validateDataType.isDate(t.value1)&&s.validateDataType.isString(t.value1)&&null!=t.value1&&(t.value1=new Date(t.value1.split("Z").join(""))),i.call(this,o.TriggerDataTypes.DATE,l,e,t)||this}t.default=c},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),o=n(1),s=n(59),u=n(2),l=(c.prototype.getIframe=function(){var e=this;return null==this.iFramePromise&&(this.iFramePromise=new Promise((function(t){var n=document.createElement("iframe");n.id="moengage-web-helper-frame",n.style.display="none",n.src=o.INAPP_CONSTANTS.WEB_HELPER_IFRAME_URL,document.body.appendChild(n),n.addEventListener("load",(function(){e.helper=new i.default(o.INAPP_CONSTANTS.IFRAME_CHANNEL,n),t(n)}))}))),this.iFramePromise},c.prototype.getDraftCampaignInfo=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return a(this,(function(a){switch(a.label){case 0:e="IframeHelper.getDraftCampaignInfo",a.label=1;case 1:return a.trys.push([1,4,,5]),u.default.log(1,e,"Loading helper frame"),[4,this.getIframe()];case 2:return a.sent(),u.default.log(1,e,"Helper frame loaded"),[4,this.helper.sendMessage(o.INAPP_CONSTANTS.IFRAME_TOPICS.COOKIE_STORAGE,{TYPE:"GET",KEY:o.INAPP_CONSTANTS.COOKIE_STORAGE.TEST_DRAFT_ID})];case 3:return t=a.sent(),u.default.log(1,e,"Data from iframe: ",t),n=t.message,u.default.log(1,e,"Raw test campaign",n),(r=null)!=n&&(s.default.isValidRawJson(n)?r=new s.default(n):u.default.error(1,e,"Data is not a valid test campaign")),[2,r];case 4:return a.sent(),[2,null];case 5:return[2]}}))}))},c);function c(){}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),a=n(0),i=(o.isValidRawJson=function(e){var t=e.draft_id,n=e.draft_tag;return null!=t&&null!=n},o);function o(e){this.draftId=a.getProp(e,"draft_id",null),this.draftType=a.getProp(e,"draft_type",null),this.templateType=a.getProp(e,"template_type",null),this.action=a.getProp(e,"action",null);var t=a.getProp(e,"campaign_meta",{});this.displaySettings=new r.DisplaySettings({config:t},this.templateType)}t.default=i},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},a=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(20),u=n(1),l=n(3),c=n(2),f=n(10),d=n(61),g=n(22),p=(h.prototype.getCampaignsMeta=function(e){return a(this,void 0,void 0,(function(){var t,n,a,l,f,d,p,S;return i(this,(function(i){switch(i.label){case 0:t=h.baseLogTag+".getCampaignsMeta",i.label=1;case 1:return i.trys.push([1,4,,5]),n=this.getRequestOptions(),a=void 0,[4,this.store.getItem(u.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME)];case 2:return null!=(l=i.sent())&&(a=l.toISOString()),[4,s.default.post(this.host+u.INAPP_CONSTANTS.API.META,r({},n,{postData:{campaign_ids:e},last_fetch_time:a}))];case 3:return f=i.sent(),this.store.setItem(u.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME,new Date),this.store.setItem(u.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.UNIQUE_ID,n.queryParams.unique_id),d=JSON.parse(f.responseText),p=[],d.campaigns.forEach((function(e){g.default.isValidMetaJSON(e)&&p.push(new g.default(e))})),[2,{campaignsMeta:p,globalDelayBetweenInapps:o.getProp(d,"min_delay_btw_inapps",0)}];case 4:throw S=i.sent(),c.default.error(1,t,"Error getting meta for inapp: ",S),new Error("Could not get meta payload");case 5:return[2]}}))}))},h.prototype.getCampaignPayload=function(e,t){return a(this,void 0,void 0,(function(){var n,r,a,o,l,f;return i(this,(function(i){switch(i.label){case 0:n=h.baseLogTag+".getCampaignPayload",i.label=1;case 1:if(i.trys.push([1,6,,7]),!t)return[3,3];for(a={},o=0;o<t.attributes.length;o++)a[t.attributes[o].key]=t.attributes[o].value;return l={event:{name:t.name,attributes:a,time:(new Date).toISOString()},contexts:["string"]},[4,s.default.post(this.host+u.INAPP_CONSTANTS.API.CAMPAIGN_PAYLOAD+e,this.getRequestOptions(l))];case 2:return r=i.sent(),[3,5];case 3:return[4,s.default.post(this.host+u.INAPP_CONSTANTS.API.CAMPAIGN_PAYLOAD+e,this.getRequestOptions())];case 4:r=i.sent(),i.label=5;case 5:return[2,new d.default(JSON.parse(r.responseText))];case 6:throw f=i.sent(),c.default.error(1,n,"Error geting payload",f),new Error("Could not get payload for "+e);case 7:return[2]}}))}))},h.prototype.getDraftCampaign=function(e){return a(this,void 0,void 0,(function(){var t,n,r,a;return i(this,(function(i){switch(i.label){case 0:t=h.baseLogTag+".getDraftCampaign",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,s.default.get(this.host+u.INAPP_CONSTANTS.API.DRAFT_CAMPAIGN_PAYLOAD+e,this.getRequestOptions())];case 2:return n=i.sent(),"JSON"===(r=JSON.parse(n.responseText)).payload_type&&(r.payload=JSON.parse(r.payload)),[2,new d.default(r)];case 3:return a=i.sent(),c.default.error(1,t,"Error geting test campaign payload",a),[2,null];case 4:return[2]}}))}))},h.prototype.getRequestOptions=function(e){var t=o.getMoeWindowVar(),n=l.default.get(u.default.PERSISTENT_STORAGE.USER_DATA).deviceUuid;if(!n)throw new Error("device_unique_id not found in localStorage.");return{headers:{"Content-Type":"application/json","MOE-APPKEY":this.appId},queryParams:{sdk_ver:t.getSdkVersion(),os:o.isMobile()?"mweb":"web",unique_id:n},postData:e||{}}},h.baseLogTag="OnsiteApi",h);function h(e,t){this.appId=e,this.store=f.createInstance({driver:[f.INDEXEDDB,f.WEBSQL,f.LOCALSTORAGE],name:u.INAPP_CONSTANTS.DATABASE_NAME,storeName:u.INAPP_CONSTANTS.STORES.SERVICE_META.NAME}),this.host=u.INAPP_CONSTANTS.HOST_1,null!=t&&null!=t.host&&(this.host=t.host)}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){this.templateType=r.getProp(e,"template_type",null),this.payloadType=r.getProp(e,"payload_type",null),this.payload=r.getProp(e,"payload",null),this.position=r.getProp(e,"position",null)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),o=n(1),s=n(0),u=n(29),l=n(2),c=n(31),f=n(63),d=n(13),g=(p.prototype.onTrigger=function(e){this.listener=e},p.prototype.startWatching=function(){return r(this,void 0,void 0,(function(){var e,t,n=this;return a(this,(function(r){switch(r.label){case 0:return e=this,[4,c.filterAndSortCampaigns(this.messagingCampaigns)];case 1:return e.messagingCampaigns=r.sent(),this.eventNameCampaignHash={},this.messagingCampaigns.forEach((function(e){var t=s.getProp(e,"triggerData.primary_condition.action_name",null);null!=t&&(null==n.eventNameCampaignHash[t]&&(n.eventNameCampaignHash[t]=[]),n.eventNameCampaignHash[t].push(e))})),t=new f.WindowEventManager,this.historyManager&&(this.historyManager.getHistory().forEach(this.onEvent),this.historyManager.addEventListener(this.onEvent)),this.scrollCampaignTriggered=!1,this.scrollCampaigns=this.messagingCampaigns.filter((function(e){return"MOE_PAGE_SCROLL"===s.getProp(e,"triggerData.primary_condition.action_name",null)})),0<this.scrollCampaigns.length&&t.onScroll(this.onScroll),this.exitCampaignTriggered=!1,this.exitIntentCampaigns=this.messagingCampaigns.filter((function(e){return"MOE_PAGE_EXIT"===s.getProp(e,"triggerData.primary_condition.action_name",null)})),0<this.exitIntentCampaigns.length&&t.onExit(this.onExit),[2]}}))}))},p.prototype.trigger=function(e,t){null!=this.listener&&this.listener(e,t)},p.prototype.destory=function(){this.listener=null},p.baseLogTag="OnsiteTriggerManager",p);function p(e){var t=this;this.eventNameCampaignHash={},this.messagingCampaigns=[],this.scrollCampaigns=[],this.scrollCampaignTriggered=!1,this.exitIntentCampaigns=[],this.exitCampaignTriggered=!1,this.listener=null,this.historyManager=window[o.WINDOW_OBJECTS.PageEventHistoryManager],this.onEvent=function(e){return r(t,void 0,void 0,(function(){var t,n,r,o;return a(this,(function(a){switch(a.label){case 0:t=p.baseLogTag+".onEvent",a.label=1;case 1:return a.trys.push([1,4,,5]),null==this.eventNameCampaignHash[e.name]?[3,3]:[4,c.filterAndSortCampaigns(this.eventNameCampaignHash[e.name])];case 2:n=a.sent(),r=n.filter((function(t){return i.default.getFilterResult(e,t)})),l.default.log(1,t,"Campaigns triggered for event "+e.name+": "+r.length),this.trigger(e,r),a.label=3;case 3:return[3,5];case 4:return o=a.sent(),l.default.error(1,t,"Error occurred during check event trigger campaigns: ",o),[3,5];case 5:return[2]}}))}))},this.onScroll=function(e){return r(t,void 0,void 0,(function(){var t,n,r,o,s,f,g;return a(this,(function(a){switch(a.label){case 0:t=p.baseLogTag+".onScroll",a.label=1;case 1:return a.trys.push([1,5,,6]),this.scrollCampaigns&&0<this.scrollCampaigns.length&&e>=this.scrollCampaigns[0].triggerData.primary_condition.attributes.filters[0].value&&!this.scrollCampaignTriggered?(l.default.log(1,t,"Triggered Scroll campaign"),n=this.scrollCampaigns[0].triggerData.primary_condition.attributes.filters[0],r=new d.default(n.name,n.value),[4,u.default.createEvent("MOE_PAGE_SCROLL",[r])]):[3,4];case 2:return o=a.sent(),[4,c.filterAndSortCampaigns(this.eventNameCampaignHash.MOE_PAGE_SCROLL)];case 3:s=a.sent(),f=s.filter((function(e){return i.default.getFilterResult(o,e)})),this.trigger(o,f),a.label=4;case 4:return[3,6];case 5:return g=a.sent(),l.default.error(1,t,"Error occurred in triggering scroll campaigns ",g),[3,6];case 6:return[2]}}))}))},this.onExit=function(){return r(t,void 0,void 0,(function(){var e,t,n,r,o;return a(this,(function(a){switch(a.label){case 0:e=p.baseLogTag+".onExit",a.label=1;case 1:return a.trys.push([1,5,,6]),0<this.exitIntentCampaigns.length&&!this.exitCampaignTriggered?(l.default.log(1,e,"Triggered Exit Intent campaign"),[4,u.default.createEvent("MOE_EXIT",[])]):[3,4];case 2:return t=a.sent(),[4,c.filterAndSortCampaigns(this.eventNameCampaignHash.MOE_PAGE_EXIT)];case 3:n=a.sent(),r=n.filter((function(e){return i.default.getFilterResult(t,e)})),this.trigger(t,r),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),l.default.error(1,e,"Error occurred in triggering exit intent campaigns ",o),[3,6];case 6:return[2]}}))}))},this.messagingCampaigns=e}t.default=g},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(0),s=n(1),u=(l.prototype.onScroll=function(e){var t=l.baseLogTag+".onScroll";null==e&&(e=function(){}),e(l.getScrollPercent()),setInterval((function(){i.default.log(1,t,"Scrolled percent:",l.getScrollPercent()),e(l.getScrollPercent())}),5e3)},l.onMobileTabChange=function(e){var t=l.baseLogTag+".onMobileTabChange";document.addEventListener("visibilitychange",(function(){l.isExitIntentShown||"hidden"!==document.visibilityState||(i.default.log(1,t,"TRIGGERED: MOBILE EXIT INTENT"),e(),l.isExitIntentShown=!0)}))},l.onMobileBackHit=function(e){var t=l.baseLogTag+".onMobileBackHit";setTimeout((function(){window.addEventListener("popstate",(function(n){!l.isExitIntentShown&&n.state&&"exit_intent"===n.state.moeIntent?(i.default.log(1,t,"TRIGGERED: MOBILE EXIT INTENT"),e(),l.isExitIntentShown=!0):l.isExitIntentShown&&n.state&&"exit_intent"===n.state.moeIntent&&window.history.back()}))}),1e3),window.history.state&&"no_intent"===window.history.state.moeIntent||(window.history.replaceState({moeIntent:"exit_intent"},""),window.history.pushState({moeIntent:"no_intent"},""))},l.onMobileScrollAndExit=function(e){var t=l.baseLogTag+".onMobileScrollAndExit",n=document.documentElement.offsetHeight,r=l.getScrollY(),a=null;0<n&&(a=window.setInterval((function(){var o=r-l.getScrollY();o<0&&(o=0,r=l.getScrollY()),l.getScrollPercent()>s.INAPP_CONSTANTS.EXIT_INTENT.CONFIG.SCROLL_DOWN_THRESHOLD&&o/n>s.INAPP_CONSTANTS.EXIT_INTENT.CONFIG.SCROLL_UP_THRESHOLD/100&&(clearInterval(a),a=null,l.isExitIntentShown||(i.default.log(1,t,"TRIGGERED: MOBILE EXIT INTENT"),e(),l.isExitIntentShown=!0))}),s.INAPP_CONSTANTS.EXIT_INTENT.CONFIG.SCROLL_INTERVAL))},l.mobileExitIntent=function(e){l.onMobileScrollAndExit(e),l.onMobileBackHit(e),l.onMobileTabChange(e)},l.prototype.onExit=function(e){var t=this,n=l.baseLogTag+".onExit";o.isMobile()?l.mobileExitIntent(e):document.addEventListener("mouseout",(function(o){return r(t,void 0,void 0,(function(){var t,r;return a(this,(function(a){return t=window.innerWidth,r=window.innerHeight,(o.clientY<0||o.clientX<0||o.clientY>=r||o.clientX>=t)&&(i.default.log(1,n,"TRIGGERED: EXIT INTENT"),e()),[2]}))}))}),!1)},l.getScrollPercent=function(){var e=window,t=document,n=t.documentElement,r=t.getElementsByTagName("body")[0],a=e.innerHeight||n.clientHeight||r.clientHeight,i=document.body,o=document.documentElement,s=Math.max(i.scrollHeight,i.offsetHeight,o.clientHeight,o.scrollHeight,o.offsetHeight);return a<s?100*l.getScrollY()/(s-a):100},l.getScrollY=function(){var e=0;return"number"==typeof window.pageYOffset?e=window.pageYOffset:document.body&&document.body.scrollTop&&(e=document.body.scrollTop),e},l.baseLogTag="WindowEventManager",l.isExitIntentShown=!1,l);function l(){}t.WindowEventManager=u},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(22),u=n(0),l=n(44),c=n(1),f=n(31),d=n(65),g=n(66),p=(h.prototype.startInitialization=function(){return r(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){e=h.baseLogTag+".startInitialization";try{null==this.initializationPromiseObject&&(this.initializationPromiseObject=new u.PromiseObject),this.moeInappPusher=document.createElement("div"),this.moeInappPusher.style.setProperty("display","block","important"),this.moeInappPusher.style.height="0px","FRAMESET"===document.body.nodeName?(t=document.head).parentNode.insertBefore(this.moeInappPusher,t):(n=document.body.firstChild).parentNode.insertBefore(this.moeInappPusher,n),this.initializationPromiseObject.res()}catch(r){o.default.error(1,e,"Error initializing display managaer:",r)}return[2]}))}))},h.getIframeId=function(e){return"moe-onsite-campaign-"+e},h.prototype.queueDraftCampaign=function(e,t){return r(this,void 0,void 0,(function(){var n,r,s,u,l=this;return a(this,(function(a){switch(a.label){case 0:n=h.baseLogTag+".queueDraftCampaign",a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.initializationPromiseObject.p];case 2:return a.sent(),e.position=t.position,this.testCampaign=e,r=h.createDefaultIframe(this.testCampaign.draftId,t.payload),o.default.warn(1,n,"Going to render test campaign "+e.draftId),"FRAMESET"===document.body.nodeName?(s=this.moeInappPusher).parentNode.insertBefore(r,s):(s=document.body.firstChild).parentNode.insertBefore(r,s),r.onload=function(){var t,a,s,u,f,d;function g(e){return Array.prototype.slice.call(e)}r.contentWindow.postMessage({campaignId:e.draftId},"*");var p=g(r.contentDocument.getElementsByClassName(c.INAPP_CONSTANTS.CSS_SELECTORS.DISMISS_INAPP)),h=g(r.contentDocument.getElementsByClassName(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)),S=g(r.contentDocument.getElementsByTagName("a"));0===p.length&&o.default.warn(1,n,"No dismiss class items present in this template"),0===h.length&&o.default.warn(1,n,"No click class items present in this template");try{for(var E=i(p),T=E.next();!T.done;T=E.next())(y=T.value).addEventListener("click",(function(){l.dismissTestInapp(e.draftId)}))}catch(a){t={error:a}}finally{try{T&&!T.done&&(a=E.return)&&a.call(E)}finally{if(t)throw t.error}}try{for(var m=i(h),_=m.next();!_.done;_=m.next())(y=_.value).addEventListener("click",(function(){o.default.log(1,n,"Clicked on test campaign element. No data will be sent to BE right now. We'll start sending the click events once the campaign is live")}))}catch(a){s={error:a}}finally{try{_&&!_.done&&(u=m.return)&&u.call(m)}finally{if(s)throw s.error}}try{for(var v=i(S),b=v.next();!b.done;b=v.next()){var y;"_blank"!==(y=b.value).getAttribute("target")&&y.setAttribute("target","_parent")}}catch(a){f={error:a}}finally{try{b&&!b.done&&(d=v.return)&&d.call(v)}finally{if(f)throw f.error}}l.renderTestCampaign(e,r)},[3,4];case 3:return u=a.sent(),o.default.error(1,n,"Error queueing draft campaign",u),[3,4];case 4:return[2]}}))}))},h.prototype.renderTestCampaign=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(a){return t.style.display="block",t.style.zIndex="2147483647",e.displaySettings.config.blocking?(t.style.height=window.innerHeight+"px",t.style.width="100%"):(t.style.height=getComputedStyle(t.contentDocument.body).height,t.style.width=getComputedStyle(t.contentDocument.body).width,e.templateType===s.TEMPLATE_TYPE.POP_UP&&(t.style.margin="0px auto"),-1<t.srcdoc.indexOf(c.INAPP_CONSTANTS.POSITIONED_TEMPLATE)&&(n=-1<t.srcdoc.indexOf(c.INAPP_CONSTANTS.SIDE_BANNER),this.adjustPositionOfCampaign(t.style,e.position,n))),e.templateType===s.TEMPLATE_TYPE.BANNER?e.displaySettings.config.sticky?t.style.position="fixed":t.style.position="absolute":e.templateType===s.TEMPLATE_TYPE.POP_UP&&(t.style.position="fixed",t.style.backgroundColor="rgba(99, 99, 99, 0.21)"),e.displaySettings.config.scrollable?document.body.style.overflow="initial":document.body.style.overflow="hidden",e.templateType===s.TEMPLATE_TYPE.BANNER&&(r=parseInt(getComputedStyle(t.contentDocument.body).height),i=-1<t.srcdoc.indexOf(c.INAPP_CONSTANTS.POSITIONED_TEMPLATE),e.displaySettings.config.pushPage&&(i&&"TOP"===e.position||!i)&&(this.moeInappPusher.style.height=r.toString()+"px")),[2]}))}))},h.prototype.queueLiveCampaign=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(a){switch(a.label){case 0:n=h.baseLogTag+".queueLiveCampaign",a.label=1;case 1:return a.trys.push([1,7,,8]),[4,this.initializationPromiseObject.p];case 2:return a.sent(),null!=this.campaignRenderMap[e.campaignId]?[3,5]:(this.campaignRenderOrder.push(e.campaignId),this.campaignRenderMap[e.campaignId]=new d.default(e,t),r=h.createDefaultIframe(e.campaignId,this.campaignRenderMap[e.campaignId].data.payload),this.campaignRenderMap[e.campaignId].iframe=r,[4,this.campaignRenderMap[e.campaignId].waitForDelay]);case 3:return a.sent(),[4,this.canCampaignBeRendered(e)];case 4:return a.sent()?(o.default.warn(1,n,"Going to render "+e.campaignId),this.campaignRenderMap[e.campaignId].setIsActive(!0),f.getImpressionTracker(e,"OSM")(),null!=this.renderListener&&this.renderListener(e),this.renderAllActiveCampaigns()):o.default.warn(1,n,"Can not render "+e.campaignId),[3,6];case 5:o.default.warn(1,n,"Can not render "+e.campaignId+", as it already being displayed or has been displayed once on this page already."),a.label=6;case 6:return[3,8];case 7:return i=a.sent(),o.default.error(1,n,"Error queuing campaign "+e.campaignId,i),[3,8];case 8:return[2]}}))}))},h.prototype.renderAllActiveCampaigns=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,l,d,g,p,E,T=this;return a(this,(function(m){switch(m.label){case 0:if(e=h.baseLogTag+".renderAllActiveCampaigns",t=this.getActiveCampaigns(),this.restoreBodyStyle(),!(0<t.length))return[3,5];n=function(n){var l,d,g;return a(this,(function(a){switch(a.label){case 0:return null==document.getElementById(h.getIframeId(t[n].campaignMeta.campaignId))&&("FRAMESET"===document.body.nodeName?(l=r.moeInappPusher).parentNode.insertBefore(t[n].iframe,l):(l=document.body.firstChild).parentNode.insertBefore(t[n].iframe,l),t[n].iframe.onload=function(){var r,a,s,u,l,d;function g(e){return Array.prototype.slice.call(e)}S.setScrollState(T.initialBodyStyle,t),t[n].iframe.contentWindow.postMessage({campaignId:t[n].campaignMeta.campaignId},"*");var p=t[n].iframe,h=g(p.contentDocument.getElementsByClassName(c.INAPP_CONSTANTS.CSS_SELECTORS.DISMISS_INAPP)),E=g(p.contentDocument.getElementsByClassName(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)),m=g(p.contentDocument.getElementsByTagName("a"));function _(e){e.addEventListener("click",(function(){T.dismissInapp(t[n].campaignMeta.campaignId),e.classList.contains(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)||f.sendDismissEvent(t[n].campaignMeta,"OSM")}))}0===h.length&&o.default.warn(1,e,"No dismiss class items present in this template"),0===E.length&&o.default.warn(1,e,"No click class items present in this template");try{for(var v=i(h),b=v.next();!b.done;b=v.next())_(P=b.value)}catch(a){r={error:a}}finally{try{b&&!b.done&&(a=v.return)&&a.call(v)}finally{if(r)throw r.error}}if(-1<t[n].data.payload.indexOf("TEXT_INPUT"))p.contentDocument.body.addEventListener("click",(function(e){if(e.target&&e.target.classList.contains(c.INAPP_CONSTANTS.CSS_SELECTORS.CLICK_INAPP)){var r=e.target.dataset.id;f.getClickTracker(t[n].campaignMeta,"OSM",{widget_id:r})()}}));else try{for(var y=i(E),I=y.next();!I.done;I=y.next())(P=I.value).addEventListener("click",(function(e){var r=e.target.dataset.id;f.getClickTracker(t[n].campaignMeta,"OSM",{widget_id:r})()}))}catch(a){s={error:a}}finally{try{I&&!I.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}try{for(var A=i(m),O=A.next();!O.done;O=A.next()){var P;"_blank"!==(P=O.value).getAttribute("target")&&P.setAttribute("target","_parent")}}catch(a){l={error:a}}finally{try{O&&!O.done&&(d=A.return)&&d.call(A)}finally{if(l)throw l.error}}t[n].onFrameLoad.res()}),[4,t[n].onFrameLoad.p];case 1:return a.sent(),t[n].iframe.style.display="block",o.default.log(1,e,"zindex for "+t[n].campaignMeta.campaignId,2147483647..toString()),t[n].iframe.style.zIndex=(2147483647-(t.length-n-1)).toString(),t[n].iframe.style.margin="0",t[n].campaignMeta.display.config.blocking?(t[n].iframe.style.height=window.innerHeight+"px",t[n].iframe.style.width="100%"):(setTimeout((function(){t[n].iframe.style.height=getComputedStyle(t[n].iframe.contentDocument.body).height,t[n].iframe.style.padding.includes("10px")?t[n].iframe.style.width=parseInt(getComputedStyle(t[n].iframe.contentDocument.body).width)+20+"px":t[n].iframe.style.width=getComputedStyle(t[n].iframe.contentDocument.body).width}),0),t[n].campaignMeta.templateType===s.TEMPLATE_TYPE.POP_UP&&(t[n].iframe.style.margin="0px auto"),-1<t[n].data.payload.indexOf(c.INAPP_CONSTANTS.POSITIONED_TEMPLATE)&&(d=-1<t[n].data.payload.indexOf(c.INAPP_CONSTANTS.SIDE_BANNER),r.adjustPositionOfCampaign(t[n].iframe.style,t[n].data.position,d))),t[n].campaignMeta.templateType===s.TEMPLATE_TYPE.BANNER?t[n].campaignMeta.display.config.sticky?t[n].iframe.style.position="fixed":t[n].iframe.style.position="absolute":t[n].campaignMeta.templateType===s.TEMPLATE_TYPE.POP_UP&&(t[n].iframe.style.position="fixed",t[n].iframe.style.backgroundColor="rgba(99, 99, 99, 0.21)"),null==t[n].dismissInterval&&0<(g=1e3*u.getProp(t[n].campaignMeta,"delivery.dismiss_interval",0))&&(t[n].dismissInterval=setTimeout((function(){T.campaignRenderMap[t[n].campaignMeta.campaignId].isActive()&&(T.dismissInapp(t[n].campaignMeta.campaignId),f.sendDismissEvent(t[n].campaignMeta,"OSM",!0))}),g)),[2]}}))},r=this,g=0,m.label=1;case 1:return g<t.length?[5,n(g)]:[3,4];case 2:m.sent(),m.label=3;case 3:return g++,[3,1];case 4:for(l=t.filter((function(e){return e.campaignMeta.templateType===s.TEMPLATE_TYPE.BANNER})),d=0,g=l.length-1;0<=g;g--)p=parseInt(getComputedStyle(t[g].iframe.contentDocument.body).height),E=-1<t[g].data.payload.indexOf(c.INAPP_CONSTANTS.POSITIONED_TEMPLATE),t[g].campaignMeta.display.config.pushPage&&(E&&"TOP"===t[g].data.position||!E)&&(d+=p);this.moeInappPusher.style.height=d.toString()+"px",m.label=5;case 5:return[2]}}))}))},h.prototype.restoreBodyStyle=function(){this.moeInappPusher.style.height="0px",["overflow"].forEach((function(e){document.body.style[e]="initial"}))},h.prototype.canCampaignBeRendered=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,s;return a(this,(function(a){switch(a.label){case 0:t=h.baseLogTag+".queueLiveCampaign",a.label=1;case 1:return a.trys.push([1,5,,6]),[4,l.default.campaingsStatsStore.getItem(e.campaignId)];case 2:return n=a.sent(),[4,l.default.serviceMetaStore.getItem(c.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.GLOBAL_DELAY)];case 3:return r=a.sent(),[4,l.default.serviceMetaStore.getItem(c.INAPP_CONSTANTS.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME)];case 4:return i=a.sent(),[2,f.CampaignUtils.isValid(e,n)&&f.CampaignUtils.isValidMessagingCampaign(e,n,r,i,this.getActiveCampaigns())];case 5:return s=a.sent(),o.default.error(1,t,"Error checking if campaign "+e.campaignId+" can be rendered:",s),[3,6];case 6:return[2,!1]}}))}))},h.createDefaultIframe=function(e,t){var n=h.getIframeId(e),r=document.createElement("iframe");return r.setAttribute("id",n),r.style.left="0px",r.style.top="0px",r.style.bottom="0px",r.style.right="0px",r.style.border="0px none",r.style.height="100%",r.style.width=window.innerWidth.toString()+"px",r.style.padding="0",r.style.overflow="hidden",r.style.overflowY="hidden",r.style.zIndex="999999",r.style.display="none",r.style.position="fixed",r.setAttribute("srcdoc",t),r},h.prototype.onRender=function(e){this.renderListener=e},h.prototype.getActiveCampaigns=function(){var e=this;return this.campaignRenderOrder.map((function(t){return e.campaignRenderMap[t]})).filter((function(e){return e.isActive()}))},h.prototype.destroy=function(){this.getActiveCampaigns().forEach((function(e){e.setIsActive(!1)})),this.renderAllActiveCampaigns(),this.campaignRenderOrder=[],this.campaignRenderMap={}},h.prototype.adjustPositionOfCampaign=function(e,t,n){t&&(Object.assign(e,g.CAMPAIGN_POSITIONS[t]),u.isMobile()&&n&&this.addMarginInMweb(e,t))},h.prototype.addMarginInMweb=function(e,t){var n={paddingLeft:"10px",paddingRight:"10px",marginTop:"0",marginBottom:"0"};"TOP"===t&&(n.marginTop="10px"),"BOTTOM"===t&&(n.marginBottom="10px"),Object.assign(e,n)},h.baseLogTag="MessagingDisplayManager",h);function h(){var e=this;this.renderListener=null,this.initializationPromiseObject=null,this.campaignRenderOrder=[],this.campaignRenderMap={},this.dismissTestInapp=function(t){document.body.style.overflow="initial",e.moeInappPusher.style.height="0",document.getElementById("moe-onsite-campaign-"+t).style.display="none"},this.dismissInapp=function(t){0!==e.getActiveCampaigns().length?(e.getActiveCampaigns().forEach((function(e){e.iframe.style.display="none",e.iframe.style.height="0px",e.iframe.style.overflow="hidden"})),e.campaignRenderMap[t].setIsActive(!1),clearInterval(e.campaignRenderMap[t].dismissInterval),e.renderAllActiveCampaigns()):e.dismissTestInapp(t)},this.startInitialization(),this.initialBodyStyle=window.getComputedStyle(document.body),window.addEventListener("resize",(function(){e.renderAllActiveCampaigns()}))}t.default=p;var S=(E.setScrollState=function(e,t){for(var n=!0,r=0;r<t.length;r++)n=n&&t[r].campaignMeta.display.config.scrollable;document.body.style.overflow=n?e.overflow:"hidden"},E);function E(){}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=(i.prototype.setIsActive=function(e){this.active=e},i);function i(e,t){var n=this;this.waitForDelay=null,this.iframe=null,this.onFrameLoad=new r.PromiseObject,this.active=!1,this.dismissInterval=null,this.isActive=function(){return n.active},this.campaignMeta=e,this.data=t,this.active=!1;var a=r.getProp(e,"triggerData.trigger_delay.delayInSeconds",0)||0;this.waitForDelay=new Promise((function(e){setTimeout((function(){e()}),1e3*a)}))}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CAMPAIGN_POSITIONS={CENTER:{position:"absolute",top:"50%",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, -50%)"},CENTER_LEFT:{position:"absolute",top:"50%",left:"10px",bottom:"auto",right:"auto",transform:"translate(0,-50%)"},CENTER_RIGHT:{position:"absolute",top:"50%",right:"10px",bottom:"auto",left:"auto",transform:"translate(0,-50%)"},TOP_LEFT:{position:"absolute",top:"10px",left:"10px",bottom:"auto",right:"auto"},TOP_CENTER:{position:"absolute",top:"0",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, 0)"},TOP_RIGHT:{position:"absolute",top:"10px",right:"10px",bottom:"auto",left:"auto"},BOTTOM_LEFT:{position:"absolute",bottom:"10px",left:"10px",top:"auto",right:"auto"},BOTTOM_CENTER:{position:"absolute",left:"50%",bottom:"10px",top:"auto",right:"auto",transform:"translate(-50%, 0)"},BOTTOM_RIGHT:{position:"absolute",bottom:"10px",right:"10px",top:"auto",left:"auto"},TOP:{position:"absolute",top:"0",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, 0)"},BOTTOM:{position:"absolute",bottom:"0",top:"auto",right:"auto",left:"50%",transform:"translate(-50%, 0)"},LEFT:{position:"absolute",left:"0",bottom:"auto",right:"auto",top:"auto"},RIGHT:{position:"absolute",right:"0",bottom:"auto",left:"auto",top:"auto"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(7),i=(o.prototype.onWindowVisibilityChange=function(e){a.default.set("isWindowActive",!0),document.addEventListener("focus",(function(){t(!0)}),!1),document.addEventListener("blur",(function(){t(!1)}),!1),window.addEventListener("focus",(function(){t(!0)}),!1),window.addEventListener("blur",(function(){"IFRAME"!==document.activeElement.tagName&&t(!1)}),!1);var t=function(e){return"boolean"==typeof e?n(e?"visible":"hidden"):document.hidden?n("hidden"):n("visible")},n=r.debounce((function(t){a.default.set("isWindowActive","visible"===t),e(t)}),250);window.addEventListener("visibilitychange",t,!1)},o.baseLogTag="WindowEventManager",o);function o(){}t.default=i}]);